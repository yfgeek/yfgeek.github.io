---
title: Tor安全上网指南
tags: 'Hack'
id: 4
updated: '2016-08-05 21:13:45'
date: 2016-07-28 16:01:47
---


本文主要介绍了如何将一个虚拟机系统全局使用TOR技术，笔者所用操作系统为OS X EI Capitan 10.11.5，虚拟机系统为VMware Fusion专业版 8.1.1 (3771013)。
<!-- more --> 
声明！

==本文原创，技术无罪，笔者即将身处海外，本文撰写目的**仅为防止美国棱镜计划侵犯本人隐私安全，无其它任何用途**。==

==使用TOR技术请在遵守当地法律的前提下使用！本软件在中国大陆地区已被封锁，按照相关法律法规，禁止使用本软件。由于相关政策法律原因，**不允许任何形式私自转载**，本文只进行对TOR相关**技术探讨**，不涉及任何违法违规行为，请勿用于非法用途（如渗透服务器、非法扫描网段、不受监控的网络言论、不受监控的非法互联网通讯等），如出现上述等违法行为，请自负法律责任！==


**准备条件**

* 1.一个隧道(ssh,shadowsocks,socket5,http,vpn都可以)可以连接到真正的互联网，如果身处海外请无视此条。

* 2.最新版Vidalia [下载地址](https://dist.torproject.org/vidalia-bundles/)（需完整互联网）

* 3.Vmware Fusion/Vmware workstation/Oracle VirtualBox

* 4.一个完整版的虚拟机操作系统

**笔者环境**

操作系统：OS X EI Capitan 10.11.5

虚拟机软件：VMware Fusion专业版 8.1.1 (3771013)

虚拟机操作系统：Windows xp sp2 或 Kali linux

隧道软件：lantern 或 shadowsockets

### Vidalia部分

*如果你的网络未进行封锁，请忽略前2步，请跑步进入第3步。*
<img src="/content/images/2016/07/1-1.png" width = "500px"/>
**1.建立您的隧道网络**

笔者以shadowsocks为例，开启shadowsocks配置好信息后，无需做任何操作。shadowsocks的默认对外端口为1080。

**2.在Vidalia中设置代理连接**

打开Vidalia-设置-网络：我使用代理服务器连接网络

地址：127.0.0.1 端口：1080（用户定义）

类型：SOCKS 5
![](/content/images/2016/07/1-2.png)

**3.继续设置，转发出外网端口**

Vidalia-设置-高级-编辑当前torrc：
![](/content/images/2016/07/1-3.png)
确认socksport为9050，也可以定义为其他端口。
同时添加`SocksListenAddress 0.0.0.0:9050`到底部
保存

笔者配置文件如下，仅供参考，不可复制：

```Bash
# This file was generated by Tor; if you edit it, comments will not be preserved
# The old torrc file was renamed to torrc.orig.1 or similar, and Tor will ignore it

ControlPort 9051
DataDirectory /Users/ivan/.tor
DirReqStatistics 0
HashedControlPassword 16:此处隐藏
Socks5Proxy 127.0.0.1:1080
Log notice stdout
SocksListenAddress 0.0.0.0:9050
SocksPort 9050
```


</pre>
![](/content/images/2016/07/1-4.png)
**4.Vidalia启动TOR**

稍等片刻，需要建立Tor回路，五分钟后，便会提示你连接成功。
![](/content/images/2016/07/1-5.png)
随后可以通过使用Chrome的网络代理插件测试，通过ip测试可判断是否成功。如果ip地址每几分钟自动更新一次，且都是不同国家的，则说明TOR回路建立成功。
![](/content/images/2016/07/2-2.png)
![](/content/images/2016/07/2-1.png)

### Vmware部分

**1.设置Vmware，添加虚拟网卡**

进入Vmware的偏好设置-网络，先点小锁，把功能解锁。

然后点+，新建一个网络，**警告：请勿勾选NAT**。

**勾选 将MAC主机连入该网络**

同时设置 **通过DHCP在该网络提供网络地址**：

<pre>
子网ip：172.16.225.0

子网掩码：255.255.255.0
</pre>

![](/content/images/2016/07/1.jpg)
**2.在虚拟机系统的配置中，将网络适配器的上网方式改为vmnet2**

虚拟机-设置-网络适配器-vmnet2，请再次确保无其他上网方式以保证绝对安全。
![](/content/images/2016/07/2.jpg)

### **虚拟机部分(Win)**
**1.进入操作系统**

建议重新安装操作系统，以保证系统纯净性。
![](/content/images/2016/07/4-1.jpg)
![](/content/images/2016/07/5-pic_hd.jpg)

**2.寻找宿主机ip**

经过笔者的简单测试，宿主机ip为172.16.225.1
![](/content/images/2016/07/6-pic_hd.jpg)
如果实在找不到，可用啊D工具箱或nmap等工具进行查找。

**3.确认系统当前状态下不能上网，甚至局域网也不可通，检查网络连接中的网络适配器，禁用一切，仅保留本地连接**

**4.安装Proxifier**

Proxifier是一个全局代理软件，将socket端口流量转发到系统全局，十分好用稳定，值得推荐。

**5.配置Proxifer**

打开Proxifier-Profile-Proxy Servers，点击Add...
![](/content/images/2016/07/7-pic_hd.jpg)

随后保存并设置而为默认

**6.测试网络**

打开浏览器，对当前ip进行查询，ip会随着时间随机切换，不同国家。
![](/content/images/2016/07/9-pic_hd.jpg)
![](/content/images/2016/07/8-pic_hd.jpg)

### **总结**

为了保证用户隐私的绝对安全，建议做到以下几点：

* 在虚拟机系统下不要留下任何痕迹：
 * 虚拟机操作系统系统语言设置为英语，地区为美国。
 * 虚拟机下的浏览器建议使用friefox或chrome，安装https everywhere、noscript等插件，在浏览器相关设置中设置禁止追踪等查看隐私行为。
 * 关机前清除系统隐私记录，养成良好习惯。
 * 能设置不保留记录的软件均设置如此。
 * 不要安装使用任何国产软件，尤其是任何国产音乐播放器、任何国产视频播放器，严禁使用360等任何管家、QQ、搜狗输入法、各种国产云盘，否则一定会前功尽弃。
 * 不要使用任何私人账户登录任何网站、任何软件，如有必要，建议现场注册新号码，不要自作聪明使用尘封已久的小号。
* 将虚拟机操作系统放在Truecrypt等加密软件的虚拟磁盘里，如果是Windows，建议开启Bitlocker，如果是MacOS，建议开启FileVault，同时将系统密码设置为与自己隐私无关的高强度密码。
* 设置宿主机的BIOS密码，防止设备被盗隐私丢失，同时建议写好一键远程删除虚拟磁盘的sh脚本，以防重要文件泄露。
* 进入TOR网络后，您将面临更大的网络威胁，因为TOR的网域中深藏全球各地的极客、大黑客、恐怖分子等危险人物，请更加注意保护虚拟机子系统安全以及文件安全。

**特别鸣谢**

感谢几年前@safe121提供的无私技术帮助

