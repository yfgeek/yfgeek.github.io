---
title: Siri+Workflow(捷径)利用API实战——远程构建Travis CI
date: 2018-09-25 13:00:53
tags: iOS
categories: iOS
banner_img: /banners/workflow.png
---

iOS 12 中，最大的更新莫过于**捷径**（Workflow）可以和Siri产生互动。普通用户可能根本没有察觉到这个十分有用的自动化工具，实际上，早在iOS11时期，苹果收购了Workflow，很多用户就开始自行创建出很多有用的自动化脚本，很多用户都在**闷声发大财**（比如百度云链接提取、利用VIP视频网站免费看、修改微信运动步数、网易云音乐下载）。

本文以“重新构建Travis CI中的项目”为例，介绍如何举一反三，利用开发者API创造自己的**捷径工作流**，同时利用Hey Siri，让生活更加科技感、酷酷的、便利化。

鸣谢：@Echowxsy好友的Docker构建脚本及“删库跑路”脚本，对本文章的创作启发。

# 目标

通过Hey Siri，实现实时重新构建Travis CI中的应用，如图。

![](/content/images/ios-workflow-api/app/06.jpg)

# Travis CI API

其实Travis CI本身就是一个自动化构建工具，有很多种方法可以让他自动取构建，比如在设置中开启``Build pushed branches``，本文只是举个例子，利用Siri手动构建。

首先，检查你使用的是org还是com版本的Travis CI。

travis.org API:https://developer.travis-ci.org

travis.com API: https://developer.travis-ci.com/

Travis CI API其实很简单，只需要拿着自己的`token`，就可以进行API的GET/POST操作。

访问`Getting Started`页面，可以看到两个例子，在这里，我们复制涂黑的部分，即为你的`token`。

## 关于请求

需要包含三个http headers：

`Travis-API-Version`: This should always be set to `3`, to avoid interfacing with our legacy API.

`User-Agent`: Most HTTP clients already set this, but if you develop a Travis CI client, you are highly encouraged to set this to a custom value.

`Authorization`: `token XXXXXXX` where XXXXXXX is an access token [generated by the Travis CI client](https://developer.travis-ci.org/authentication).

## 获得所有Builds

要重新构建当前项目，根据[Build](https://developer.travis-ci.org/resource/build#Build)提供的参数，需要获得当前项目的`build.id`。

此时可以通过[Builds](https://developer.travis-ci.org/resource/builds) API进行获取，打开Postman，新建一个Request(或者您也可以用CURL命令)，配置如下，token填入自己的token，点击`Send`。

![](/content/images/ios-workflow-api/2.png)

在返回的JSON文件中，找到builds下的第一组里的id，即`builds[0].id`，这就是我们要提交的`build.id`。

## 测试请求

拿到`build.id`后，我们在Postman中发送这样的请求，如果拿到状态时pending，则说明请求成功。

![](/content/images/ios-workflow-api/3.png)

# Workflow

创建Workflow的过程，需要自行研究，截图中每一个模块，都可以在下方搜索中搜索到。

第一步，打开捷径

第二步，搜索部件进行创建

![](/content/images/ios-workflow-api/app/01.jpg)

![](/content/images/ios-workflow-api/app/02.jpg)

![](/content/images/ios-workflow-api/app/03.jpg)

![](/content/images/ios-workflow-api/app/04.jpg)

最后点击执行，测试一下，就可以用手机发送包含http headers的POST请求了。

# Siri

设置Siri很简单，点击右上角的按钮，点击“Siri指令”

![](/content/images/ios-workflow-api/app/05.jpg)

测试一下

![](/content/images/ios-workflow-api/app/06.jpg)

查看一下Travis CI，重新部署成功

![](/content/images/ios-workflow-api/1.png)

从此，我们就可以愉快的用Siri部(zhuang)署(bi)啦～